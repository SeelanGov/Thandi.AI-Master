"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/rag/query/route";
exports.ids = ["app/api/rag/query/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "module":
/*!*************************!*\
  !*** external "module" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("module");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frag%2Fquery%2Froute&page=%2Fapi%2Frag%2Fquery%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frag%2Fquery%2Froute.js&appDir=C%3A%5CUsers%5CSEELANGOV%5CDesktop%5CThandi.ai%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CSEELANGOV%5CDesktop%5CThandi.ai&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frag%2Fquery%2Froute&page=%2Fapi%2Frag%2Fquery%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frag%2Fquery%2Froute.js&appDir=C%3A%5CUsers%5CSEELANGOV%5CDesktop%5CThandi.ai%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CSEELANGOV%5CDesktop%5CThandi.ai&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_SEELANGOV_Desktop_Thandi_ai_app_api_rag_query_route_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/rag/query/route.js */ \"(rsc)/./app/api/rag/query/route.js\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/rag/query/route\",\n        pathname: \"/api/rag/query\",\n        filename: \"route\",\n        bundlePath: \"app/api/rag/query/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\SEELANGOV\\\\Desktop\\\\Thandi.ai\\\\app\\\\api\\\\rag\\\\query\\\\route.js\",\n    nextConfigOutput,\n    userland: C_Users_SEELANGOV_Desktop_Thandi_ai_app_api_rag_query_route_js__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/rag/query/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZyYWclMkZxdWVyeSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGcmFnJTJGcXVlcnklMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZyYWclMkZxdWVyeSUyRnJvdXRlLmpzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNTRUVMQU5HT1YlNUNEZXNrdG9wJTVDVGhhbmRpLmFpJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNTRUVMQU5HT1YlNUNEZXNrdG9wJTVDVGhhbmRpLmFpJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3dCO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdUdBQXVHO0FBQy9HO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDNko7O0FBRTdKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGhhbmRpLXJhZy1zeXN0ZW0vPzRlZTgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcU0VFTEFOR09WXFxcXERlc2t0b3BcXFxcVGhhbmRpLmFpXFxcXGFwcFxcXFxhcGlcXFxccmFnXFxcXHF1ZXJ5XFxcXHJvdXRlLmpzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9yYWcvcXVlcnkvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9yYWcvcXVlcnlcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3JhZy9xdWVyeS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXFNFRUxBTkdPVlxcXFxEZXNrdG9wXFxcXFRoYW5kaS5haVxcXFxhcHBcXFxcYXBpXFxcXHJhZ1xcXFxxdWVyeVxcXFxyb3V0ZS5qc1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9yYWcvcXVlcnkvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frag%2Fquery%2Froute&page=%2Fapi%2Frag%2Fquery%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frag%2Fquery%2Froute.js&appDir=C%3A%5CUsers%5CSEELANGOV%5CDesktop%5CThandi.ai%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CSEELANGOV%5CDesktop%5CThandi.ai&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/rag/query/route.js":
/*!************************************!*\
  !*** ./app/api/rag/query/route.js ***!
  \************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var _lib_curriculum_query_gates_simple__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/curriculum/query-gates-simple */ \"(rsc)/./lib/curriculum/query-gates-simple.js\");\n/* harmony import */ var _lib_compliance_consent_gate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/compliance/consent-gate */ \"(rsc)/./lib/compliance/consent-gate.js\");\n/* harmony import */ var _lib_compliance_popia_sanitiser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/compliance/popia-sanitiser */ \"(rsc)/./lib/compliance/popia-sanitiser.js\");\n/* harmony import */ var _lib_llm_llm_adapter__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/llm/llm-adapter */ \"(rsc)/./lib/llm/llm-adapter.js\");\n/* harmony import */ var _lib_llm_guarded_client__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/llm/guarded-client */ \"(rsc)/./lib/llm/guarded-client.js\");\n/* harmony import */ var _lib_rag_report_generator__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/rag/report-generator */ \"(rsc)/./lib/rag/report-generator.js\");\n/* harmony import */ var module__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! module */ \"module\");\n// Production RAG endpoint with CAG Quality Layer\n\n\n\n\n\n\n// CAG Layer Integration\n\nconst require = (0,module__WEBPACK_IMPORTED_MODULE_6__.createRequire)(\"file:///C:/Users/SEELANGOV/Desktop/Thandi.ai/app/api/rag/query/route.js\");\nconst { CAGLayer } = require(\"../../../../lib/cag/index.cjs\");\n// Initialize CAG with monitoring\nconst cag = new CAGLayer();\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const { query, curriculumProfile, profile, session } = body;\n        // FIX: Accept both 'profile' and 'curriculumProfile' for backward compatibility\n        const studentProfile = curriculumProfile || profile || {};\n        // BLOCKER 2: Check consent first\n        const consentCheck = _lib_compliance_consent_gate__WEBPACK_IMPORTED_MODULE_1__.ConsentGate.checkConsent(session || {});\n        if (!consentCheck.allowed) {\n            console.log(\"[COMPLIANCE] No consent given, returning RAG-powered draft report\");\n            const reportData = await (0,_lib_rag_report_generator__WEBPACK_IMPORTED_MODULE_5__.generatePersonalizedReport)(studentProfile);\n            const draftReport = formatReportAsText(reportData, null);\n            return new Response(JSON.stringify({\n                success: true,\n                response: draftReport,\n                fullResponse: draftReport,\n                source: \"rag_draft\",\n                matchingMethod: reportData.matchingMethod,\n                compliance: {\n                    consent: false,\n                    reason: consentCheck.reason\n                }\n            }), {\n                status: 200,\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        }\n        // BLOCKER 1: Sanitise PII before any processing\n        const sanitiser = new _lib_compliance_popia_sanitiser__WEBPACK_IMPORTED_MODULE_2__.POPIASanitiser();\n        const sanitisedProfile = sanitiser.sanitiseProfile(studentProfile);\n        const sanitisedQuery = sanitiser.sanitiseReportText(query || \"\");\n        console.log(\"[COMPLIANCE] Profile sanitised, PII removed\");\n        // Get curriculum gate if profile provided\n        let gate = null;\n        if (sanitisedProfile && sanitisedProfile.subjects) {\n            gate = await (0,_lib_curriculum_query_gates_simple__WEBPACK_IMPORTED_MODULE_0__.getRelevantGate)(sanitisedProfile.grade || 10, sanitisedProfile.subjects || [], sanitisedQuery);\n        }\n        // Generate RAG-powered personalized report\n        console.log(\"[RAG] Generating personalized career report...\");\n        const reportData = await (0,_lib_rag_report_generator__WEBPACK_IMPORTED_MODULE_5__.generatePersonalizedReport)(sanitisedProfile);\n        const draftReport = formatReportAsText(reportData, gate);\n        console.log(`[RAG] Report generated: ${reportData.matchingMethod}, ${reportData.careers?.length || 0} careers`);\n        // BLOCKER 4: Get LLM provider via adapter\n        const provider = _lib_llm_llm_adapter__WEBPACK_IMPORTED_MODULE_3__.LLMAdapter.getDefaultProvider();\n        // BLOCKER 3: Use guarded client for external API call\n        const enhancementPrompt = buildEnhancementPrompt(sanitisedProfile, draftReport, gate);\n        const result = await _lib_llm_guarded_client__WEBPACK_IMPORTED_MODULE_4__.guardedClient.execute(async ()=>provider.generateText(enhancementPrompt), {\n            maxTokens: 3000,\n            fallback: draftReport\n        });\n        if (!result.success) {\n            console.log(\"[GUARDED] Enhancement failed, returning draft:\", result.error);\n            return new Response(JSON.stringify({\n                success: true,\n                response: draftReport,\n                fullResponse: draftReport,\n                source: \"draft\",\n                compliance: {\n                    consent: true,\n                    sanitised: true,\n                    enhanced: false,\n                    reason: result.error\n                }\n            }), {\n                status: 200,\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        }\n        console.log(\"[SUCCESS] Report enhanced via LLM\");\n        // CAG VERIFICATION - Verify LLM-enhanced answer\n        console.log(\"[CAG] Starting quality verification...\");\n        const cagStartTime = Date.now();\n        // Convert RAG chunks for CAG\n        const ragChunks = convertReportDataToChunks(reportData);\n        const cagResult = await cag.verify({\n            draftAnswer: result.data,\n            ragChunks: ragChunks,\n            studentProfile: sanitisedProfile,\n            query: sanitisedQuery,\n            ragDraft: draftReport,\n            options: {\n                skipLLMVerification: false,\n                strictMode: false\n            }\n        });\n        const cagProcessingTime = Date.now() - cagStartTime;\n        console.log(`[CAG] Verification complete: ${cagResult.decision} (${cagProcessingTime}ms)`);\n        // Log CAG decision details\n        if (cagResult.metadata.issuesDetected.length > 0) {\n            console.log(`[CAG] Issues detected: ${cagResult.metadata.issuesDetected.length}`);\n            cagResult.metadata.issuesDetected.forEach((issue)=>{\n                console.log(`  - ${issue.severity}: ${issue.type} - ${issue.problem}`);\n            });\n        }\n        if (cagResult.metadata.revisionsApplied.length > 0) {\n            console.log(`[CAG] Revisions applied: ${cagResult.metadata.revisionsApplied.length}`);\n        }\n        // Determine final source based on CAG decision\n        let finalSource = \"enhanced\";\n        if (cagResult.decision === \"fallback\") {\n            finalSource = \"draft_fallback\";\n        } else if (cagResult.decision === \"revised\") {\n            finalSource = \"enhanced_revised\";\n        } else if (cagResult.decision === \"rejected\") {\n            finalSource = \"draft_rejected\";\n        }\n        // Return CAG-verified response\n        return new Response(JSON.stringify({\n            success: true,\n            query: sanitisedQuery,\n            gate: gate,\n            response: cagResult.finalAnswer,\n            fullResponse: cagResult.finalAnswer,\n            source: finalSource,\n            compliance: {\n                consent: true,\n                sanitised: true,\n                enhanced: true,\n                cagVerified: true\n            },\n            cag: {\n                decision: cagResult.decision,\n                confidence: cagResult.metadata.confidence,\n                processingTime: cagResult.metadata.processingTime,\n                issuesDetected: cagResult.metadata.issuesDetected.length,\n                revisionsApplied: cagResult.metadata.revisionsApplied.length,\n                requiresHuman: cagResult.metadata.requiresHuman,\n                stagesCompleted: cagResult.metadata.stagesCompleted\n            },\n            metadata: result.metadata\n        }), {\n            status: 200,\n            headers: {\n                \"Content-Type\": \"application/json\"\n            }\n        });\n    } catch (error) {\n        return new Response(JSON.stringify({\n            success: false,\n            error: error.message\n        }), {\n            status: 500,\n            headers: {\n                \"Content-Type\": \"application/json\"\n            }\n        });\n    }\n}\nasync function GET() {\n    // Include CAG stats in health check\n    const stats = cag.getStats();\n    return new Response(JSON.stringify({\n        status: \"ok\",\n        endpoint: \"/api/rag/query\",\n        version: \"3.0.0-cag\",\n        blockers: [\n            \"consent\",\n            \"sanitiser\",\n            \"guarded-client\",\n            \"adapter\",\n            \"cag-layer\"\n        ],\n        cag: {\n            enabled: true,\n            stats: {\n                totalVerifications: stats.totalVerifications,\n                avgProcessingTime: Math.round(stats.avgProcessingTime) + \"ms\",\n                decisionDistribution: stats.decisionPercentages\n            }\n        }\n    }), {\n        status: 200,\n        headers: {\n            \"Content-Type\": \"application/json\"\n        }\n    });\n}\n// Helper: Convert report data to RAG chunks format\nfunction convertReportDataToChunks(reportData) {\n    const chunks = [];\n    // Convert each career to a chunk\n    reportData.careers?.forEach((career, index)=>{\n        chunks.push({\n            id: `career_${index}`,\n            chunk_text: `${career.title}: ${career.description}. Requirements: ${career.requirements}. Pathways: ${career.pathways.join(\", \")}. Salary: ${career.salaryRange}.`,\n            chunk_metadata: {\n                source: `career_${career.title.toLowerCase().replace(/\\s+/g, \"_\")}`,\n                category: \"career\",\n                career: career.title\n            },\n            similarity: career.match === \"excellent\" ? 0.95 : career.match === \"good\" ? 0.85 : 0.75\n        });\n    });\n    // Add guidance as a chunk\n    if (reportData.personalizedGuidance) {\n        chunks.push({\n            id: \"guidance\",\n            chunk_text: reportData.personalizedGuidance,\n            chunk_metadata: {\n                source: \"personalized_guidance\",\n                category: \"guidance\"\n            },\n            similarity: 1.0\n        });\n    }\n    return chunks;\n}\n// Helper: Format RAG report data as text\nfunction formatReportAsText(reportData, gate) {\n    let text = `### Your Personalized Career Matches\\n\\n`;\n    text += `${reportData.personalizedGuidance}\\n\\n`;\n    // Format each career\n    reportData.careers?.forEach((career, index)=>{\n        text += `**${index + 1}. ${career.title}** (${career.match} match)\\n`;\n        text += `- ${career.description}\\n`;\n        text += `- Requirements: ${career.requirements}\\n`;\n        text += `- Pathways: ${career.pathways.join(\", \")}\\n`;\n        text += `- Salary: ${career.salaryRange}\\n`;\n        if (career.demand) text += `- Demand: ${career.demand}\\n`;\n        text += `\\n`;\n    });\n    // Add curriculum gate if available\n    if (gate && gate.guidance) {\n        text += `### Curriculum Guidance\\n${gate.guidance}\\n\\n`;\n    }\n    // Add next steps\n    if (reportData.nextSteps && reportData.nextSteps.length > 0) {\n        text += `### Next Steps\\n\\n`;\n        reportData.nextSteps.forEach((step, index)=>{\n            text += `${index + 1}. ${step}\\n`;\n        });\n        text += `\\n`;\n    }\n    // Add resources\n    if (reportData.additionalResources && reportData.additionalResources.length > 0) {\n        text += `### Additional Resources\\n\\n`;\n        reportData.additionalResources.forEach((resource)=>{\n            text += `- ${resource}\\n`;\n        });\n        text += `\\n`;\n    }\n    // Add verification warning\n    text += `\\n⚠️ **Verify before you decide:**\\n`;\n    text += `1. Speak with your school counselor\\n`;\n    text += `2. Call the institution directly\\n`;\n    text += `3. Check official websites\\n\\n`;\n    text += `*Thandi's data may be outdated. Always confirm with real people.*`;\n    return text;\n}\n// Helper: Build enhancement prompt for LLM\nfunction buildEnhancementPrompt(profile, draftReport, gate) {\n    return `You are Thandi, a South African career counselor. Enhance this draft career report with personalized guidance.\r\n\r\nSTUDENT PROFILE (sanitised):\r\n- Grade: ${profile?.grade || \"unknown\"}\r\n- Subjects: ${profile?.subjects?.join(\", \") || \"not specified\"}\r\n- Math: ${profile?.mathMark || \"unknown\"}% (${profile?.mathType || \"unknown\"})\r\n- Province: ${profile?.province || \"unknown\"}\r\n- Budget: ${profile?.budgetLimit || \"unknown\"}\r\n\r\nDRAFT REPORT:\r\n${draftReport}\r\n\r\nYOUR TASK:\r\n1. Personalize the career recommendations based on the student's profile\r\n2. Add specific guidance for their grade level\r\n3. Mention NSFAS if budget is limited\r\n4. Keep the tone encouraging but realistic\r\n5. CRITICAL: You MUST include this exact warning at the end:\r\n\r\n⚠️ **Verify before you decide:**\r\n1. Speak with your school counselor\r\n2. Call the institution directly\r\n3. Check official websites\r\n\r\n*Thandi's data may be outdated. Always confirm with real people.*\r\n\r\nReturn the enhanced report as plain text (no JSON).`;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWtDLENBQUM7SUFDNUNBLFFBQVEsQ0FBQyw4QkFBOEIsQ0FBQztJQUN4Q0EsUUFBUSxDQUFDLGlFQUFpRSxDQUFDO0lBRTNFLE9BQU9BO0FBQ1Q7QUFFQSwyQ0FBMkM7QUFDM0MsU0FBU3hFLHVCQUF1QnJDLE9BQU8sRUFBRVMsV0FBVyxFQUFFb0IsSUFBSTtJQUN4RCxPQUFPLENBQUM7OztTQUdELEVBQUU3QixTQUFTK0IsU0FBUyxVQUFVO1lBQzNCLEVBQUUvQixTQUFTOEIsVUFBVXNFLEtBQUssU0FBUyxnQkFBZ0I7UUFDdkQsRUFBRXBHLFNBQVNvSCxZQUFZLFVBQVUsR0FBRyxFQUFFcEgsU0FBU3FILFlBQVksVUFBVTtZQUNqRSxFQUFFckgsU0FBU3NILFlBQVksVUFBVTtVQUNuQyxFQUFFdEgsU0FBU3VILGVBQWUsVUFBVTs7O0FBRzlDLEVBQUU5RyxZQUFZOzs7Ozs7Ozs7Ozs7Ozs7O21EQWdCcUMsQ0FBQztBQUNwRCIsInNvdXJjZXMiOlsid2VicGFjazovL3RoYW5kaS1yYWctc3lzdGVtLy4vYXBwL2FwaS9yYWcvcXVlcnkvcm91dGUuanM/ZmI1NiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBQcm9kdWN0aW9uIFJBRyBlbmRwb2ludCB3aXRoIENBRyBRdWFsaXR5IExheWVyXHJcbmltcG9ydCB7IGdldFJlbGV2YW50R2F0ZSB9IGZyb20gJ0AvbGliL2N1cnJpY3VsdW0vcXVlcnktZ2F0ZXMtc2ltcGxlJztcclxuaW1wb3J0IHsgQ29uc2VudEdhdGUgfSBmcm9tICdAL2xpYi9jb21wbGlhbmNlL2NvbnNlbnQtZ2F0ZSc7XHJcbmltcG9ydCB7IFBPUElBU2FuaXRpc2VyIH0gZnJvbSAnQC9saWIvY29tcGxpYW5jZS9wb3BpYS1zYW5pdGlzZXInO1xyXG5pbXBvcnQgeyBMTE1BZGFwdGVyIH0gZnJvbSAnQC9saWIvbGxtL2xsbS1hZGFwdGVyJztcclxuaW1wb3J0IHsgZ3VhcmRlZENsaWVudCB9IGZyb20gJ0AvbGliL2xsbS9ndWFyZGVkLWNsaWVudCc7XHJcbmltcG9ydCB7IGdlbmVyYXRlUGVyc29uYWxpemVkUmVwb3J0IH0gZnJvbSAnQC9saWIvcmFnL3JlcG9ydC1nZW5lcmF0b3InO1xyXG5cclxuLy8gQ0FHIExheWVyIEludGVncmF0aW9uXHJcbmltcG9ydCB7IGNyZWF0ZVJlcXVpcmUgfSBmcm9tICdtb2R1bGUnO1xyXG5jb25zdCByZXF1aXJlID0gY3JlYXRlUmVxdWlyZShpbXBvcnQubWV0YS51cmwpO1xyXG5jb25zdCB7IENBR0xheWVyIH0gPSByZXF1aXJlKCcuLi8uLi8uLi8uLi9saWIvY2FnL2luZGV4LmNqcycpO1xyXG5cclxuLy8gSW5pdGlhbGl6ZSBDQUcgd2l0aCBtb25pdG9yaW5nXHJcbmNvbnN0IGNhZyA9IG5ldyBDQUdMYXllcigpO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICBjb25zdCB7IHF1ZXJ5LCBjdXJyaWN1bHVtUHJvZmlsZSwgcHJvZmlsZSwgc2Vzc2lvbiB9ID0gYm9keTtcclxuICAgIFxyXG4gICAgLy8gRklYOiBBY2NlcHQgYm90aCAncHJvZmlsZScgYW5kICdjdXJyaWN1bHVtUHJvZmlsZScgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcclxuICAgIGNvbnN0IHN0dWRlbnRQcm9maWxlID0gY3VycmljdWx1bVByb2ZpbGUgfHwgcHJvZmlsZSB8fCB7fTtcclxuXHJcbiAgICAvLyBCTE9DS0VSIDI6IENoZWNrIGNvbnNlbnQgZmlyc3RcclxuICAgIGNvbnN0IGNvbnNlbnRDaGVjayA9IENvbnNlbnRHYXRlLmNoZWNrQ29uc2VudChzZXNzaW9uIHx8IHt9KTtcclxuICAgIFxyXG4gICAgaWYgKCFjb25zZW50Q2hlY2suYWxsb3dlZCkge1xyXG4gICAgICBjb25zb2xlLmxvZygnW0NPTVBMSUFOQ0VdIE5vIGNvbnNlbnQgZ2l2ZW4sIHJldHVybmluZyBSQUctcG93ZXJlZCBkcmFmdCByZXBvcnQnKTtcclxuICAgICAgY29uc3QgcmVwb3J0RGF0YSA9IGF3YWl0IGdlbmVyYXRlUGVyc29uYWxpemVkUmVwb3J0KHN0dWRlbnRQcm9maWxlKTtcclxuICAgICAgY29uc3QgZHJhZnRSZXBvcnQgPSBmb3JtYXRSZXBvcnRBc1RleHQocmVwb3J0RGF0YSwgbnVsbCk7XHJcbiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgcmVzcG9uc2U6IGRyYWZ0UmVwb3J0LFxyXG4gICAgICAgIGZ1bGxSZXNwb25zZTogZHJhZnRSZXBvcnQsXHJcbiAgICAgICAgc291cmNlOiAncmFnX2RyYWZ0JyxcclxuICAgICAgICBtYXRjaGluZ01ldGhvZDogcmVwb3J0RGF0YS5tYXRjaGluZ01ldGhvZCxcclxuICAgICAgICBjb21wbGlhbmNlOiB7XHJcbiAgICAgICAgICBjb25zZW50OiBmYWxzZSxcclxuICAgICAgICAgIHJlYXNvbjogY29uc2VudENoZWNrLnJlYXNvblxyXG4gICAgICAgIH1cclxuICAgICAgfSksIHtcclxuICAgICAgICBzdGF0dXM6IDIwMCxcclxuICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBCTE9DS0VSIDE6IFNhbml0aXNlIFBJSSBiZWZvcmUgYW55IHByb2Nlc3NpbmdcclxuICAgIGNvbnN0IHNhbml0aXNlciA9IG5ldyBQT1BJQVNhbml0aXNlcigpO1xyXG4gICAgY29uc3Qgc2FuaXRpc2VkUHJvZmlsZSA9IHNhbml0aXNlci5zYW5pdGlzZVByb2ZpbGUoc3R1ZGVudFByb2ZpbGUpO1xyXG4gICAgY29uc3Qgc2FuaXRpc2VkUXVlcnkgPSBzYW5pdGlzZXIuc2FuaXRpc2VSZXBvcnRUZXh0KHF1ZXJ5IHx8ICcnKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnW0NPTVBMSUFOQ0VdIFByb2ZpbGUgc2FuaXRpc2VkLCBQSUkgcmVtb3ZlZCcpO1xyXG5cclxuICAgIC8vIEdldCBjdXJyaWN1bHVtIGdhdGUgaWYgcHJvZmlsZSBwcm92aWRlZFxyXG4gICAgbGV0IGdhdGUgPSBudWxsO1xyXG4gICAgaWYgKHNhbml0aXNlZFByb2ZpbGUgJiYgc2FuaXRpc2VkUHJvZmlsZS5zdWJqZWN0cykge1xyXG4gICAgICBnYXRlID0gYXdhaXQgZ2V0UmVsZXZhbnRHYXRlKFxyXG4gICAgICAgIHNhbml0aXNlZFByb2ZpbGUuZ3JhZGUgfHwgMTAsXHJcbiAgICAgICAgc2FuaXRpc2VkUHJvZmlsZS5zdWJqZWN0cyB8fCBbXSxcclxuICAgICAgICBzYW5pdGlzZWRRdWVyeVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIFJBRy1wb3dlcmVkIHBlcnNvbmFsaXplZCByZXBvcnRcclxuICAgIGNvbnNvbGUubG9nKCdbUkFHXSBHZW5lcmF0aW5nIHBlcnNvbmFsaXplZCBjYXJlZXIgcmVwb3J0Li4uJyk7XHJcbiAgICBjb25zdCByZXBvcnREYXRhID0gYXdhaXQgZ2VuZXJhdGVQZXJzb25hbGl6ZWRSZXBvcnQoc2FuaXRpc2VkUHJvZmlsZSk7XHJcbiAgICBjb25zdCBkcmFmdFJlcG9ydCA9IGZvcm1hdFJlcG9ydEFzVGV4dChyZXBvcnREYXRhLCBnYXRlKTtcclxuICAgIGNvbnNvbGUubG9nKGBbUkFHXSBSZXBvcnQgZ2VuZXJhdGVkOiAke3JlcG9ydERhdGEubWF0Y2hpbmdNZXRob2R9LCAke3JlcG9ydERhdGEuY2FyZWVycz8ubGVuZ3RoIHx8IDB9IGNhcmVlcnNgKTtcclxuXHJcbiAgICAvLyBCTE9DS0VSIDQ6IEdldCBMTE0gcHJvdmlkZXIgdmlhIGFkYXB0ZXJcclxuICAgIGNvbnN0IHByb3ZpZGVyID0gTExNQWRhcHRlci5nZXREZWZhdWx0UHJvdmlkZXIoKTtcclxuXHJcbiAgICAvLyBCTE9DS0VSIDM6IFVzZSBndWFyZGVkIGNsaWVudCBmb3IgZXh0ZXJuYWwgQVBJIGNhbGxcclxuICAgIGNvbnN0IGVuaGFuY2VtZW50UHJvbXB0ID0gYnVpbGRFbmhhbmNlbWVudFByb21wdChzYW5pdGlzZWRQcm9maWxlLCBkcmFmdFJlcG9ydCwgZ2F0ZSk7XHJcbiAgICBcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGd1YXJkZWRDbGllbnQuZXhlY3V0ZShcclxuICAgICAgYXN5bmMgKCkgPT4gcHJvdmlkZXIuZ2VuZXJhdGVUZXh0KGVuaGFuY2VtZW50UHJvbXB0KSxcclxuICAgICAgeyBcclxuICAgICAgICBtYXhUb2tlbnM6IDMwMDAsXHJcbiAgICAgICAgZmFsbGJhY2s6IGRyYWZ0UmVwb3J0XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICBjb25zb2xlLmxvZygnW0dVQVJERURdIEVuaGFuY2VtZW50IGZhaWxlZCwgcmV0dXJuaW5nIGRyYWZ0OicsIHJlc3VsdC5lcnJvcik7XHJcbiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgcmVzcG9uc2U6IGRyYWZ0UmVwb3J0LFxyXG4gICAgICAgIGZ1bGxSZXNwb25zZTogZHJhZnRSZXBvcnQsXHJcbiAgICAgICAgc291cmNlOiAnZHJhZnQnLFxyXG4gICAgICAgIGNvbXBsaWFuY2U6IHtcclxuICAgICAgICAgIGNvbnNlbnQ6IHRydWUsXHJcbiAgICAgICAgICBzYW5pdGlzZWQ6IHRydWUsXHJcbiAgICAgICAgICBlbmhhbmNlZDogZmFsc2UsXHJcbiAgICAgICAgICByZWFzb246IHJlc3VsdC5lcnJvclxyXG4gICAgICAgIH1cclxuICAgICAgfSksIHtcclxuICAgICAgICBzdGF0dXM6IDIwMCxcclxuICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZygnW1NVQ0NFU1NdIFJlcG9ydCBlbmhhbmNlZCB2aWEgTExNJyk7XHJcblxyXG4gICAgLy8gQ0FHIFZFUklGSUNBVElPTiAtIFZlcmlmeSBMTE0tZW5oYW5jZWQgYW5zd2VyXHJcbiAgICBjb25zb2xlLmxvZygnW0NBR10gU3RhcnRpbmcgcXVhbGl0eSB2ZXJpZmljYXRpb24uLi4nKTtcclxuICAgIGNvbnN0IGNhZ1N0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgICBcclxuICAgIC8vIENvbnZlcnQgUkFHIGNodW5rcyBmb3IgQ0FHXHJcbiAgICBjb25zdCByYWdDaHVua3MgPSBjb252ZXJ0UmVwb3J0RGF0YVRvQ2h1bmtzKHJlcG9ydERhdGEpO1xyXG4gICAgXHJcbiAgICBjb25zdCBjYWdSZXN1bHQgPSBhd2FpdCBjYWcudmVyaWZ5KHtcclxuICAgICAgZHJhZnRBbnN3ZXI6IHJlc3VsdC5kYXRhLFxyXG4gICAgICByYWdDaHVua3M6IHJhZ0NodW5rcyxcclxuICAgICAgc3R1ZGVudFByb2ZpbGU6IHNhbml0aXNlZFByb2ZpbGUsXHJcbiAgICAgIHF1ZXJ5OiBzYW5pdGlzZWRRdWVyeSxcclxuICAgICAgcmFnRHJhZnQ6IGRyYWZ0UmVwb3J0LFxyXG4gICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgc2tpcExMTVZlcmlmaWNhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgc3RyaWN0TW9kZTogZmFsc2VcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgY2FnUHJvY2Vzc2luZ1RpbWUgPSBEYXRlLm5vdygpIC0gY2FnU3RhcnRUaW1lO1xyXG4gICAgY29uc29sZS5sb2coYFtDQUddIFZlcmlmaWNhdGlvbiBjb21wbGV0ZTogJHtjYWdSZXN1bHQuZGVjaXNpb259ICgke2NhZ1Byb2Nlc3NpbmdUaW1lfW1zKWApO1xyXG5cclxuICAgIC8vIExvZyBDQUcgZGVjaXNpb24gZGV0YWlsc1xyXG4gICAgaWYgKGNhZ1Jlc3VsdC5tZXRhZGF0YS5pc3N1ZXNEZXRlY3RlZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQ0FHXSBJc3N1ZXMgZGV0ZWN0ZWQ6ICR7Y2FnUmVzdWx0Lm1ldGFkYXRhLmlzc3Vlc0RldGVjdGVkLmxlbmd0aH1gKTtcclxuICAgICAgY2FnUmVzdWx0Lm1ldGFkYXRhLmlzc3Vlc0RldGVjdGVkLmZvckVhY2goaXNzdWUgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGAgIC0gJHtpc3N1ZS5zZXZlcml0eX06ICR7aXNzdWUudHlwZX0gLSAke2lzc3VlLnByb2JsZW19YCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChjYWdSZXN1bHQubWV0YWRhdGEucmV2aXNpb25zQXBwbGllZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQ0FHXSBSZXZpc2lvbnMgYXBwbGllZDogJHtjYWdSZXN1bHQubWV0YWRhdGEucmV2aXNpb25zQXBwbGllZC5sZW5ndGh9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRGV0ZXJtaW5lIGZpbmFsIHNvdXJjZSBiYXNlZCBvbiBDQUcgZGVjaXNpb25cclxuICAgIGxldCBmaW5hbFNvdXJjZSA9ICdlbmhhbmNlZCc7XHJcbiAgICBpZiAoY2FnUmVzdWx0LmRlY2lzaW9uID09PSAnZmFsbGJhY2snKSB7XHJcbiAgICAgIGZpbmFsU291cmNlID0gJ2RyYWZ0X2ZhbGxiYWNrJztcclxuICAgIH0gZWxzZSBpZiAoY2FnUmVzdWx0LmRlY2lzaW9uID09PSAncmV2aXNlZCcpIHtcclxuICAgICAgZmluYWxTb3VyY2UgPSAnZW5oYW5jZWRfcmV2aXNlZCc7XHJcbiAgICB9IGVsc2UgaWYgKGNhZ1Jlc3VsdC5kZWNpc2lvbiA9PT0gJ3JlamVjdGVkJykge1xyXG4gICAgICBmaW5hbFNvdXJjZSA9ICdkcmFmdF9yZWplY3RlZCc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmV0dXJuIENBRy12ZXJpZmllZCByZXNwb25zZVxyXG4gICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIHF1ZXJ5OiBzYW5pdGlzZWRRdWVyeSxcclxuICAgICAgZ2F0ZTogZ2F0ZSxcclxuICAgICAgcmVzcG9uc2U6IGNhZ1Jlc3VsdC5maW5hbEFuc3dlcixcclxuICAgICAgZnVsbFJlc3BvbnNlOiBjYWdSZXN1bHQuZmluYWxBbnN3ZXIsXHJcbiAgICAgIHNvdXJjZTogZmluYWxTb3VyY2UsXHJcbiAgICAgIGNvbXBsaWFuY2U6IHtcclxuICAgICAgICBjb25zZW50OiB0cnVlLFxyXG4gICAgICAgIHNhbml0aXNlZDogdHJ1ZSxcclxuICAgICAgICBlbmhhbmNlZDogdHJ1ZSxcclxuICAgICAgICBjYWdWZXJpZmllZDogdHJ1ZVxyXG4gICAgICB9LFxyXG4gICAgICBjYWc6IHtcclxuICAgICAgICBkZWNpc2lvbjogY2FnUmVzdWx0LmRlY2lzaW9uLFxyXG4gICAgICAgIGNvbmZpZGVuY2U6IGNhZ1Jlc3VsdC5tZXRhZGF0YS5jb25maWRlbmNlLFxyXG4gICAgICAgIHByb2Nlc3NpbmdUaW1lOiBjYWdSZXN1bHQubWV0YWRhdGEucHJvY2Vzc2luZ1RpbWUsXHJcbiAgICAgICAgaXNzdWVzRGV0ZWN0ZWQ6IGNhZ1Jlc3VsdC5tZXRhZGF0YS5pc3N1ZXNEZXRlY3RlZC5sZW5ndGgsXHJcbiAgICAgICAgcmV2aXNpb25zQXBwbGllZDogY2FnUmVzdWx0Lm1ldGFkYXRhLnJldmlzaW9uc0FwcGxpZWQubGVuZ3RoLFxyXG4gICAgICAgIHJlcXVpcmVzSHVtYW46IGNhZ1Jlc3VsdC5tZXRhZGF0YS5yZXF1aXJlc0h1bWFuLFxyXG4gICAgICAgIHN0YWdlc0NvbXBsZXRlZDogY2FnUmVzdWx0Lm1ldGFkYXRhLnN0YWdlc0NvbXBsZXRlZFxyXG4gICAgICB9LFxyXG4gICAgICBtZXRhZGF0YTogcmVzdWx0Lm1ldGFkYXRhXHJcbiAgICB9KSwge1xyXG4gICAgICBzdGF0dXM6IDIwMCxcclxuICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH1cclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFxyXG4gICAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcclxuICAgICAgfSksXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAsIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9IH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKCkge1xyXG4gIC8vIEluY2x1ZGUgQ0FHIHN0YXRzIGluIGhlYWx0aCBjaGVja1xyXG4gIGNvbnN0IHN0YXRzID0gY2FnLmdldFN0YXRzKCk7XHJcbiAgXHJcbiAgcmV0dXJuIG5ldyBSZXNwb25zZShcclxuICAgIEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgc3RhdHVzOiAnb2snLFxyXG4gICAgICBlbmRwb2ludDogJy9hcGkvcmFnL3F1ZXJ5JyxcclxuICAgICAgdmVyc2lvbjogJzMuMC4wLWNhZycsXHJcbiAgICAgIGJsb2NrZXJzOiBbJ2NvbnNlbnQnLCAnc2FuaXRpc2VyJywgJ2d1YXJkZWQtY2xpZW50JywgJ2FkYXB0ZXInLCAnY2FnLWxheWVyJ10sXHJcbiAgICAgIGNhZzoge1xyXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgc3RhdHM6IHtcclxuICAgICAgICAgIHRvdGFsVmVyaWZpY2F0aW9uczogc3RhdHMudG90YWxWZXJpZmljYXRpb25zLFxyXG4gICAgICAgICAgYXZnUHJvY2Vzc2luZ1RpbWU6IE1hdGgucm91bmQoc3RhdHMuYXZnUHJvY2Vzc2luZ1RpbWUpICsgJ21zJyxcclxuICAgICAgICAgIGRlY2lzaW9uRGlzdHJpYnV0aW9uOiBzdGF0cy5kZWNpc2lvblBlcmNlbnRhZ2VzXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KSxcclxuICAgIHsgc3RhdHVzOiAyMDAsIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9IH1cclxuICApO1xyXG59XHJcblxyXG4vLyBIZWxwZXI6IENvbnZlcnQgcmVwb3J0IGRhdGEgdG8gUkFHIGNodW5rcyBmb3JtYXRcclxuZnVuY3Rpb24gY29udmVydFJlcG9ydERhdGFUb0NodW5rcyhyZXBvcnREYXRhKSB7XHJcbiAgY29uc3QgY2h1bmtzID0gW107XHJcbiAgXHJcbiAgLy8gQ29udmVydCBlYWNoIGNhcmVlciB0byBhIGNodW5rXHJcbiAgcmVwb3J0RGF0YS5jYXJlZXJzPy5mb3JFYWNoKChjYXJlZXIsIGluZGV4KSA9PiB7XHJcbiAgICBjaHVua3MucHVzaCh7XHJcbiAgICAgIGlkOiBgY2FyZWVyXyR7aW5kZXh9YCxcclxuICAgICAgY2h1bmtfdGV4dDogYCR7Y2FyZWVyLnRpdGxlfTogJHtjYXJlZXIuZGVzY3JpcHRpb259LiBSZXF1aXJlbWVudHM6ICR7Y2FyZWVyLnJlcXVpcmVtZW50c30uIFBhdGh3YXlzOiAke2NhcmVlci5wYXRod2F5cy5qb2luKCcsICcpfS4gU2FsYXJ5OiAke2NhcmVlci5zYWxhcnlSYW5nZX0uYCxcclxuICAgICAgY2h1bmtfbWV0YWRhdGE6IHtcclxuICAgICAgICBzb3VyY2U6IGBjYXJlZXJfJHtjYXJlZXIudGl0bGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9cXHMrL2csICdfJyl9YCxcclxuICAgICAgICBjYXRlZ29yeTogJ2NhcmVlcicsXHJcbiAgICAgICAgY2FyZWVyOiBjYXJlZXIudGl0bGVcclxuICAgICAgfSxcclxuICAgICAgc2ltaWxhcml0eTogY2FyZWVyLm1hdGNoID09PSAnZXhjZWxsZW50JyA/IDAuOTUgOiBjYXJlZXIubWF0Y2ggPT09ICdnb29kJyA/IDAuODUgOiAwLjc1XHJcbiAgICB9KTtcclxuICB9KTtcclxuICBcclxuICAvLyBBZGQgZ3VpZGFuY2UgYXMgYSBjaHVua1xyXG4gIGlmIChyZXBvcnREYXRhLnBlcnNvbmFsaXplZEd1aWRhbmNlKSB7XHJcbiAgICBjaHVua3MucHVzaCh7XHJcbiAgICAgIGlkOiAnZ3VpZGFuY2UnLFxyXG4gICAgICBjaHVua190ZXh0OiByZXBvcnREYXRhLnBlcnNvbmFsaXplZEd1aWRhbmNlLFxyXG4gICAgICBjaHVua19tZXRhZGF0YToge1xyXG4gICAgICAgIHNvdXJjZTogJ3BlcnNvbmFsaXplZF9ndWlkYW5jZScsXHJcbiAgICAgICAgY2F0ZWdvcnk6ICdndWlkYW5jZSdcclxuICAgICAgfSxcclxuICAgICAgc2ltaWxhcml0eTogMS4wXHJcbiAgICB9KTtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIGNodW5rcztcclxufVxyXG5cclxuLy8gSGVscGVyOiBGb3JtYXQgUkFHIHJlcG9ydCBkYXRhIGFzIHRleHRcclxuZnVuY3Rpb24gZm9ybWF0UmVwb3J0QXNUZXh0KHJlcG9ydERhdGEsIGdhdGUpIHtcclxuICBsZXQgdGV4dCA9IGAjIyMgWW91ciBQZXJzb25hbGl6ZWQgQ2FyZWVyIE1hdGNoZXNcXG5cXG5gO1xyXG4gIHRleHQgKz0gYCR7cmVwb3J0RGF0YS5wZXJzb25hbGl6ZWRHdWlkYW5jZX1cXG5cXG5gO1xyXG4gIFxyXG4gIC8vIEZvcm1hdCBlYWNoIGNhcmVlclxyXG4gIHJlcG9ydERhdGEuY2FyZWVycz8uZm9yRWFjaCgoY2FyZWVyLCBpbmRleCkgPT4ge1xyXG4gICAgdGV4dCArPSBgKioke2luZGV4ICsgMX0uICR7Y2FyZWVyLnRpdGxlfSoqICgke2NhcmVlci5tYXRjaH0gbWF0Y2gpXFxuYDtcclxuICAgIHRleHQgKz0gYC0gJHtjYXJlZXIuZGVzY3JpcHRpb259XFxuYDtcclxuICAgIHRleHQgKz0gYC0gUmVxdWlyZW1lbnRzOiAke2NhcmVlci5yZXF1aXJlbWVudHN9XFxuYDtcclxuICAgIHRleHQgKz0gYC0gUGF0aHdheXM6ICR7Y2FyZWVyLnBhdGh3YXlzLmpvaW4oJywgJyl9XFxuYDtcclxuICAgIHRleHQgKz0gYC0gU2FsYXJ5OiAke2NhcmVlci5zYWxhcnlSYW5nZX1cXG5gO1xyXG4gICAgaWYgKGNhcmVlci5kZW1hbmQpIHRleHQgKz0gYC0gRGVtYW5kOiAke2NhcmVlci5kZW1hbmR9XFxuYDtcclxuICAgIHRleHQgKz0gYFxcbmA7XHJcbiAgfSk7XHJcbiAgXHJcbiAgLy8gQWRkIGN1cnJpY3VsdW0gZ2F0ZSBpZiBhdmFpbGFibGVcclxuICBpZiAoZ2F0ZSAmJiBnYXRlLmd1aWRhbmNlKSB7XHJcbiAgICB0ZXh0ICs9IGAjIyMgQ3VycmljdWx1bSBHdWlkYW5jZVxcbiR7Z2F0ZS5ndWlkYW5jZX1cXG5cXG5gO1xyXG4gIH1cclxuICBcclxuICAvLyBBZGQgbmV4dCBzdGVwc1xyXG4gIGlmIChyZXBvcnREYXRhLm5leHRTdGVwcyAmJiByZXBvcnREYXRhLm5leHRTdGVwcy5sZW5ndGggPiAwKSB7XHJcbiAgICB0ZXh0ICs9IGAjIyMgTmV4dCBTdGVwc1xcblxcbmA7XHJcbiAgICByZXBvcnREYXRhLm5leHRTdGVwcy5mb3JFYWNoKChzdGVwLCBpbmRleCkgPT4ge1xyXG4gICAgICB0ZXh0ICs9IGAke2luZGV4ICsgMX0uICR7c3RlcH1cXG5gO1xyXG4gICAgfSk7XHJcbiAgICB0ZXh0ICs9IGBcXG5gO1xyXG4gIH1cclxuICBcclxuICAvLyBBZGQgcmVzb3VyY2VzXHJcbiAgaWYgKHJlcG9ydERhdGEuYWRkaXRpb25hbFJlc291cmNlcyAmJiByZXBvcnREYXRhLmFkZGl0aW9uYWxSZXNvdXJjZXMubGVuZ3RoID4gMCkge1xyXG4gICAgdGV4dCArPSBgIyMjIEFkZGl0aW9uYWwgUmVzb3VyY2VzXFxuXFxuYDtcclxuICAgIHJlcG9ydERhdGEuYWRkaXRpb25hbFJlc291cmNlcy5mb3JFYWNoKChyZXNvdXJjZSkgPT4ge1xyXG4gICAgICB0ZXh0ICs9IGAtICR7cmVzb3VyY2V9XFxuYDtcclxuICAgIH0pO1xyXG4gICAgdGV4dCArPSBgXFxuYDtcclxuICB9XHJcbiAgXHJcbiAgLy8gQWRkIHZlcmlmaWNhdGlvbiB3YXJuaW5nXHJcbiAgdGV4dCArPSBgXFxu4pqg77iPICoqVmVyaWZ5IGJlZm9yZSB5b3UgZGVjaWRlOioqXFxuYDtcclxuICB0ZXh0ICs9IGAxLiBTcGVhayB3aXRoIHlvdXIgc2Nob29sIGNvdW5zZWxvclxcbmA7XHJcbiAgdGV4dCArPSBgMi4gQ2FsbCB0aGUgaW5zdGl0dXRpb24gZGlyZWN0bHlcXG5gO1xyXG4gIHRleHQgKz0gYDMuIENoZWNrIG9mZmljaWFsIHdlYnNpdGVzXFxuXFxuYDtcclxuICB0ZXh0ICs9IGAqVGhhbmRpJ3MgZGF0YSBtYXkgYmUgb3V0ZGF0ZWQuIEFsd2F5cyBjb25maXJtIHdpdGggcmVhbCBwZW9wbGUuKmA7XHJcbiAgXHJcbiAgcmV0dXJuIHRleHQ7XHJcbn1cclxuXHJcbi8vIEhlbHBlcjogQnVpbGQgZW5oYW5jZW1lbnQgcHJvbXB0IGZvciBMTE1cclxuZnVuY3Rpb24gYnVpbGRFbmhhbmNlbWVudFByb21wdChwcm9maWxlLCBkcmFmdFJlcG9ydCwgZ2F0ZSkge1xyXG4gIHJldHVybiBgWW91IGFyZSBUaGFuZGksIGEgU291dGggQWZyaWNhbiBjYXJlZXIgY291bnNlbG9yLiBFbmhhbmNlIHRoaXMgZHJhZnQgY2FyZWVyIHJlcG9ydCB3aXRoIHBlcnNvbmFsaXplZCBndWlkYW5jZS5cclxuXHJcblNUVURFTlQgUFJPRklMRSAoc2FuaXRpc2VkKTpcclxuLSBHcmFkZTogJHtwcm9maWxlPy5ncmFkZSB8fCAndW5rbm93bid9XHJcbi0gU3ViamVjdHM6ICR7cHJvZmlsZT8uc3ViamVjdHM/LmpvaW4oJywgJykgfHwgJ25vdCBzcGVjaWZpZWQnfVxyXG4tIE1hdGg6ICR7cHJvZmlsZT8ubWF0aE1hcmsgfHwgJ3Vua25vd24nfSUgKCR7cHJvZmlsZT8ubWF0aFR5cGUgfHwgJ3Vua25vd24nfSlcclxuLSBQcm92aW5jZTogJHtwcm9maWxlPy5wcm92aW5jZSB8fCAndW5rbm93bid9XHJcbi0gQnVkZ2V0OiAke3Byb2ZpbGU/LmJ1ZGdldExpbWl0IHx8ICd1bmtub3duJ31cclxuXHJcbkRSQUZUIFJFUE9SVDpcclxuJHtkcmFmdFJlcG9ydH1cclxuXHJcbllPVVIgVEFTSzpcclxuMS4gUGVyc29uYWxpemUgdGhlIGNhcmVlciByZWNvbW1lbmRhdGlvbnMgYmFzZWQgb24gdGhlIHN0dWRlbnQncyBwcm9maWxlXHJcbjIuIEFkZCBzcGVjaWZpYyBndWlkYW5jZSBmb3IgdGhlaXIgZ3JhZGUgbGV2ZWxcclxuMy4gTWVudGlvbiBOU0ZBUyBpZiBidWRnZXQgaXMgbGltaXRlZFxyXG40LiBLZWVwIHRoZSB0b25lIGVuY291cmFnaW5nIGJ1dCByZWFsaXN0aWNcclxuNS4gQ1JJVElDQUw6IFlvdSBNVVNUIGluY2x1ZGUgdGhpcyBleGFjdCB3YXJuaW5nIGF0IHRoZSBlbmQ6XHJcblxyXG7imqDvuI8gKipWZXJpZnkgYmVmb3JlIHlvdSBkZWNpZGU6KipcclxuMS4gU3BlYWsgd2l0aCB5b3VyIHNjaG9vbCBjb3Vuc2Vsb3JcclxuMi4gQ2FsbCB0aGUgaW5zdGl0dXRpb24gZGlyZWN0bHlcclxuMy4gQ2hlY2sgb2ZmaWNpYWwgd2Vic2l0ZXNcclxuXHJcbipUaGFuZGkncyBkYXRhIG1heSBiZSBvdXRkYXRlZC4gQWx3YXlzIGNvbmZpcm0gd2l0aCByZWFsIHBlb3BsZS4qXHJcblxyXG5SZXR1cm4gdGhlIGVuaGFuY2VkIHJlcG9ydCBhcyBwbGFpbiB0ZXh0IChubyBKU09OKS5gO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJnZXRSZWxldmFudEdhdGUiLCJDb25zZW50R2F0ZSIsIlBPUElBU2FuaXRpc2VyIiwiTExNQWRhcHRlciIsImd1YXJkZWRDbGllbnQiLCJnZW5lcmF0ZVBlcnNvbmFsaXplZFJlcG9ydCIsImNyZWF0ZVJlcXVpcmUiLCJyZXF1aXJlIiwidXJsIiwiQ0FHTGF5ZXIiLCJjYWciLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJqc29uIiwicXVlcnkiLCJjdXJyaWN1bHVtUHJvZmlsZSIsInByb2ZpbGUiLCJzZXNzaW9uIiwic3R1ZGVudFByb2ZpbGUiLCJjb25zZW50Q2hlY2siLCJjaGVja0NvbnNlbnQiLCJhbGxvd2VkIiwiY29uc29sZSIsImxvZyIsInJlcG9ydERhdGEiLCJkcmFmdFJlcG9ydCIsImZvcm1hdFJlcG9ydEFzVGV4dCIsIlJlc3BvbnNlIiwiSlNPTiIsInN0cmluZ2lmeSIsInN1Y2Nlc3MiLCJyZXNwb25zZSIsImZ1bGxSZXNwb25zZSIsInNvdXJjZSIsIm1hdGNoaW5nTWV0aG9kIiwiY29tcGxpYW5jZSIsImNvbnNlbnQiLCJyZWFzb24iLCJzdGF0dXMiLCJoZWFkZXJzIiwic2FuaXRpc2VyIiwic2FuaXRpc2VkUHJvZmlsZSIsInNhbml0aXNlUHJvZmlsZSIsInNhbml0aXNlZFF1ZXJ5Iiwic2FuaXRpc2VSZXBvcnRUZXh0IiwiZ2F0ZSIsInN1YmplY3RzIiwiZ3JhZGUiLCJjYXJlZXJzIiwibGVuZ3RoIiwicHJvdmlkZXIiLCJnZXREZWZhdWx0UHJvdmlkZXIiLCJlbmhhbmNlbWVudFByb21wdCIsImJ1aWxkRW5oYW5jZW1lbnRQcm9tcHQiLCJyZXN1bHQiLCJleGVjdXRlIiwiZ2VuZXJhdGVUZXh0IiwibWF4VG9rZW5zIiwiZmFsbGJhY2siLCJlcnJvciIsInNhbml0aXNlZCIsImVuaGFuY2VkIiwiY2FnU3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsInJhZ0NodW5rcyIsImNvbnZlcnRSZXBvcnREYXRhVG9DaHVua3MiLCJjYWdSZXN1bHQiLCJ2ZXJpZnkiLCJkcmFmdEFuc3dlciIsImRhdGEiLCJyYWdEcmFmdCIsIm9wdGlvbnMiLCJza2lwTExNVmVyaWZpY2F0aW9uIiwic3RyaWN0TW9kZSIsImNhZ1Byb2Nlc3NpbmdUaW1lIiwiZGVjaXNpb24iLCJtZXRhZGF0YSIsImlzc3Vlc0RldGVjdGVkIiwiZm9yRWFjaCIsImlzc3VlIiwic2V2ZXJpdHkiLCJ0eXBlIiwicHJvYmxlbSIsInJldmlzaW9uc0FwcGxpZWQiLCJmaW5hbFNvdXJjZSIsImZpbmFsQW5zd2VyIiwiY2FnVmVyaWZpZWQiLCJjb25maWRlbmNlIiwicHJvY2Vzc2luZ1RpbWUiLCJyZXF1aXJlc0h1bWFuIiwic3RhZ2VzQ29tcGxldGVkIiwibWVzc2FnZSIsIkdFVCIsInN0YXRzIiwiZ2V0U3RhdHMiLCJlbmRwb2ludCIsInZlcnNpb24iLCJibG9ja2VycyIsImVuYWJsZWQiLCJ0b3RhbFZlcmlmaWNhdGlvbnMiLCJhdmdQcm9jZXNzaW5nVGltZSIsIk1hdGgiLCJyb3VuZCIsImRlY2lzaW9uRGlzdHJpYnV0aW9uIiwiZGVjaXNpb25QZXJjZW50YWdlcyIsImNodW5rcyIsImNhcmVlciIsImluZGV4IiwicHVzaCIsImlkIiwiY2h1bmtfdGV4dCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJyZXF1aXJlbWVudHMiLCJwYXRod2F5cyIsImpvaW4iLCJzYWxhcnlSYW5nZSIsImNodW5rX21ldGFkYXRhIiwidG9Mb3dlckNhc2UiLCJyZXBsYWNlIiwiY2F0ZWdvcnkiLCJzaW1pbGFyaXR5IiwibWF0Y2giLCJwZXJzb25hbGl6ZWRHdWlkYW5jZSIsInRleHQiLCJkZW1hbmQiLCJndWlkYW5jZSIsIm5leHRTdGVwcyIsInN0ZXAiLCJhZGRpdGlvbmFsUmVzb3VyY2VzIiwicmVzb3VyY2UiLCJtYXRoTWFyayIsIm1hdGhUeXBlIiwicHJvdmluY2UiLCJidWRnZXRMaW1pdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/rag/query/route.js\n");

/***/ }),

/***/ "(rsc)/./lib/compliance/consent-gate.js":
/*!****************************************!*\
  !*** ./lib/compliance/consent-gate.js ***!
  \****************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ConsentError: () => (/* binding */ ConsentError),\n/* harmony export */   ConsentGate: () => (/* binding */ ConsentGate)\n/* harmony export */ });\n/* harmony import */ var _popia_audit_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./popia-audit.js */ \"(rsc)/./lib/compliance/popia-audit.js\");\n// Consent Gate - Explicit opt-in for external data processing\n// Required by POPIA Section 11 (Consent) and school DPAs\n\nclass ConsentGate {\n    /**\r\n   * Check if user has given consent for external processing\r\n   * @param {Object} session - User session with consent status\r\n   * @returns {Object} - Consent check result\r\n   */ static checkConsent(session) {\n        const consentGiven = session.externalProcessingConsent === true;\n        const consentTimestamp = session.consentTimestamp;\n        // Consent must be explicit and recent (within 90 days)\n        const consentValid = consentGiven && this._isConsentRecent(consentTimestamp);\n        return {\n            allowed: consentValid,\n            consentGiven,\n            consentTimestamp,\n            reason: !consentGiven ? \"User has not consented to external data processing\" : !consentValid ? \"Consent has expired (>90 days old)\" : \"Consent valid\"\n        };\n    }\n    /**\r\n   * Record consent given by user\r\n   * @param {Object} consent - Consent details\r\n   */ static async recordConsent(consent) {\n        // Log to audit trail\n        await _popia_audit_js__WEBPACK_IMPORTED_MODULE_0__.POPIAAuditLogger.logConsent({\n            sessionId: consent.sessionId,\n            given: consent.given,\n            type: \"external_processing\",\n            text: consent.consentText,\n            ipAddress: consent.ipAddress,\n            userAgent: consent.userAgent\n        });\n        return {\n            recorded: true,\n            timestamp: new Date().toISOString(),\n            expiresAt: this._calculateExpiryDate()\n        };\n    }\n    /**\r\n   * Check if consent is recent (within 90 days)\r\n   */ static _isConsentRecent(timestamp) {\n        if (!timestamp) return false;\n        const consentDate = new Date(timestamp);\n        const now = new Date();\n        const daysSinceConsent = (now - consentDate) / (1000 * 60 * 60 * 24);\n        return daysSinceConsent <= 90;\n    }\n    /**\r\n   * Calculate consent expiry date (90 days from now)\r\n   */ static _calculateExpiryDate() {\n        const expiry = new Date();\n        expiry.setDate(expiry.getDate() + 90);\n        return expiry.toISOString();\n    }\n    /**\r\n   * Generate consent text for UI\r\n   */ static getConsentText() {\n        return {\n            title: \"External Data Processing Consent\",\n            body: `To provide you with personalized career recommendations, we need to process your assessment data using external AI services (Claude AI by Anthropic).\r\n\r\nYour data will be:\r\n• Sanitized to remove all personal information (name, ID number, school name, etc.)\r\n• Sent only with your explicit consent\r\n• Used solely for generating your career report\r\n• Not stored by the external service\r\n• Processed in compliance with POPIA (Protection of Personal Information Act)\r\n\r\nYou can withdraw consent at any time by contacting your school administrator.`,\n            checkboxLabel: \"I consent to external processing of my sanitized assessment data for career recommendations\",\n            learnMoreUrl: \"/privacy-policy#external-processing\"\n        };\n    }\n    /**\r\n   * Validate consent before external API call\r\n   * Throws error if consent not given\r\n   */ static enforceConsent(session) {\n        const check = this.checkConsent(session);\n        if (!check.allowed) {\n            throw new ConsentError(check.reason);\n        }\n        return true;\n    }\n}\n/**\r\n * Custom error for consent violations\r\n */ class ConsentError extends Error {\n    constructor(message){\n        super(message);\n        this.name = \"ConsentError\";\n        this.code = \"CONSENT_REQUIRED\";\n        this.statusCode = 403;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvY29tcGxpYW5jZS9jb25zZW50LWdhdGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsOERBQThEO0FBQzlELHlEQUF5RDtBQUVMO0FBRTdDLE1BQU1DO0lBQ1g7Ozs7R0FJQyxHQUNELE9BQU9DLGFBQWFDLE9BQU8sRUFBRTtRQUMzQixNQUFNQyxlQUFlRCxRQUFRRSx5QkFBeUIsS0FBSztRQUMzRCxNQUFNQyxtQkFBbUJILFFBQVFHLGdCQUFnQjtRQUVqRCx1REFBdUQ7UUFDdkQsTUFBTUMsZUFBZUgsZ0JBQWdCLElBQUksQ0FBQ0ksZ0JBQWdCLENBQUNGO1FBRTNELE9BQU87WUFDTEcsU0FBU0Y7WUFDVEg7WUFDQUU7WUFDQUksUUFBUSxDQUFDTixlQUNMLHVEQUNBLENBQUNHLGVBQ0QsdUNBQ0E7UUFDTjtJQUNGO0lBRUE7OztHQUdDLEdBQ0QsYUFBYUksY0FBY0MsT0FBTyxFQUFFO1FBQ2xDLHFCQUFxQjtRQUNyQixNQUFNWiw2REFBZ0JBLENBQUNhLFVBQVUsQ0FBQztZQUNoQ0MsV0FBV0YsUUFBUUUsU0FBUztZQUM1QkMsT0FBT0gsUUFBUUcsS0FBSztZQUNwQkMsTUFBTTtZQUNOQyxNQUFNTCxRQUFRTSxXQUFXO1lBQ3pCQyxXQUFXUCxRQUFRTyxTQUFTO1lBQzVCQyxXQUFXUixRQUFRUSxTQUFTO1FBQzlCO1FBRUEsT0FBTztZQUNMQyxVQUFVO1lBQ1ZDLFdBQVcsSUFBSUMsT0FBT0MsV0FBVztZQUNqQ0MsV0FBVyxJQUFJLENBQUNDLG9CQUFvQjtRQUN0QztJQUNGO0lBRUE7O0dBRUMsR0FDRCxPQUFPbEIsaUJBQWlCYyxTQUFTLEVBQUU7UUFDakMsSUFBSSxDQUFDQSxXQUFXLE9BQU87UUFFdkIsTUFBTUssY0FBYyxJQUFJSixLQUFLRDtRQUM3QixNQUFNTSxNQUFNLElBQUlMO1FBQ2hCLE1BQU1NLG1CQUFtQixDQUFDRCxNQUFNRCxXQUFVLElBQU0sUUFBTyxLQUFLLEtBQUssRUFBQztRQUVsRSxPQUFPRSxvQkFBb0I7SUFDN0I7SUFFQTs7R0FFQyxHQUNELE9BQU9ILHVCQUF1QjtRQUM1QixNQUFNSSxTQUFTLElBQUlQO1FBQ25CTyxPQUFPQyxPQUFPLENBQUNELE9BQU9FLE9BQU8sS0FBSztRQUNsQyxPQUFPRixPQUFPTixXQUFXO0lBQzNCO0lBRUE7O0dBRUMsR0FDRCxPQUFPUyxpQkFBaUI7UUFDdEIsT0FBTztZQUNMQyxPQUFPO1lBQ1BDLE1BQU0sQ0FBQzs7Ozs7Ozs7OzZFQVNnRSxDQUFDO1lBQ3hFQyxlQUFlO1lBQ2ZDLGNBQWM7UUFDaEI7SUFDRjtJQUVBOzs7R0FHQyxHQUNELE9BQU9DLGVBQWVuQyxPQUFPLEVBQUU7UUFDN0IsTUFBTW9DLFFBQVEsSUFBSSxDQUFDckMsWUFBWSxDQUFDQztRQUVoQyxJQUFJLENBQUNvQyxNQUFNOUIsT0FBTyxFQUFFO1lBQ2xCLE1BQU0sSUFBSStCLGFBQWFELE1BQU03QixNQUFNO1FBQ3JDO1FBRUEsT0FBTztJQUNUO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLE1BQU04QixxQkFBcUJDO0lBQ2hDQyxZQUFZQyxPQUFPLENBQUU7UUFDbkIsS0FBSyxDQUFDQTtRQUNOLElBQUksQ0FBQ0MsSUFBSSxHQUFHO1FBQ1osSUFBSSxDQUFDQyxJQUFJLEdBQUc7UUFDWixJQUFJLENBQUNDLFVBQVUsR0FBRztJQUNwQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGhhbmRpLXJhZy1zeXN0ZW0vLi9saWIvY29tcGxpYW5jZS9jb25zZW50LWdhdGUuanM/NTE5YyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb25zZW50IEdhdGUgLSBFeHBsaWNpdCBvcHQtaW4gZm9yIGV4dGVybmFsIGRhdGEgcHJvY2Vzc2luZ1xyXG4vLyBSZXF1aXJlZCBieSBQT1BJQSBTZWN0aW9uIDExIChDb25zZW50KSBhbmQgc2Nob29sIERQQXNcclxuXHJcbmltcG9ydCB7IFBPUElBQXVkaXRMb2dnZXIgfSBmcm9tICcuL3BvcGlhLWF1ZGl0LmpzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDb25zZW50R2F0ZSB7XHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgdXNlciBoYXMgZ2l2ZW4gY29uc2VudCBmb3IgZXh0ZXJuYWwgcHJvY2Vzc2luZ1xyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBzZXNzaW9uIC0gVXNlciBzZXNzaW9uIHdpdGggY29uc2VudCBzdGF0dXNcclxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSAtIENvbnNlbnQgY2hlY2sgcmVzdWx0XHJcbiAgICovXHJcbiAgc3RhdGljIGNoZWNrQ29uc2VudChzZXNzaW9uKSB7XHJcbiAgICBjb25zdCBjb25zZW50R2l2ZW4gPSBzZXNzaW9uLmV4dGVybmFsUHJvY2Vzc2luZ0NvbnNlbnQgPT09IHRydWU7XHJcbiAgICBjb25zdCBjb25zZW50VGltZXN0YW1wID0gc2Vzc2lvbi5jb25zZW50VGltZXN0YW1wO1xyXG5cclxuICAgIC8vIENvbnNlbnQgbXVzdCBiZSBleHBsaWNpdCBhbmQgcmVjZW50ICh3aXRoaW4gOTAgZGF5cylcclxuICAgIGNvbnN0IGNvbnNlbnRWYWxpZCA9IGNvbnNlbnRHaXZlbiAmJiB0aGlzLl9pc0NvbnNlbnRSZWNlbnQoY29uc2VudFRpbWVzdGFtcCk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgYWxsb3dlZDogY29uc2VudFZhbGlkLFxyXG4gICAgICBjb25zZW50R2l2ZW4sXHJcbiAgICAgIGNvbnNlbnRUaW1lc3RhbXAsXHJcbiAgICAgIHJlYXNvbjogIWNvbnNlbnRHaXZlbiBcclxuICAgICAgICA/ICdVc2VyIGhhcyBub3QgY29uc2VudGVkIHRvIGV4dGVybmFsIGRhdGEgcHJvY2Vzc2luZydcclxuICAgICAgICA6ICFjb25zZW50VmFsaWRcclxuICAgICAgICA/ICdDb25zZW50IGhhcyBleHBpcmVkICg+OTAgZGF5cyBvbGQpJ1xyXG4gICAgICAgIDogJ0NvbnNlbnQgdmFsaWQnXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVjb3JkIGNvbnNlbnQgZ2l2ZW4gYnkgdXNlclxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjb25zZW50IC0gQ29uc2VudCBkZXRhaWxzXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHJlY29yZENvbnNlbnQoY29uc2VudCkge1xyXG4gICAgLy8gTG9nIHRvIGF1ZGl0IHRyYWlsXHJcbiAgICBhd2FpdCBQT1BJQUF1ZGl0TG9nZ2VyLmxvZ0NvbnNlbnQoe1xyXG4gICAgICBzZXNzaW9uSWQ6IGNvbnNlbnQuc2Vzc2lvbklkLFxyXG4gICAgICBnaXZlbjogY29uc2VudC5naXZlbixcclxuICAgICAgdHlwZTogJ2V4dGVybmFsX3Byb2Nlc3NpbmcnLFxyXG4gICAgICB0ZXh0OiBjb25zZW50LmNvbnNlbnRUZXh0LFxyXG4gICAgICBpcEFkZHJlc3M6IGNvbnNlbnQuaXBBZGRyZXNzLFxyXG4gICAgICB1c2VyQWdlbnQ6IGNvbnNlbnQudXNlckFnZW50XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICByZWNvcmRlZDogdHJ1ZSxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIGV4cGlyZXNBdDogdGhpcy5fY2FsY3VsYXRlRXhwaXJ5RGF0ZSgpXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgY29uc2VudCBpcyByZWNlbnQgKHdpdGhpbiA5MCBkYXlzKVxyXG4gICAqL1xyXG4gIHN0YXRpYyBfaXNDb25zZW50UmVjZW50KHRpbWVzdGFtcCkge1xyXG4gICAgaWYgKCF0aW1lc3RhbXApIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICBjb25zdCBjb25zZW50RGF0ZSA9IG5ldyBEYXRlKHRpbWVzdGFtcCk7XHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgY29uc3QgZGF5c1NpbmNlQ29uc2VudCA9IChub3cgLSBjb25zZW50RGF0ZSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCk7XHJcblxyXG4gICAgcmV0dXJuIGRheXNTaW5jZUNvbnNlbnQgPD0gOTA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxjdWxhdGUgY29uc2VudCBleHBpcnkgZGF0ZSAoOTAgZGF5cyBmcm9tIG5vdylcclxuICAgKi9cclxuICBzdGF0aWMgX2NhbGN1bGF0ZUV4cGlyeURhdGUoKSB7XHJcbiAgICBjb25zdCBleHBpcnkgPSBuZXcgRGF0ZSgpO1xyXG4gICAgZXhwaXJ5LnNldERhdGUoZXhwaXJ5LmdldERhdGUoKSArIDkwKTtcclxuICAgIHJldHVybiBleHBpcnkudG9JU09TdHJpbmcoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIGNvbnNlbnQgdGV4dCBmb3IgVUlcclxuICAgKi9cclxuICBzdGF0aWMgZ2V0Q29uc2VudFRleHQoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0aXRsZTogJ0V4dGVybmFsIERhdGEgUHJvY2Vzc2luZyBDb25zZW50JyxcclxuICAgICAgYm9keTogYFRvIHByb3ZpZGUgeW91IHdpdGggcGVyc29uYWxpemVkIGNhcmVlciByZWNvbW1lbmRhdGlvbnMsIHdlIG5lZWQgdG8gcHJvY2VzcyB5b3VyIGFzc2Vzc21lbnQgZGF0YSB1c2luZyBleHRlcm5hbCBBSSBzZXJ2aWNlcyAoQ2xhdWRlIEFJIGJ5IEFudGhyb3BpYykuXHJcblxyXG5Zb3VyIGRhdGEgd2lsbCBiZTpcclxu4oCiIFNhbml0aXplZCB0byByZW1vdmUgYWxsIHBlcnNvbmFsIGluZm9ybWF0aW9uIChuYW1lLCBJRCBudW1iZXIsIHNjaG9vbCBuYW1lLCBldGMuKVxyXG7igKIgU2VudCBvbmx5IHdpdGggeW91ciBleHBsaWNpdCBjb25zZW50XHJcbuKAoiBVc2VkIHNvbGVseSBmb3IgZ2VuZXJhdGluZyB5b3VyIGNhcmVlciByZXBvcnRcclxu4oCiIE5vdCBzdG9yZWQgYnkgdGhlIGV4dGVybmFsIHNlcnZpY2Vcclxu4oCiIFByb2Nlc3NlZCBpbiBjb21wbGlhbmNlIHdpdGggUE9QSUEgKFByb3RlY3Rpb24gb2YgUGVyc29uYWwgSW5mb3JtYXRpb24gQWN0KVxyXG5cclxuWW91IGNhbiB3aXRoZHJhdyBjb25zZW50IGF0IGFueSB0aW1lIGJ5IGNvbnRhY3RpbmcgeW91ciBzY2hvb2wgYWRtaW5pc3RyYXRvci5gLFxyXG4gICAgICBjaGVja2JveExhYmVsOiAnSSBjb25zZW50IHRvIGV4dGVybmFsIHByb2Nlc3Npbmcgb2YgbXkgc2FuaXRpemVkIGFzc2Vzc21lbnQgZGF0YSBmb3IgY2FyZWVyIHJlY29tbWVuZGF0aW9ucycsXHJcbiAgICAgIGxlYXJuTW9yZVVybDogJy9wcml2YWN5LXBvbGljeSNleHRlcm5hbC1wcm9jZXNzaW5nJ1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZhbGlkYXRlIGNvbnNlbnQgYmVmb3JlIGV4dGVybmFsIEFQSSBjYWxsXHJcbiAgICogVGhyb3dzIGVycm9yIGlmIGNvbnNlbnQgbm90IGdpdmVuXHJcbiAgICovXHJcbiAgc3RhdGljIGVuZm9yY2VDb25zZW50KHNlc3Npb24pIHtcclxuICAgIGNvbnN0IGNoZWNrID0gdGhpcy5jaGVja0NvbnNlbnQoc2Vzc2lvbik7XHJcblxyXG4gICAgaWYgKCFjaGVjay5hbGxvd2VkKSB7XHJcbiAgICAgIHRocm93IG5ldyBDb25zZW50RXJyb3IoY2hlY2sucmVhc29uKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDdXN0b20gZXJyb3IgZm9yIGNvbnNlbnQgdmlvbGF0aW9uc1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIENvbnNlbnRFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XHJcbiAgICBzdXBlcihtZXNzYWdlKTtcclxuICAgIHRoaXMubmFtZSA9ICdDb25zZW50RXJyb3InO1xyXG4gICAgdGhpcy5jb2RlID0gJ0NPTlNFTlRfUkVRVUlSRUQnO1xyXG4gICAgdGhpcy5zdGF0dXNDb2RlID0gNDAzO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiUE9QSUFBdWRpdExvZ2dlciIsIkNvbnNlbnRHYXRlIiwiY2hlY2tDb25zZW50Iiwic2Vzc2lvbiIsImNvbnNlbnRHaXZlbiIsImV4dGVybmFsUHJvY2Vzc2luZ0NvbnNlbnQiLCJjb25zZW50VGltZXN0YW1wIiwiY29uc2VudFZhbGlkIiwiX2lzQ29uc2VudFJlY2VudCIsImFsbG93ZWQiLCJyZWFzb24iLCJyZWNvcmRDb25zZW50IiwiY29uc2VudCIsImxvZ0NvbnNlbnQiLCJzZXNzaW9uSWQiLCJnaXZlbiIsInR5cGUiLCJ0ZXh0IiwiY29uc2VudFRleHQiLCJpcEFkZHJlc3MiLCJ1c2VyQWdlbnQiLCJyZWNvcmRlZCIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImV4cGlyZXNBdCIsIl9jYWxjdWxhdGVFeHBpcnlEYXRlIiwiY29uc2VudERhdGUiLCJub3ciLCJkYXlzU2luY2VDb25zZW50IiwiZXhwaXJ5Iiwic2V0RGF0ZSIsImdldERhdGUiLCJnZXRDb25zZW50VGV4dCIsInRpdGxlIiwiYm9keSIsImNoZWNrYm94TGFiZWwiLCJsZWFybk1vcmVVcmwiLCJlbmZvcmNlQ29uc2VudCIsImNoZWNrIiwiQ29uc2VudEVycm9yIiwiRXJyb3IiLCJjb25zdHJ1Y3RvciIsIm1lc3NhZ2UiLCJuYW1lIiwiY29kZSIsInN0YXR1c0NvZGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/compliance/consent-gate.js\n");

/***/ }),

/***/ "(rsc)/./lib/compliance/popia-audit.js":
/*!***************************************!*\
  !*** ./lib/compliance/popia-audit.js ***!
  \***************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POPIAAuditLogger: () => (/* binding */ POPIAAuditLogger)\n/* harmony export */ });\n// POPIA Audit Trail - Log all PII processing for compliance\n// Required by POPIA Section 14 (Information Officer duties)\n// Lazy load Supabase to avoid initialization errors\nlet supabase = null;\nfunction getSupabaseClient() {\n    if (!supabase) {\n        const { createClient } = require(\"@supabase/supabase-js\");\n        supabase = createClient(\"https://pvvnxupuukuefajypovz.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY);\n    }\n    return supabase;\n}\nclass POPIAAuditLogger {\n    /**\r\n   * Log external API call with sanitised data\r\n   * @param {Object} event - Audit event details\r\n   */ static async logExternalAPICall(event) {\n        try {\n            const supabase = getSupabaseClient();\n            const { error } = await supabase.from(\"popia_audit_log\").insert({\n                event_type: \"EXTERNAL_API_CALL\",\n                api_provider: event.provider,\n                data_sanitised: event.sanitised,\n                pii_detected: event.piiDetected || [],\n                pii_removed: event.piiRemoved || [],\n                session_id: event.sessionId,\n                user_consent: event.userConsent,\n                purpose: event.purpose,\n                timestamp: new Date().toISOString()\n            });\n            if (error) {\n                console.error(\"[POPIA] Audit log error:\", error);\n            }\n        } catch (err) {\n            console.error(\"[POPIA] Audit log exception:\", err);\n        }\n    }\n    /**\r\n   * Log consent given by user\r\n   */ static async logConsent(consent) {\n        try {\n            const supabase = getSupabaseClient();\n            const { error } = await supabase.from(\"popia_consent_log\").insert({\n                session_id: consent.sessionId,\n                consent_given: consent.given,\n                consent_type: consent.type,\n                consent_text: consent.text,\n                ip_address: consent.ipAddress,\n                user_agent: consent.userAgent,\n                timestamp: new Date().toISOString()\n            });\n            if (error) {\n                console.error(\"[POPIA] Consent log error:\", error);\n            }\n        } catch (err) {\n            console.error(\"[POPIA] Consent log exception:\", err);\n        }\n    }\n    /**\r\n   * Log data access (for POPIA Section 23 - Right to access)\r\n   */ static async logDataAccess(access) {\n        try {\n            const supabase = getSupabaseClient();\n            const { error } = await supabase.from(\"popia_access_log\").insert({\n                session_id: access.sessionId,\n                data_accessed: access.dataType,\n                accessed_by: access.accessedBy,\n                purpose: access.purpose,\n                timestamp: new Date().toISOString()\n            });\n            if (error) {\n                console.error(\"[POPIA] Access log error:\", error);\n            }\n        } catch (err) {\n            console.error(\"[POPIA] Access log exception:\", err);\n        }\n    }\n    /**\r\n   * Generate compliance report for Information Officer\r\n   */ static async generateComplianceReport(startDate, endDate) {\n        try {\n            const supabase = getSupabaseClient();\n            const { data: apiCalls, error: apiError } = await supabase.from(\"popia_audit_log\").select(\"*\").gte(\"timestamp\", startDate).lte(\"timestamp\", endDate);\n            const { data: consents, error: consentError } = await supabase.from(\"popia_consent_log\").select(\"*\").gte(\"timestamp\", startDate).lte(\"timestamp\", endDate);\n            if (apiError || consentError) {\n                throw new Error(\"Failed to generate compliance report\");\n            }\n            return {\n                period: {\n                    startDate,\n                    endDate\n                },\n                summary: {\n                    totalAPIcalls: apiCalls.length,\n                    sanitisedCalls: apiCalls.filter((c)=>c.data_sanitised).length,\n                    piiDetected: apiCalls.reduce((sum, c)=>sum + (c.pii_detected?.length || 0), 0),\n                    consentsGiven: consents.filter((c)=>c.consent_given).length,\n                    consentsDeclined: consents.filter((c)=>!c.consent_given).length\n                },\n                apiCalls,\n                consents\n            };\n        } catch (err) {\n            console.error(\"[POPIA] Report generation error:\", err);\n            return null;\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFJLENBQUMsbUJBQ0w2QyxNQUFNLENBQUMsS0FDUEMsR0FBRyxDQUFDLGFBQWFOLFdBQ2pCTyxHQUFHLENBQUMsYUFBYU47WUFFcEIsTUFBTSxFQUFFQyxNQUFNTSxRQUFRLEVBQUVqRCxPQUFPa0QsWUFBWSxFQUFFLEdBQUcsTUFBTTdELFNBQ25EWSxJQUFJLENBQUMscUJBQ0w2QyxNQUFNLENBQUMsS0FDUEMsR0FBRyxDQUFDLGFBQWFOLFdBQ2pCTyxHQUFHLENBQUMsYUFBYU47WUFFcEIsSUFBSUcsWUFBWUssY0FBYztnQkFDNUIsTUFBTSxJQUFJQyxNQUFNO1lBQ2xCO1lBRUEsT0FBTztnQkFDTEMsUUFBUTtvQkFBRVg7b0JBQVdDO2dCQUFRO2dCQUM3QlcsU0FBUztvQkFDUEMsZUFBZVYsU0FBU1csTUFBTTtvQkFDOUJDLGdCQUFnQlosU0FBU2EsTUFBTSxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFcEQsY0FBYyxFQUFFaUQsTUFBTTtvQkFDN0Q5QyxhQUFhbUMsU0FBU2UsTUFBTSxDQUFDLENBQUNDLEtBQUtGLElBQU1FLE1BQU9GLENBQUFBLEVBQUVsRCxZQUFZLEVBQUUrQyxVQUFVLElBQUk7b0JBQzlFTSxlQUFlWixTQUFTUSxNQUFNLENBQUNDLENBQUFBLElBQUtBLEVBQUVsQyxhQUFhLEVBQUUrQixNQUFNO29CQUMzRE8sa0JBQWtCYixTQUFTUSxNQUFNLENBQUNDLENBQUFBLElBQUssQ0FBQ0EsRUFBRWxDLGFBQWEsRUFBRStCLE1BQU07Z0JBQ2pFO2dCQUNBWDtnQkFDQUs7WUFDRjtRQUNGLEVBQUUsT0FBTzVCLEtBQUs7WUFDWkQsUUFBUXBCLEtBQUssQ0FBQyxvQ0FBb0NxQjtZQUNsRCxPQUFPO1FBQ1Q7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGhhbmRpLXJhZy1zeXN0ZW0vLi9saWIvY29tcGxpYW5jZS9wb3BpYS1hdWRpdC5qcz9jMzUxIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFBPUElBIEF1ZGl0IFRyYWlsIC0gTG9nIGFsbCBQSUkgcHJvY2Vzc2luZyBmb3IgY29tcGxpYW5jZVxyXG4vLyBSZXF1aXJlZCBieSBQT1BJQSBTZWN0aW9uIDE0IChJbmZvcm1hdGlvbiBPZmZpY2VyIGR1dGllcylcclxuXHJcbi8vIExhenkgbG9hZCBTdXBhYmFzZSB0byBhdm9pZCBpbml0aWFsaXphdGlvbiBlcnJvcnNcclxubGV0IHN1cGFiYXNlID0gbnVsbDtcclxuXHJcbmZ1bmN0aW9uIGdldFN1cGFiYXNlQ2xpZW50KCkge1xyXG4gIGlmICghc3VwYWJhc2UpIHtcclxuICAgIGNvbnN0IHsgY3JlYXRlQ2xpZW50IH0gPSByZXF1aXJlKCdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnKTtcclxuICAgIHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxyXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwsXHJcbiAgICAgIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVlcclxuICAgICk7XHJcbiAgfVxyXG4gIHJldHVybiBzdXBhYmFzZTtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFBPUElBQXVkaXRMb2dnZXIge1xyXG4gIC8qKlxyXG4gICAqIExvZyBleHRlcm5hbCBBUEkgY2FsbCB3aXRoIHNhbml0aXNlZCBkYXRhXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50IC0gQXVkaXQgZXZlbnQgZGV0YWlsc1xyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBsb2dFeHRlcm5hbEFQSUNhbGwoZXZlbnQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2VDbGllbnQoKTtcclxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncG9waWFfYXVkaXRfbG9nJylcclxuICAgICAgICAuaW5zZXJ0KHtcclxuICAgICAgICAgIGV2ZW50X3R5cGU6ICdFWFRFUk5BTF9BUElfQ0FMTCcsXHJcbiAgICAgICAgICBhcGlfcHJvdmlkZXI6IGV2ZW50LnByb3ZpZGVyLCAvLyAnYW50aHJvcGljJywgJ29wZW5haScsIGV0Yy5cclxuICAgICAgICAgIGRhdGFfc2FuaXRpc2VkOiBldmVudC5zYW5pdGlzZWQsXHJcbiAgICAgICAgICBwaWlfZGV0ZWN0ZWQ6IGV2ZW50LnBpaURldGVjdGVkIHx8IFtdLFxyXG4gICAgICAgICAgcGlpX3JlbW92ZWQ6IGV2ZW50LnBpaVJlbW92ZWQgfHwgW10sXHJcbiAgICAgICAgICBzZXNzaW9uX2lkOiBldmVudC5zZXNzaW9uSWQsXHJcbiAgICAgICAgICB1c2VyX2NvbnNlbnQ6IGV2ZW50LnVzZXJDb25zZW50LFxyXG4gICAgICAgICAgcHVycG9zZTogZXZlbnQucHVycG9zZSxcclxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdbUE9QSUFdIEF1ZGl0IGxvZyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdbUE9QSUFdIEF1ZGl0IGxvZyBleGNlcHRpb246JywgZXJyKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvZyBjb25zZW50IGdpdmVuIGJ5IHVzZXJcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgbG9nQ29uc2VudChjb25zZW50KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3BvcGlhX2NvbnNlbnRfbG9nJylcclxuICAgICAgICAuaW5zZXJ0KHtcclxuICAgICAgICAgIHNlc3Npb25faWQ6IGNvbnNlbnQuc2Vzc2lvbklkLFxyXG4gICAgICAgICAgY29uc2VudF9naXZlbjogY29uc2VudC5naXZlbixcclxuICAgICAgICAgIGNvbnNlbnRfdHlwZTogY29uc2VudC50eXBlLCAvLyAnZXh0ZXJuYWxfcHJvY2Vzc2luZycsICdkYXRhX3N0b3JhZ2UnLCBldGMuXHJcbiAgICAgICAgICBjb25zZW50X3RleHQ6IGNvbnNlbnQudGV4dCxcclxuICAgICAgICAgIGlwX2FkZHJlc3M6IGNvbnNlbnQuaXBBZGRyZXNzLFxyXG4gICAgICAgICAgdXNlcl9hZ2VudDogY29uc2VudC51c2VyQWdlbnQsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignW1BPUElBXSBDb25zZW50IGxvZyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdbUE9QSUFdIENvbnNlbnQgbG9nIGV4Y2VwdGlvbjonLCBlcnIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTG9nIGRhdGEgYWNjZXNzIChmb3IgUE9QSUEgU2VjdGlvbiAyMyAtIFJpZ2h0IHRvIGFjY2VzcylcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgbG9nRGF0YUFjY2VzcyhhY2Nlc3MpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2VDbGllbnQoKTtcclxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncG9waWFfYWNjZXNzX2xvZycpXHJcbiAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICBzZXNzaW9uX2lkOiBhY2Nlc3Muc2Vzc2lvbklkLFxyXG4gICAgICAgICAgZGF0YV9hY2Nlc3NlZDogYWNjZXNzLmRhdGFUeXBlLFxyXG4gICAgICAgICAgYWNjZXNzZWRfYnk6IGFjY2Vzcy5hY2Nlc3NlZEJ5LCAvLyAnc3R1ZGVudCcsICd0ZWFjaGVyJywgJ2FkbWluJywgJ3N5c3RlbSdcclxuICAgICAgICAgIHB1cnBvc2U6IGFjY2Vzcy5wdXJwb3NlLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tQT1BJQV0gQWNjZXNzIGxvZyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdbUE9QSUFdIEFjY2VzcyBsb2cgZXhjZXB0aW9uOicsIGVycik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSBjb21wbGlhbmNlIHJlcG9ydCBmb3IgSW5mb3JtYXRpb24gT2ZmaWNlclxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBnZW5lcmF0ZUNvbXBsaWFuY2VSZXBvcnQoc3RhcnREYXRlLCBlbmREYXRlKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogYXBpQ2FsbHMsIGVycm9yOiBhcGlFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncG9waWFfYXVkaXRfbG9nJylcclxuICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAuZ3RlKCd0aW1lc3RhbXAnLCBzdGFydERhdGUpXHJcbiAgICAgICAgLmx0ZSgndGltZXN0YW1wJywgZW5kRGF0ZSk7XHJcblxyXG4gICAgICBjb25zdCB7IGRhdGE6IGNvbnNlbnRzLCBlcnJvcjogY29uc2VudEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwb3BpYV9jb25zZW50X2xvZycpXHJcbiAgICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgICAgLmd0ZSgndGltZXN0YW1wJywgc3RhcnREYXRlKVxyXG4gICAgICAgIC5sdGUoJ3RpbWVzdGFtcCcsIGVuZERhdGUpO1xyXG5cclxuICAgICAgaWYgKGFwaUVycm9yIHx8IGNvbnNlbnRFcnJvcikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGdlbmVyYXRlIGNvbXBsaWFuY2UgcmVwb3J0Jyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgcGVyaW9kOiB7IHN0YXJ0RGF0ZSwgZW5kRGF0ZSB9LFxyXG4gICAgICAgIHN1bW1hcnk6IHtcclxuICAgICAgICAgIHRvdGFsQVBJY2FsbHM6IGFwaUNhbGxzLmxlbmd0aCxcclxuICAgICAgICAgIHNhbml0aXNlZENhbGxzOiBhcGlDYWxscy5maWx0ZXIoYyA9PiBjLmRhdGFfc2FuaXRpc2VkKS5sZW5ndGgsXHJcbiAgICAgICAgICBwaWlEZXRlY3RlZDogYXBpQ2FsbHMucmVkdWNlKChzdW0sIGMpID0+IHN1bSArIChjLnBpaV9kZXRlY3RlZD8ubGVuZ3RoIHx8IDApLCAwKSxcclxuICAgICAgICAgIGNvbnNlbnRzR2l2ZW46IGNvbnNlbnRzLmZpbHRlcihjID0+IGMuY29uc2VudF9naXZlbikubGVuZ3RoLFxyXG4gICAgICAgICAgY29uc2VudHNEZWNsaW5lZDogY29uc2VudHMuZmlsdGVyKGMgPT4gIWMuY29uc2VudF9naXZlbikubGVuZ3RoXHJcbiAgICAgICAgfSxcclxuICAgICAgICBhcGlDYWxscyxcclxuICAgICAgICBjb25zZW50c1xyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tQT1BJQV0gUmVwb3J0IGdlbmVyYXRpb24gZXJyb3I6JywgZXJyKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJzdXBhYmFzZSIsImdldFN1cGFiYXNlQ2xpZW50IiwiY3JlYXRlQ2xpZW50IiwicmVxdWlyZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiUE9QSUFBdWRpdExvZ2dlciIsImxvZ0V4dGVybmFsQVBJQ2FsbCIsImV2ZW50IiwiZXJyb3IiLCJmcm9tIiwiaW5zZXJ0IiwiZXZlbnRfdHlwZSIsImFwaV9wcm92aWRlciIsInByb3ZpZGVyIiwiZGF0YV9zYW5pdGlzZWQiLCJzYW5pdGlzZWQiLCJwaWlfZGV0ZWN0ZWQiLCJwaWlEZXRlY3RlZCIsInBpaV9yZW1vdmVkIiwicGlpUmVtb3ZlZCIsInNlc3Npb25faWQiLCJzZXNzaW9uSWQiLCJ1c2VyX2NvbnNlbnQiLCJ1c2VyQ29uc2VudCIsInB1cnBvc2UiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJjb25zb2xlIiwiZXJyIiwibG9nQ29uc2VudCIsImNvbnNlbnQiLCJjb25zZW50X2dpdmVuIiwiZ2l2ZW4iLCJjb25zZW50X3R5cGUiLCJ0eXBlIiwiY29uc2VudF90ZXh0IiwidGV4dCIsImlwX2FkZHJlc3MiLCJpcEFkZHJlc3MiLCJ1c2VyX2FnZW50IiwidXNlckFnZW50IiwibG9nRGF0YUFjY2VzcyIsImFjY2VzcyIsImRhdGFfYWNjZXNzZWQiLCJkYXRhVHlwZSIsImFjY2Vzc2VkX2J5IiwiYWNjZXNzZWRCeSIsImdlbmVyYXRlQ29tcGxpYW5jZVJlcG9ydCIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJkYXRhIiwiYXBpQ2FsbHMiLCJhcGlFcnJvciIsInNlbGVjdCIsImd0ZSIsImx0ZSIsImNvbnNlbnRzIiwiY29uc2VudEVycm9yIiwiRXJyb3IiLCJwZXJpb2QiLCJzdW1tYXJ5IiwidG90YWxBUEljYWxscyIsImxlbmd0aCIsInNhbml0aXNlZENhbGxzIiwiZmlsdGVyIiwiYyIsInJlZHVjZSIsInN1bSIsImNvbnNlbnRzR2l2ZW4iLCJjb25zZW50c0RlY2xpbmVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/compliance/popia-audit.js\n");

/***/ }),

/***/ "(rsc)/./lib/compliance/popia-sanitiser.js":
/*!*******************************************!*\
  !*** ./lib/compliance/popia-sanitiser.js ***!
  \*******************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POPIASanitiser: () => (/* binding */ POPIASanitiser),\n/* harmony export */   popiaSanitiser: () => (/* binding */ popiaSanitiser)\n/* harmony export */ });\n// POPIA Sanitiser - Strip PII before external API calls\n// Required by POPIA Act 4 of 2013 - R10M fine for non-compliance\n/**\r\n * PII Categories per POPIA:\r\n * - Direct identifiers: Names, ID numbers, contact details\r\n * - Quasi-identifiers: School names, specific locations, dates\r\n * - Sensitive data: Race, health, biometric data\r\n */ const PII_PATTERNS = {\n    // South African ID numbers (13 digits)\n    idNumber: /\\b\\d{13}\\b/g,\n    // Phone numbers (SA format)\n    phone: /\\b(?:\\+27|0)[6-8]\\d{8}\\b/g,\n    // Email addresses\n    email: /\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b/g,\n    // Names (common SA patterns)\n    // Match capitalized words that look like names (2-20 chars)\n    possibleName: /\\b[A-Z][a-z]{1,19}\\s+[A-Z][a-z]{1,19}\\b/g,\n    // School names (common patterns)\n    schoolName: /(High School|Primary School|College|Academy|School)\\b/gi,\n    // Specific locations (street addresses)\n    address: /\\b\\d+\\s+[A-Z][a-z]+\\s+(Street|Road|Avenue|Drive|Lane)\\b/gi,\n    // Dates that could identify individuals\n    specificDate: /\\b\\d{1,2}[-/]\\d{1,2}[-/]\\d{2,4}\\b/g\n};\nclass POPIASanitiser {\n    constructor(options = {}){\n        this.strictMode = options.strictMode ?? true;\n        this.logSanitisation = options.logSanitisation ?? true;\n        this.auditTrail = [];\n    }\n    /**\r\n   * Sanitise student profile before external API call\r\n   * @param {Object} profile - Student profile with potential PII\r\n   * @returns {Object} - Sanitised profile safe for external processing\r\n   */ sanitiseProfile(profile) {\n        const sanitised = {\n            // Keep only non-identifying academic data\n            grade: profile.grade,\n            mathType: profile.mathType,\n            mathMark: this._generaliseMarks(profile.mathMark),\n            subjects: profile.subjects || [],\n            marks: this._generaliseAllMarks(profile.marks),\n            // Generalise location to province level only\n            province: this._generaliseLocation(profile.location),\n            // Keep preferences but sanitise text\n            budgetLimit: profile.budgetLimit,\n            interests: this._sanitiseText(profile.interests),\n            careerPreferences: this._sanitiseText(profile.careerPreferences)\n        };\n        // Audit trail\n        this._logSanitisation(\"profile\", profile, sanitised);\n        return sanitised;\n    }\n    /**\r\n   * Sanitise report text before external processing\r\n   * @param {string} text - Report text that may contain PII\r\n   * @returns {string} - Sanitised text\r\n   */ sanitiseReportText(text) {\n        if (!text) return text;\n        let sanitised = text;\n        const replacements = [];\n        // Remove ID numbers\n        sanitised = sanitised.replace(PII_PATTERNS.idNumber, (match)=>{\n            replacements.push({\n                type: \"ID_NUMBER\",\n                original: match\n            });\n            return \"[ID_REDACTED]\";\n        });\n        // Remove phone numbers\n        sanitised = sanitised.replace(PII_PATTERNS.phone, (match)=>{\n            replacements.push({\n                type: \"PHONE\",\n                original: match\n            });\n            return \"[PHONE_REDACTED]\";\n        });\n        // Remove emails\n        sanitised = sanitised.replace(PII_PATTERNS.email, (match)=>{\n            replacements.push({\n                type: \"EMAIL\",\n                original: match\n            });\n            return \"[EMAIL_REDACTED]\";\n        });\n        // Remove school names\n        sanitised = sanitised.replace(PII_PATTERNS.schoolName, (match)=>{\n            replacements.push({\n                type: \"SCHOOL\",\n                original: match\n            });\n            return \"[SCHOOL_REDACTED]\";\n        });\n        // Remove addresses\n        sanitised = sanitised.replace(PII_PATTERNS.address, (match)=>{\n            replacements.push({\n                type: \"ADDRESS\",\n                original: match\n            });\n            return \"[ADDRESS_REDACTED]\";\n        });\n        // Remove specific dates\n        sanitised = sanitised.replace(PII_PATTERNS.specificDate, (match)=>{\n            replacements.push({\n                type: \"DATE\",\n                original: match\n            });\n            return \"[DATE_REDACTED]\";\n        });\n        // In strict mode, also remove possible names\n        if (this.strictMode) {\n            sanitised = sanitised.replace(PII_PATTERNS.possibleName, (match)=>{\n                // Don't redact if it's a career name or common word\n                if (this._isCareerOrCommonTerm(match)) return match;\n                replacements.push({\n                    type: \"NAME\",\n                    original: match\n                });\n                return \"[NAME_REDACTED]\";\n            });\n        }\n        this._logSanitisation(\"text\", {\n            original: text,\n            replacements\n        }, sanitised);\n        return sanitised;\n    }\n    /**\r\n   * Generalise marks to ranges (POPIA minimisation principle)\r\n   */ _generaliseMarks(mark) {\n        if (mark === undefined || mark === null) return null;\n        // Round to nearest 5% to prevent re-identification\n        return Math.round(mark / 5) * 5;\n    }\n    _generaliseAllMarks(marks) {\n        if (!marks) return null;\n        const generalised = {};\n        for (const [subject, mark] of Object.entries(marks)){\n            generalised[subject] = this._generaliseMarks(mark);\n        }\n        return generalised;\n    }\n    /**\r\n   * Generalise location to province level only\r\n   */ _generaliseLocation(location) {\n        if (!location) return null;\n        const provinceMap = {\n            \"gauteng\": \"Gauteng\",\n            \"western cape\": \"Western Cape\",\n            \"kwazulu-natal\": \"KwaZulu-Natal\",\n            \"eastern cape\": \"Eastern Cape\",\n            \"free state\": \"Free State\",\n            \"limpopo\": \"Limpopo\",\n            \"mpumalanga\": \"Mpumalanga\",\n            \"northern cape\": \"Northern Cape\",\n            \"north west\": \"North West\"\n        };\n        const locationLower = location.toLowerCase();\n        // Check if location contains a province name\n        for (const [key, province] of Object.entries(provinceMap)){\n            if (locationLower.includes(key)) {\n                return province;\n            }\n        }\n        // If specific city, map to province\n        const cityToProvince = {\n            \"johannesburg\": \"Gauteng\",\n            \"pretoria\": \"Gauteng\",\n            \"cape town\": \"Western Cape\",\n            \"durban\": \"KwaZulu-Natal\",\n            \"port elizabeth\": \"Eastern Cape\",\n            \"bloemfontein\": \"Free State\",\n            \"polokwane\": \"Limpopo\",\n            \"nelspruit\": \"Mpumalanga\",\n            \"kimberley\": \"Northern Cape\",\n            \"mahikeng\": \"North West\"\n        };\n        for (const [city, province] of Object.entries(cityToProvince)){\n            if (locationLower.includes(city)) {\n                return province;\n            }\n        }\n        // Default: return null (don't include specific location)\n        return null;\n    }\n    /**\r\n   * Check if text is a career name or common term (don't redact)\r\n   */ _isCareerOrCommonTerm(text) {\n        const commonTerms = [\n            \"Data Scientist\",\n            \"Software Developer\",\n            \"Medical Doctor\",\n            \"Mechanical Engineer\",\n            \"Chartered Accountant\",\n            \"Corporate Lawyer\",\n            \"High School\",\n            \"Pure Mathematics\",\n            \"Physical Sciences\",\n            \"Life Sciences\",\n            \"Information Technology\"\n        ];\n        return commonTerms.some((term)=>text.toLowerCase().includes(term.toLowerCase()));\n    }\n    /**\r\n   * Sanitise free-text fields\r\n   */ _sanitiseText(text) {\n        if (!text) return text;\n        return this.sanitiseReportText(text);\n    }\n    /**\r\n   * Log sanitisation for audit trail (POPIA compliance requirement)\r\n   */ _logSanitisation(type, original, sanitised) {\n        if (!this.logSanitisation) return;\n        const entry = {\n            timestamp: new Date().toISOString(),\n            type,\n            piiDetected: this._detectPIITypes(original),\n            sanitised: true\n        };\n        this.auditTrail.push(entry);\n        // Log to console in development\n        if (true) {\n            console.log(\"[POPIA] Sanitisation:\", entry);\n        }\n    }\n    /**\r\n   * Detect types of PII present in data\r\n   */ _detectPIITypes(data) {\n        const types = [];\n        const dataStr = JSON.stringify(data);\n        if (PII_PATTERNS.idNumber.test(dataStr)) types.push(\"ID_NUMBER\");\n        if (PII_PATTERNS.phone.test(dataStr)) types.push(\"PHONE\");\n        if (PII_PATTERNS.email.test(dataStr)) types.push(\"EMAIL\");\n        if (PII_PATTERNS.schoolName.test(dataStr)) types.push(\"SCHOOL\");\n        if (PII_PATTERNS.address.test(dataStr)) types.push(\"ADDRESS\");\n        if (PII_PATTERNS.specificDate.test(dataStr)) types.push(\"DATE\");\n        return types;\n    }\n    /**\r\n   * Get audit trail for compliance reporting\r\n   */ getAuditTrail() {\n        return this.auditTrail;\n    }\n    /**\r\n   * Clear audit trail (call after persisting to database)\r\n   */ clearAuditTrail() {\n        this.auditTrail = [];\n    }\n    /**\r\n   * Validate that profile is sanitised (pre-flight check)\r\n   */ validateSanitised(profile) {\n        const violations = [];\n        // Check for direct identifiers\n        if (profile.studentId) violations.push(\"studentId present\");\n        if (profile.name) violations.push(\"name present\");\n        if (profile.surname) violations.push(\"surname present\");\n        if (profile.idNumber) violations.push(\"idNumber present\");\n        if (profile.email) violations.push(\"email present\");\n        if (profile.phone) violations.push(\"phone present\");\n        if (profile.schoolName) violations.push(\"schoolName present\");\n        if (profile.address) violations.push(\"address present\");\n        // Check for specific location (should be province only)\n        if (profile.location && !this._isProvinceOnly(profile.location)) {\n            violations.push(\"specific location present\");\n        }\n        // Check for exact marks (should be generalised)\n        if (profile.mathMark && profile.mathMark % 5 !== 0) {\n            violations.push(\"exact marks present (not generalised)\");\n        }\n        return {\n            valid: violations.length === 0,\n            violations\n        };\n    }\n    _isProvinceOnly(location) {\n        const provinces = [\n            \"Gauteng\",\n            \"Western Cape\",\n            \"KwaZulu-Natal\",\n            \"Eastern Cape\",\n            \"Free State\",\n            \"Limpopo\",\n            \"Mpumalanga\",\n            \"Northern Cape\",\n            \"North West\"\n        ];\n        return provinces.includes(location);\n    }\n}\n// Export singleton instance\nconst popiaSanitiser = new POPIASanitiser({\n    strictMode: true,\n    logSanitisation: true\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvY29tcGxpYW5jZS9wb3BpYS1zYW5pdGlzZXIuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSx3REFBd0Q7QUFDeEQsaUVBQWlFO0FBRWpFOzs7OztDQUtDLEdBRUQsTUFBTUEsZUFBZTtJQUNuQix1Q0FBdUM7SUFDdkNDLFVBQVU7SUFFViw0QkFBNEI7SUFDNUJDLE9BQU87SUFFUCxrQkFBa0I7SUFDbEJDLE9BQU87SUFFUCw2QkFBNkI7SUFDN0IsNERBQTREO0lBQzVEQyxjQUFjO0lBRWQsaUNBQWlDO0lBQ2pDQyxZQUFZO0lBRVosd0NBQXdDO0lBQ3hDQyxTQUFTO0lBRVQsd0NBQXdDO0lBQ3hDQyxjQUFjO0FBQ2hCO0FBRU8sTUFBTUM7SUFDWEMsWUFBWUMsVUFBVSxDQUFDLENBQUMsQ0FBRTtRQUN4QixJQUFJLENBQUNDLFVBQVUsR0FBR0QsUUFBUUMsVUFBVSxJQUFJO1FBQ3hDLElBQUksQ0FBQ0MsZUFBZSxHQUFHRixRQUFRRSxlQUFlLElBQUk7UUFDbEQsSUFBSSxDQUFDQyxVQUFVLEdBQUcsRUFBRTtJQUN0QjtJQUVBOzs7O0dBSUMsR0FDREMsZ0JBQWdCQyxPQUFPLEVBQUU7UUFDdkIsTUFBTUMsWUFBWTtZQUNoQiwwQ0FBMEM7WUFDMUNDLE9BQU9GLFFBQVFFLEtBQUs7WUFDcEJDLFVBQVVILFFBQVFHLFFBQVE7WUFDMUJDLFVBQVUsSUFBSSxDQUFDQyxnQkFBZ0IsQ0FBQ0wsUUFBUUksUUFBUTtZQUNoREUsVUFBVU4sUUFBUU0sUUFBUSxJQUFJLEVBQUU7WUFDaENDLE9BQU8sSUFBSSxDQUFDQyxtQkFBbUIsQ0FBQ1IsUUFBUU8sS0FBSztZQUU3Qyw2Q0FBNkM7WUFDN0NFLFVBQVUsSUFBSSxDQUFDQyxtQkFBbUIsQ0FBQ1YsUUFBUVcsUUFBUTtZQUVuRCxxQ0FBcUM7WUFDckNDLGFBQWFaLFFBQVFZLFdBQVc7WUFDaENDLFdBQVcsSUFBSSxDQUFDQyxhQUFhLENBQUNkLFFBQVFhLFNBQVM7WUFDL0NFLG1CQUFtQixJQUFJLENB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MkQsaUJBQWlCLElBQUk3RSxlQUFlO0lBQy9DRyxZQUFZO0lBQ1pDLGlCQUFpQjtBQUNuQixHQUFHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGhhbmRpLXJhZy1zeXN0ZW0vLi9saWIvY29tcGxpYW5jZS9wb3BpYS1zYW5pdGlzZXIuanM/YjNmYyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBQT1BJQSBTYW5pdGlzZXIgLSBTdHJpcCBQSUkgYmVmb3JlIGV4dGVybmFsIEFQSSBjYWxsc1xyXG4vLyBSZXF1aXJlZCBieSBQT1BJQSBBY3QgNCBvZiAyMDEzIC0gUjEwTSBmaW5lIGZvciBub24tY29tcGxpYW5jZVxyXG5cclxuLyoqXHJcbiAqIFBJSSBDYXRlZ29yaWVzIHBlciBQT1BJQTpcclxuICogLSBEaXJlY3QgaWRlbnRpZmllcnM6IE5hbWVzLCBJRCBudW1iZXJzLCBjb250YWN0IGRldGFpbHNcclxuICogLSBRdWFzaS1pZGVudGlmaWVyczogU2Nob29sIG5hbWVzLCBzcGVjaWZpYyBsb2NhdGlvbnMsIGRhdGVzXHJcbiAqIC0gU2Vuc2l0aXZlIGRhdGE6IFJhY2UsIGhlYWx0aCwgYmlvbWV0cmljIGRhdGFcclxuICovXHJcblxyXG5jb25zdCBQSUlfUEFUVEVSTlMgPSB7XHJcbiAgLy8gU291dGggQWZyaWNhbiBJRCBudW1iZXJzICgxMyBkaWdpdHMpXHJcbiAgaWROdW1iZXI6IC9cXGJcXGR7MTN9XFxiL2csXHJcbiAgXHJcbiAgLy8gUGhvbmUgbnVtYmVycyAoU0EgZm9ybWF0KVxyXG4gIHBob25lOiAvXFxiKD86XFwrMjd8MClbNi04XVxcZHs4fVxcYi9nLFxyXG4gIFxyXG4gIC8vIEVtYWlsIGFkZHJlc3Nlc1xyXG4gIGVtYWlsOiAvXFxiW0EtWmEtejAtOS5fJSstXStAW0EtWmEtejAtOS4tXStcXC5bQS1afGEtel17Mix9XFxiL2csXHJcbiAgXHJcbiAgLy8gTmFtZXMgKGNvbW1vbiBTQSBwYXR0ZXJucylcclxuICAvLyBNYXRjaCBjYXBpdGFsaXplZCB3b3JkcyB0aGF0IGxvb2sgbGlrZSBuYW1lcyAoMi0yMCBjaGFycylcclxuICBwb3NzaWJsZU5hbWU6IC9cXGJbQS1aXVthLXpdezEsMTl9XFxzK1tBLVpdW2Etel17MSwxOX1cXGIvZyxcclxuICBcclxuICAvLyBTY2hvb2wgbmFtZXMgKGNvbW1vbiBwYXR0ZXJucylcclxuICBzY2hvb2xOYW1lOiAvKEhpZ2ggU2Nob29sfFByaW1hcnkgU2Nob29sfENvbGxlZ2V8QWNhZGVteXxTY2hvb2wpXFxiL2dpLFxyXG4gIFxyXG4gIC8vIFNwZWNpZmljIGxvY2F0aW9ucyAoc3RyZWV0IGFkZHJlc3NlcylcclxuICBhZGRyZXNzOiAvXFxiXFxkK1xccytbQS1aXVthLXpdK1xccysoU3RyZWV0fFJvYWR8QXZlbnVlfERyaXZlfExhbmUpXFxiL2dpLFxyXG4gIFxyXG4gIC8vIERhdGVzIHRoYXQgY291bGQgaWRlbnRpZnkgaW5kaXZpZHVhbHNcclxuICBzcGVjaWZpY0RhdGU6IC9cXGJcXGR7MSwyfVstL11cXGR7MSwyfVstL11cXGR7Miw0fVxcYi9nXHJcbn07XHJcblxyXG5leHBvcnQgY2xhc3MgUE9QSUFTYW5pdGlzZXIge1xyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xyXG4gICAgdGhpcy5zdHJpY3RNb2RlID0gb3B0aW9ucy5zdHJpY3RNb2RlID8/IHRydWU7XHJcbiAgICB0aGlzLmxvZ1Nhbml0aXNhdGlvbiA9IG9wdGlvbnMubG9nU2FuaXRpc2F0aW9uID8/IHRydWU7XHJcbiAgICB0aGlzLmF1ZGl0VHJhaWwgPSBbXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNhbml0aXNlIHN0dWRlbnQgcHJvZmlsZSBiZWZvcmUgZXh0ZXJuYWwgQVBJIGNhbGxcclxuICAgKiBAcGFyYW0ge09iamVjdH0gcHJvZmlsZSAtIFN0dWRlbnQgcHJvZmlsZSB3aXRoIHBvdGVudGlhbCBQSUlcclxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSAtIFNhbml0aXNlZCBwcm9maWxlIHNhZmUgZm9yIGV4dGVybmFsIHByb2Nlc3NpbmdcclxuICAgKi9cclxuICBzYW5pdGlzZVByb2ZpbGUocHJvZmlsZSkge1xyXG4gICAgY29uc3Qgc2FuaXRpc2VkID0ge1xyXG4gICAgICAvLyBLZWVwIG9ubHkgbm9uLWlkZW50aWZ5aW5nIGFjYWRlbWljIGRhdGFcclxuICAgICAgZ3JhZGU6IHByb2ZpbGUuZ3JhZGUsXHJcbiAgICAgIG1hdGhUeXBlOiBwcm9maWxlLm1hdGhUeXBlLFxyXG4gICAgICBtYXRoTWFyazogdGhpcy5fZ2VuZXJhbGlzZU1hcmtzKHByb2ZpbGUubWF0aE1hcmspLFxyXG4gICAgICBzdWJqZWN0czogcHJvZmlsZS5zdWJqZWN0cyB8fCBbXSxcclxuICAgICAgbWFya3M6IHRoaXMuX2dlbmVyYWxpc2VBbGxNYXJrcyhwcm9maWxlLm1hcmtzKSxcclxuICAgICAgXHJcbiAgICAgIC8vIEdlbmVyYWxpc2UgbG9jYXRpb24gdG8gcHJvdmluY2UgbGV2ZWwgb25seVxyXG4gICAgICBwcm92aW5jZTogdGhpcy5fZ2VuZXJhbGlzZUxvY2F0aW9uKHByb2ZpbGUubG9jYXRpb24pLFxyXG4gICAgICBcclxuICAgICAgLy8gS2VlcCBwcmVmZXJlbmNlcyBidXQgc2FuaXRpc2UgdGV4dFxyXG4gICAgICBidWRnZXRMaW1pdDogcHJvZmlsZS5idWRnZXRMaW1pdCxcclxuICAgICAgaW50ZXJlc3RzOiB0aGlzLl9zYW5pdGlzZVRleHQocHJvZmlsZS5pbnRlcmVzdHMpLFxyXG4gICAgICBjYXJlZXJQcmVmZXJlbmNlczogdGhpcy5fc2FuaXRpc2VUZXh0KHByb2ZpbGUuY2FyZWVyUHJlZmVyZW5jZXMpLFxyXG4gICAgICBcclxuICAgICAgLy8gUmVtb3ZlIGFsbCBkaXJlY3QgaWRlbnRpZmllcnNcclxuICAgICAgLy8gc3R1ZGVudElkOiBSRU1PVkVEXHJcbiAgICAgIC8vIG5hbWU6IFJFTU9WRURcclxuICAgICAgLy8gc3VybmFtZTogUkVNT1ZFRFxyXG4gICAgICAvLyBpZE51bWJlcjogUkVNT1ZFRFxyXG4gICAgICAvLyBlbWFpbDogUkVNT1ZFRFxyXG4gICAgICAvLyBwaG9uZTogUkVNT1ZFRFxyXG4gICAgICAvLyBzY2hvb2xOYW1lOiBSRU1PVkVEXHJcbiAgICAgIC8vIGFkZHJlc3M6IFJFTU9WRURcclxuICAgIH07XHJcblxyXG4gICAgLy8gQXVkaXQgdHJhaWxcclxuICAgIHRoaXMuX2xvZ1Nhbml0aXNhdGlvbigncHJvZmlsZScsIHByb2ZpbGUsIHNhbml0aXNlZCk7XHJcblxyXG4gICAgcmV0dXJuIHNhbml0aXNlZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNhbml0aXNlIHJlcG9ydCB0ZXh0IGJlZm9yZSBleHRlcm5hbCBwcm9jZXNzaW5nXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgLSBSZXBvcnQgdGV4dCB0aGF0IG1heSBjb250YWluIFBJSVxyXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IC0gU2FuaXRpc2VkIHRleHRcclxuICAgKi9cclxuICBzYW5pdGlzZVJlcG9ydFRleHQodGV4dCkge1xyXG4gICAgaWYgKCF0ZXh0KSByZXR1cm4gdGV4dDtcclxuXHJcbiAgICBsZXQgc2FuaXRpc2VkID0gdGV4dDtcclxuICAgIGNvbnN0IHJlcGxhY2VtZW50cyA9IFtdO1xyXG5cclxuICAgIC8vIFJlbW92ZSBJRCBudW1iZXJzXHJcbiAgICBzYW5pdGlzZWQgPSBzYW5pdGlzZWQucmVwbGFjZShQSUlfUEFUVEVSTlMuaWROdW1iZXIsIChtYXRjaCkgPT4ge1xyXG4gICAgICByZXBsYWNlbWVudHMucHVzaCh7IHR5cGU6ICdJRF9OVU1CRVInLCBvcmlnaW5hbDogbWF0Y2ggfSk7XHJcbiAgICAgIHJldHVybiAnW0lEX1JFREFDVEVEXSc7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBSZW1vdmUgcGhvbmUgbnVtYmVyc1xyXG4gICAgc2FuaXRpc2VkID0gc2FuaXRpc2VkLnJlcGxhY2UoUElJX1BBVFRFUk5TLnBob25lLCAobWF0Y2gpID0+IHtcclxuICAgICAgcmVwbGFjZW1lbnRzLnB1c2goeyB0eXBlOiAnUEhPTkUnLCBvcmlnaW5hbDogbWF0Y2ggfSk7XHJcbiAgICAgIHJldHVybiAnW1BIT05FX1JFREFDVEVEXSc7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBSZW1vdmUgZW1haWxzXHJcbiAgICBzYW5pdGlzZWQgPSBzYW5pdGlzZWQucmVwbGFjZShQSUlfUEFUVEVSTlMuZW1haWwsIChtYXRjaCkgPT4ge1xyXG4gICAgICByZXBsYWNlbWVudHMucHVzaCh7IHR5cGU6ICdFTUFJTCcsIG9yaWdpbmFsOiBtYXRjaCB9KTtcclxuICAgICAgcmV0dXJuICdbRU1BSUxfUkVEQUNURURdJztcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFJlbW92ZSBzY2hvb2wgbmFtZXNcclxuICAgIHNhbml0aXNlZCA9IHNhbml0aXNlZC5yZXBsYWNlKFBJSV9QQVRURVJOUy5zY2hvb2xOYW1lLCAobWF0Y2gpID0+IHtcclxuICAgICAgcmVwbGFjZW1lbnRzLnB1c2goeyB0eXBlOiAnU0NIT09MJywgb3JpZ2luYWw6IG1hdGNoIH0pO1xyXG4gICAgICByZXR1cm4gJ1tTQ0hPT0xfUkVEQUNURURdJztcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFJlbW92ZSBhZGRyZXNzZXNcclxuICAgIHNhbml0aXNlZCA9IHNhbml0aXNlZC5yZXBsYWNlKFBJSV9QQVRURVJOUy5hZGRyZXNzLCAobWF0Y2gpID0+IHtcclxuICAgICAgcmVwbGFjZW1lbnRzLnB1c2goeyB0eXBlOiAnQUREUkVTUycsIG9yaWdpbmFsOiBtYXRjaCB9KTtcclxuICAgICAgcmV0dXJuICdbQUREUkVTU19SRURBQ1RFRF0nO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gUmVtb3ZlIHNwZWNpZmljIGRhdGVzXHJcbiAgICBzYW5pdGlzZWQgPSBzYW5pdGlzZWQucmVwbGFjZShQSUlfUEFUVEVSTlMuc3BlY2lmaWNEYXRlLCAobWF0Y2gpID0+IHtcclxuICAgICAgcmVwbGFjZW1lbnRzLnB1c2goeyB0eXBlOiAnREFURScsIG9yaWdpbmFsOiBtYXRjaCB9KTtcclxuICAgICAgcmV0dXJuICdbREFURV9SRURBQ1RFRF0nO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gSW4gc3RyaWN0IG1vZGUsIGFsc28gcmVtb3ZlIHBvc3NpYmxlIG5hbWVzXHJcbiAgICBpZiAodGhpcy5zdHJpY3RNb2RlKSB7XHJcbiAgICAgIHNhbml0aXNlZCA9IHNhbml0aXNlZC5yZXBsYWNlKFBJSV9QQVRURVJOUy5wb3NzaWJsZU5hbWUsIChtYXRjaCkgPT4ge1xyXG4gICAgICAgIC8vIERvbid0IHJlZGFjdCBpZiBpdCdzIGEgY2FyZWVyIG5hbWUgb3IgY29tbW9uIHdvcmRcclxuICAgICAgICBpZiAodGhpcy5faXNDYXJlZXJPckNvbW1vblRlcm0obWF0Y2gpKSByZXR1cm4gbWF0Y2g7XHJcbiAgICAgICAgcmVwbGFjZW1lbnRzLnB1c2goeyB0eXBlOiAnTkFNRScsIG9yaWdpbmFsOiBtYXRjaCB9KTtcclxuICAgICAgICByZXR1cm4gJ1tOQU1FX1JFREFDVEVEXSc7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX2xvZ1Nhbml0aXNhdGlvbigndGV4dCcsIHsgb3JpZ2luYWw6IHRleHQsIHJlcGxhY2VtZW50cyB9LCBzYW5pdGlzZWQpO1xyXG5cclxuICAgIHJldHVybiBzYW5pdGlzZWQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmFsaXNlIG1hcmtzIHRvIHJhbmdlcyAoUE9QSUEgbWluaW1pc2F0aW9uIHByaW5jaXBsZSlcclxuICAgKi9cclxuICBfZ2VuZXJhbGlzZU1hcmtzKG1hcmspIHtcclxuICAgIGlmIChtYXJrID09PSB1bmRlZmluZWQgfHwgbWFyayA9PT0gbnVsbCkgcmV0dXJuIG51bGw7XHJcbiAgICBcclxuICAgIC8vIFJvdW5kIHRvIG5lYXJlc3QgNSUgdG8gcHJldmVudCByZS1pZGVudGlmaWNhdGlvblxyXG4gICAgcmV0dXJuIE1hdGgucm91bmQobWFyayAvIDUpICogNTtcclxuICB9XHJcblxyXG4gIF9nZW5lcmFsaXNlQWxsTWFya3MobWFya3MpIHtcclxuICAgIGlmICghbWFya3MpIHJldHVybiBudWxsO1xyXG4gICAgXHJcbiAgICBjb25zdCBnZW5lcmFsaXNlZCA9IHt9O1xyXG4gICAgZm9yIChjb25zdCBbc3ViamVjdCwgbWFya10gb2YgT2JqZWN0LmVudHJpZXMobWFya3MpKSB7XHJcbiAgICAgIGdlbmVyYWxpc2VkW3N1YmplY3RdID0gdGhpcy5fZ2VuZXJhbGlzZU1hcmtzKG1hcmspO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGdlbmVyYWxpc2VkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2VuZXJhbGlzZSBsb2NhdGlvbiB0byBwcm92aW5jZSBsZXZlbCBvbmx5XHJcbiAgICovXHJcbiAgX2dlbmVyYWxpc2VMb2NhdGlvbihsb2NhdGlvbikge1xyXG4gICAgaWYgKCFsb2NhdGlvbikgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgY29uc3QgcHJvdmluY2VNYXAgPSB7XHJcbiAgICAgICdnYXV0ZW5nJzogJ0dhdXRlbmcnLFxyXG4gICAgICAnd2VzdGVybiBjYXBlJzogJ1dlc3Rlcm4gQ2FwZScsXHJcbiAgICAgICdrd2F6dWx1LW5hdGFsJzogJ0t3YVp1bHUtTmF0YWwnLFxyXG4gICAgICAnZWFzdGVybiBjYXBlJzogJ0Vhc3Rlcm4gQ2FwZScsXHJcbiAgICAgICdmcmVlIHN0YXRlJzogJ0ZyZWUgU3RhdGUnLFxyXG4gICAgICAnbGltcG9wbyc6ICdMaW1wb3BvJyxcclxuICAgICAgJ21wdW1hbGFuZ2EnOiAnTXB1bWFsYW5nYScsXHJcbiAgICAgICdub3J0aGVybiBjYXBlJzogJ05vcnRoZXJuIENhcGUnLFxyXG4gICAgICAnbm9ydGggd2VzdCc6ICdOb3J0aCBXZXN0J1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBsb2NhdGlvbkxvd2VyID0gbG9jYXRpb24udG9Mb3dlckNhc2UoKTtcclxuICAgIFxyXG4gICAgLy8gQ2hlY2sgaWYgbG9jYXRpb24gY29udGFpbnMgYSBwcm92aW5jZSBuYW1lXHJcbiAgICBmb3IgKGNvbnN0IFtrZXksIHByb3ZpbmNlXSBvZiBPYmplY3QuZW50cmllcyhwcm92aW5jZU1hcCkpIHtcclxuICAgICAgaWYgKGxvY2F0aW9uTG93ZXIuaW5jbHVkZXMoa2V5KSkge1xyXG4gICAgICAgIHJldHVybiBwcm92aW5jZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNwZWNpZmljIGNpdHksIG1hcCB0byBwcm92aW5jZVxyXG4gICAgY29uc3QgY2l0eVRvUHJvdmluY2UgPSB7XHJcbiAgICAgICdqb2hhbm5lc2J1cmcnOiAnR2F1dGVuZycsXHJcbiAgICAgICdwcmV0b3JpYSc6ICdHYXV0ZW5nJyxcclxuICAgICAgJ2NhcGUgdG93bic6ICdXZXN0ZXJuIENhcGUnLFxyXG4gICAgICAnZHVyYmFuJzogJ0t3YVp1bHUtTmF0YWwnLFxyXG4gICAgICAncG9ydCBlbGl6YWJldGgnOiAnRWFzdGVybiBDYXBlJyxcclxuICAgICAgJ2Jsb2VtZm9udGVpbic6ICdGcmVlIFN0YXRlJyxcclxuICAgICAgJ3BvbG9rd2FuZSc6ICdMaW1wb3BvJyxcclxuICAgICAgJ25lbHNwcnVpdCc6ICdNcHVtYWxhbmdhJyxcclxuICAgICAgJ2tpbWJlcmxleSc6ICdOb3J0aGVybiBDYXBlJyxcclxuICAgICAgJ21haGlrZW5nJzogJ05vcnRoIFdlc3QnXHJcbiAgICB9O1xyXG5cclxuICAgIGZvciAoY29uc3QgW2NpdHksIHByb3ZpbmNlXSBvZiBPYmplY3QuZW50cmllcyhjaXR5VG9Qcm92aW5jZSkpIHtcclxuICAgICAgaWYgKGxvY2F0aW9uTG93ZXIuaW5jbHVkZXMoY2l0eSkpIHtcclxuICAgICAgICByZXR1cm4gcHJvdmluY2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWZhdWx0OiByZXR1cm4gbnVsbCAoZG9uJ3QgaW5jbHVkZSBzcGVjaWZpYyBsb2NhdGlvbilcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgdGV4dCBpcyBhIGNhcmVlciBuYW1lIG9yIGNvbW1vbiB0ZXJtIChkb24ndCByZWRhY3QpXHJcbiAgICovXHJcbiAgX2lzQ2FyZWVyT3JDb21tb25UZXJtKHRleHQpIHtcclxuICAgIGNvbnN0IGNvbW1vblRlcm1zID0gW1xyXG4gICAgICAnRGF0YSBTY2llbnRpc3QnLCAnU29mdHdhcmUgRGV2ZWxvcGVyJywgJ01lZGljYWwgRG9jdG9yJyxcclxuICAgICAgJ01lY2hhbmljYWwgRW5naW5lZXInLCAnQ2hhcnRlcmVkIEFjY291bnRhbnQnLCAnQ29ycG9yYXRlIExhd3llcicsXHJcbiAgICAgICdIaWdoIFNjaG9vbCcsICdQdXJlIE1hdGhlbWF0aWNzJywgJ1BoeXNpY2FsIFNjaWVuY2VzJyxcclxuICAgICAgJ0xpZmUgU2NpZW5jZXMnLCAnSW5mb3JtYXRpb24gVGVjaG5vbG9neSdcclxuICAgIF07XHJcblxyXG4gICAgcmV0dXJuIGNvbW1vblRlcm1zLnNvbWUodGVybSA9PiBcclxuICAgICAgdGV4dC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0udG9Mb3dlckNhc2UoKSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTYW5pdGlzZSBmcmVlLXRleHQgZmllbGRzXHJcbiAgICovXHJcbiAgX3Nhbml0aXNlVGV4dCh0ZXh0KSB7XHJcbiAgICBpZiAoIXRleHQpIHJldHVybiB0ZXh0O1xyXG4gICAgcmV0dXJuIHRoaXMuc2FuaXRpc2VSZXBvcnRUZXh0KHRleHQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTG9nIHNhbml0aXNhdGlvbiBmb3IgYXVkaXQgdHJhaWwgKFBPUElBIGNvbXBsaWFuY2UgcmVxdWlyZW1lbnQpXHJcbiAgICovXHJcbiAgX2xvZ1Nhbml0aXNhdGlvbih0eXBlLCBvcmlnaW5hbCwgc2FuaXRpc2VkKSB7XHJcbiAgICBpZiAoIXRoaXMubG9nU2FuaXRpc2F0aW9uKSByZXR1cm47XHJcblxyXG4gICAgY29uc3QgZW50cnkgPSB7XHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICB0eXBlLFxyXG4gICAgICBwaWlEZXRlY3RlZDogdGhpcy5fZGV0ZWN0UElJVHlwZXMob3JpZ2luYWwpLFxyXG4gICAgICBzYW5pdGlzZWQ6IHRydWVcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5hdWRpdFRyYWlsLnB1c2goZW50cnkpO1xyXG5cclxuICAgIC8vIExvZyB0byBjb25zb2xlIGluIGRldmVsb3BtZW50XHJcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1tQT1BJQV0gU2FuaXRpc2F0aW9uOicsIGVudHJ5KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERldGVjdCB0eXBlcyBvZiBQSUkgcHJlc2VudCBpbiBkYXRhXHJcbiAgICovXHJcbiAgX2RldGVjdFBJSVR5cGVzKGRhdGEpIHtcclxuICAgIGNvbnN0IHR5cGVzID0gW107XHJcbiAgICBjb25zdCBkYXRhU3RyID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XHJcblxyXG4gICAgaWYgKFBJSV9QQVRURVJOUy5pZE51bWJlci50ZXN0KGRhdGFTdHIpKSB0eXBlcy5wdXNoKCdJRF9OVU1CRVInKTtcclxuICAgIGlmIChQSUlfUEFUVEVSTlMucGhvbmUudGVzdChkYXRhU3RyKSkgdHlwZXMucHVzaCgnUEhPTkUnKTtcclxuICAgIGlmIChQSUlfUEFUVEVSTlMuZW1haWwudGVzdChkYXRhU3RyKSkgdHlwZXMucHVzaCgnRU1BSUwnKTtcclxuICAgIGlmIChQSUlfUEFUVEVSTlMuc2Nob29sTmFtZS50ZXN0KGRhdGFTdHIpKSB0eXBlcy5wdXNoKCdTQ0hPT0wnKTtcclxuICAgIGlmIChQSUlfUEFUVEVSTlMuYWRkcmVzcy50ZXN0KGRhdGFTdHIpKSB0eXBlcy5wdXNoKCdBRERSRVNTJyk7XHJcbiAgICBpZiAoUElJX1BBVFRFUk5TLnNwZWNpZmljRGF0ZS50ZXN0KGRhdGFTdHIpKSB0eXBlcy5wdXNoKCdEQVRFJyk7XHJcblxyXG4gICAgcmV0dXJuIHR5cGVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGF1ZGl0IHRyYWlsIGZvciBjb21wbGlhbmNlIHJlcG9ydGluZ1xyXG4gICAqL1xyXG4gIGdldEF1ZGl0VHJhaWwoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5hdWRpdFRyYWlsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2xlYXIgYXVkaXQgdHJhaWwgKGNhbGwgYWZ0ZXIgcGVyc2lzdGluZyB0byBkYXRhYmFzZSlcclxuICAgKi9cclxuICBjbGVhckF1ZGl0VHJhaWwoKSB7XHJcbiAgICB0aGlzLmF1ZGl0VHJhaWwgPSBbXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZhbGlkYXRlIHRoYXQgcHJvZmlsZSBpcyBzYW5pdGlzZWQgKHByZS1mbGlnaHQgY2hlY2spXHJcbiAgICovXHJcbiAgdmFsaWRhdGVTYW5pdGlzZWQocHJvZmlsZSkge1xyXG4gICAgY29uc3QgdmlvbGF0aW9ucyA9IFtdO1xyXG5cclxuICAgIC8vIENoZWNrIGZvciBkaXJlY3QgaWRlbnRpZmllcnNcclxuICAgIGlmIChwcm9maWxlLnN0dWRlbnRJZCkgdmlvbGF0aW9ucy5wdXNoKCdzdHVkZW50SWQgcHJlc2VudCcpO1xyXG4gICAgaWYgKHByb2ZpbGUubmFtZSkgdmlvbGF0aW9ucy5wdXNoKCduYW1lIHByZXNlbnQnKTtcclxuICAgIGlmIChwcm9maWxlLnN1cm5hbWUpIHZpb2xhdGlvbnMucHVzaCgnc3VybmFtZSBwcmVzZW50Jyk7XHJcbiAgICBpZiAocHJvZmlsZS5pZE51bWJlcikgdmlvbGF0aW9ucy5wdXNoKCdpZE51bWJlciBwcmVzZW50Jyk7XHJcbiAgICBpZiAocHJvZmlsZS5lbWFpbCkgdmlvbGF0aW9ucy5wdXNoKCdlbWFpbCBwcmVzZW50Jyk7XHJcbiAgICBpZiAocHJvZmlsZS5waG9uZSkgdmlvbGF0aW9ucy5wdXNoKCdwaG9uZSBwcmVzZW50Jyk7XHJcbiAgICBpZiAocHJvZmlsZS5zY2hvb2xOYW1lKSB2aW9sYXRpb25zLnB1c2goJ3NjaG9vbE5hbWUgcHJlc2VudCcpO1xyXG4gICAgaWYgKHByb2ZpbGUuYWRkcmVzcykgdmlvbGF0aW9ucy5wdXNoKCdhZGRyZXNzIHByZXNlbnQnKTtcclxuXHJcbiAgICAvLyBDaGVjayBmb3Igc3BlY2lmaWMgbG9jYXRpb24gKHNob3VsZCBiZSBwcm92aW5jZSBvbmx5KVxyXG4gICAgaWYgKHByb2ZpbGUubG9jYXRpb24gJiYgIXRoaXMuX2lzUHJvdmluY2VPbmx5KHByb2ZpbGUubG9jYXRpb24pKSB7XHJcbiAgICAgIHZpb2xhdGlvbnMucHVzaCgnc3BlY2lmaWMgbG9jYXRpb24gcHJlc2VudCcpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGZvciBleGFjdCBtYXJrcyAoc2hvdWxkIGJlIGdlbmVyYWxpc2VkKVxyXG4gICAgaWYgKHByb2ZpbGUubWF0aE1hcmsgJiYgcHJvZmlsZS5tYXRoTWFyayAlIDUgIT09IDApIHtcclxuICAgICAgdmlvbGF0aW9ucy5wdXNoKCdleGFjdCBtYXJrcyBwcmVzZW50IChub3QgZ2VuZXJhbGlzZWQpJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdmFsaWQ6IHZpb2xhdGlvbnMubGVuZ3RoID09PSAwLFxyXG4gICAgICB2aW9sYXRpb25zXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgX2lzUHJvdmluY2VPbmx5KGxvY2F0aW9uKSB7XHJcbiAgICBjb25zdCBwcm92aW5jZXMgPSBbXHJcbiAgICAgICdHYXV0ZW5nJywgJ1dlc3Rlcm4gQ2FwZScsICdLd2FadWx1LU5hdGFsJywgJ0Vhc3Rlcm4gQ2FwZScsXHJcbiAgICAgICdGcmVlIFN0YXRlJywgJ0xpbXBvcG8nLCAnTXB1bWFsYW5nYScsICdOb3J0aGVybiBDYXBlJywgJ05vcnRoIFdlc3QnXHJcbiAgICBdO1xyXG4gICAgcmV0dXJuIHByb3ZpbmNlcy5pbmNsdWRlcyhsb2NhdGlvbik7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXHJcbmV4cG9ydCBjb25zdCBwb3BpYVNhbml0aXNlciA9IG5ldyBQT1BJQVNhbml0aXNlcih7XHJcbiAgc3RyaWN0TW9kZTogdHJ1ZSxcclxuICBsb2dTYW5pdGlzYXRpb246IHRydWVcclxufSk7XHJcbiJdLCJuYW1lcyI6WyJQSUlfUEFUVEVSTlMiLCJpZE51bWJlciIsInBob25lIiwiZW1haWwiLCJwb3NzaWJsZU5hbWUiLCJzY2hvb2xOYW1lIiwiYWRkcmVzcyIsInNwZWNpZmljRGF0ZSIsIlBPUElBU2FuaXRpc2VyIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwic3RyaWN0TW9kZSIsImxvZ1Nhbml0aXNhdGlvbiIsImF1ZGl0VHJhaWwiLCJzYW5pdGlzZVByb2ZpbGUiLCJwcm9maWxlIiwic2FuaXRpc2VkIiwiZ3JhZGUiLCJtYXRoVHlwZSIsIm1hdGhNYXJrIiwiX2dlbmVyYWxpc2VNYXJrcyIsInN1YmplY3RzIiwibWFya3MiLCJfZ2VuZXJhbGlzZUFsbE1hcmtzIiwicHJvdmluY2UiLCJfZ2VuZXJhbGlzZUxvY2F0aW9uIiwibG9jYXRpb24iLCJidWRnZXRMaW1pdCIsImludGVyZXN0cyIsIl9zYW5pdGlzZVRleHQiLCJjYXJlZXJQcmVmZXJlbmNlcyIsIl9sb2dTYW5pdGlzYXRpb24iLCJzYW5pdGlzZVJlcG9ydFRleHQiLCJ0ZXh0IiwicmVwbGFjZW1lbnRzIiwicmVwbGFjZSIsIm1hdGNoIiwicHVzaCIsInR5cGUiLCJvcmlnaW5hbCIsIl9pc0NhcmVlck9yQ29tbW9uVGVybSIsIm1hcmsiLCJ1bmRlZmluZWQiLCJNYXRoIiwicm91bmQiLCJnZW5lcmFsaXNlZCIsInN1YmplY3QiLCJPYmplY3QiLCJlbnRyaWVzIiwicHJvdmluY2VNYXAiLCJsb2NhdGlvbkxvd2VyIiwidG9Mb3dlckNhc2UiLCJrZXkiLCJpbmNsdWRlcyIsImNpdHlUb1Byb3ZpbmNlIiwiY2l0eSIsImNvbW1vblRlcm1zIiwic29tZSIsInRlcm0iLCJlbnRyeSIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInBpaURldGVjdGVkIiwiX2RldGVjdFBJSVR5cGVzIiwicHJvY2VzcyIsImNvbnNvbGUiLCJsb2ciLCJkYXRhIiwidHlwZXMiLCJkYXRhU3RyIiwiSlNPTiIsInN0cmluZ2lmeSIsInRlc3QiLCJnZXRBdWRpdFRyYWlsIiwiY2xlYXJBdWRpdFRyYWlsIiwidmFsaWRhdGVTYW5pdGlzZWQiLCJ2aW9sYXRpb25zIiwic3R1ZGVudElkIiwibmFtZSIsInN1cm5hbWUiLCJfaXNQcm92aW5jZU9ubHkiLCJ2YWxpZCIsImxlbmd0aCIsInByb3ZpbmNlcyIsInBvcGlhU2FuaXRpc2VyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/compliance/popia-sanitiser.js\n");

/***/ }),

/***/ "(rsc)/./lib/curriculum/query-gates-simple.js":
/*!**********************************************!*\
  !*** ./lib/curriculum/query-gates-simple.js ***!
  \**********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getRelevantGate: () => (/* binding */ getRelevantGate),\n/* harmony export */   shouldShowGate: () => (/* binding */ shouldShowGate)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// Simplified gate query - keyword matching for MVP\n\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://pvvnxupuukuefajypovz.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY);\n/**\r\n * Get relevant curriculum gate using keyword matching\r\n * This is the MVP approach - works without vector search function\r\n */ async function getRelevantGate(studentGrade, studentSubjects, studentQuery) {\n    console.log(\"\\uD83D\\uDD0D Querying curriculum gates...\");\n    console.log(\"Grade:\", studentGrade);\n    console.log(\"Subjects:\", studentSubjects);\n    console.log(\"Query:\", studentQuery);\n    // Fetch all curriculum gates\n    const { data: chunks, error } = await supabase.from(\"knowledge_chunks\").select(\"*\").eq(\"source_entity_type\", \"curriculum_gate\");\n    if (error) {\n        console.error(\"❌ Error querying gates:\", error);\n        return null;\n    }\n    if (!chunks || chunks.length === 0) {\n        console.log(\"⚠️ No gates found in database\");\n        return null;\n    }\n    // Keyword matching logic\n    const query = studentQuery.toLowerCase();\n    const subjectsLower = studentSubjects.map((s)=>s.toLowerCase());\n    let bestMatch = null;\n    let bestScore = 0;\n    for (const chunk of chunks){\n        const metadata = chunk.chunk_metadata;\n        const text = chunk.chunk_text.toLowerCase();\n        let score = 0;\n        // Rule 1: Math Lit + Engineering query\n        if ((subjectsLower.includes(\"mathematical literacy\") || subjectsLower.includes(\"math lit\")) && (query.includes(\"engineer\") || query.includes(\"stem\"))) {\n            if (metadata.gate_type === \"irreversible\") {\n                score = 100;\n            }\n        }\n        // Rule 2: APS + Medicine/high requirement query\n        if (query.includes(\"aps\") && (query.includes(\"medicine\") || query.includes(\"engineering\"))) {\n            if (metadata.gate_type === \"aps_shortfall\") {\n                score = 100;\n            }\n        }\n        // Rule 3: IEB query\n        if (query.includes(\"ieb\") || query.includes(\"independent\")) {\n            if (metadata.gate_type === \"curriculum_type\") {\n                score = 100;\n            }\n        }\n        // Rule 4: Grade 11/12 + change/drop subjects\n        if ((studentGrade === 11 || studentGrade === 12) && (query.includes(\"change\") || query.includes(\"drop\") || query.includes(\"switch\"))) {\n            if (metadata.gate_type === \"deadline\") {\n                score = 100;\n            }\n        }\n        // Rule 5: Medicine + missing Physical Sciences\n        if (query.includes(\"medicine\") && !subjectsLower.includes(\"physical sciences\")) {\n            if (metadata.gate_type === \"subject_chain\") {\n                score = 100;\n            }\n        }\n        // Grade level match bonus\n        if (metadata.grade_level && metadata.grade_level.includes(studentGrade.toString())) {\n            score += 10;\n        }\n        // Update best match\n        if (score > bestScore) {\n            bestScore = score;\n            bestMatch = chunk;\n        }\n    }\n    if (!bestMatch) {\n        console.log(\"⚠️ No matching gate found\");\n        return null;\n    }\n    console.log(\"✅ Retrieved gate:\", bestMatch.chunk_metadata.gate_type);\n    console.log(\"RAG retrieved:\", bestMatch.chunk_metadata.gate_type);\n    return {\n        text: bestMatch.chunk_text,\n        metadata: bestMatch.chunk_metadata,\n        similarity: bestScore / 100\n    };\n}\n/**\r\n * Check if gate should be shown in report\r\n */ function shouldShowGate(gate, studentProfile) {\n    if (!gate || !gate.metadata) return false;\n    const { gate_type, subjects, urgency } = gate.metadata;\n    const studentSubjects = studentProfile.currentSubjects || [];\n    const studentSubjectsLower = studentSubjects.map((s)=>s.toLowerCase());\n    // CRITICAL FIX: Math Lit gate should ONLY show if student actually has Math Lit\n    if (gate_type === \"irreversible\" && subjects && subjects.includes(\"Mathematical Literacy\")) {\n        const hasMathLit = studentSubjectsLower.some((s)=>s.includes(\"mathematical literacy\") || s === \"math lit\");\n        const hasPureMath = studentSubjectsLower.some((s)=>s === \"mathematics\" && !s.includes(\"literacy\"));\n        // If student has Pure Math, don't show Math Lit gate\n        if (hasPureMath && !hasMathLit) {\n            return false;\n        }\n        // If student doesn't have Math Lit, don't show gate\n        if (!hasMathLit) {\n            return false;\n        }\n    }\n    // Always show critical gates (after Math Lit check)\n    if (urgency === \"critical\") return true;\n    // Show high urgency gates for Grade 10-11\n    if (urgency === \"high\" && studentProfile.grade <= 11) return true;\n    // Show medium urgency gates if relevant to query\n    if (urgency === \"medium\") return true;\n    return false;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvY3VycmljdWx1bS9xdWVyeS1nYXRlcy1zaW1wbGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsbURBQW1EO0FBQ0U7QUFFckQsTUFBTUMsV0FBV0QsbUVBQVlBLENBQzNCRSwwQ0FBb0MsRUFDcENBLFFBQVFDLEdBQUcsQ0FBQ0UseUJBQXlCO0FBR3ZDOzs7Q0FHQyxHQUNNLGVBQWVDLGdCQUFnQkMsWUFBWSxFQUFFQyxlQUFlLEVBQUVDLFlBQVk7SUFDL0VDLFFBQVFDLEdBQUcsQ0FBQztJQUNaRCxRQUFRQyxHQUFHLENBQUMsVUFBVUo7SUFDdEJHLFFBQVFDLEdBQUcsQ0FBQyxhQUFhSDtJQUN6QkUsUUFBUUMsR0FBRyxDQUFDLFVBQVVGO0lBRXRCLDZCQUE2QjtJQUM3QixNQUFNLEVBQUVHLE1BQU1DLE1BQU0sRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTWIsU0FDbkNjLElBQUksQ0FBQyxvQkFDTEMsTUFBTSxDQUFDLEtBQ1BDLEVBQUUsQ0FBQyxzQkFBc0I7SUFFNUIsSUFBSUgsT0FBTztRQUNUSixRQUFRSSxLQUFLLENBQUMsMkJBQTJCQTtRQUN6QyxPQUFPO0lBQ1Q7SUFFQSxJQUFJLENBQUNELFVBQVVBLE9BQU9LLE1BQU0sS0FBSyxHQUFHO1FBQ2xDUixRQUFRQyxHQUFHLENBQUM7UUFDWixPQUFPO0lBQ1Q7SUFFQSx5QkFBeUI7SUFDekIsTUFBTVEsUUFBUVYsYUFBYVcsV0FBVztJQUN0QyxNQUFNQyxnQkFBZ0JiLGdCQUFnQmMsR0FBRyxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFSCxXQUFXO0lBRTVELElBQUlJLFlBQVk7SUFDaEIsSUFBSUMsWUFBWTtJQUVoQixLQUFLLE1BQU1DLFNBQVNiLE9BQVE7UUFDMUIsTUFBTWMsV0FBV0QsTUFBTUUsY0FBYztRQUNyQyxNQUFNQyxPQUFPSCxNQUFNSSxVQUFVLENBQUNWLFdBQVc7UUFDekMsSUFBSVcsUUFBUTtRQUVaLHVDQUF1QztRQUN2QyxJQUFJLENBQUNWLGNBQWNXLFFBQVEs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RUEsb0RBQW9EO0lBQ3BELElBQUlILFlBQVksWUFBWSxPQUFPO0lBRW5DLDBDQUEwQztJQUMxQyxJQUFJQSxZQUFZLFVBQVVGLGVBQWVRLEtBQUssSUFBSSxJQUFJLE9BQU87SUFFN0QsaURBQWlEO0lBQ2pELElBQUlOLFlBQVksVUFBVSxPQUFPO0lBRWpDLE9BQU87QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL3RoYW5kaS1yYWctc3lzdGVtLy4vbGliL2N1cnJpY3VsdW0vcXVlcnktZ2F0ZXMtc2ltcGxlLmpzPzUyZmYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU2ltcGxpZmllZCBnYXRlIHF1ZXJ5IC0ga2V5d29yZCBtYXRjaGluZyBmb3IgTVZQXHJcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XHJcblxyXG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcclxuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwsXHJcbiAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWVxyXG4pO1xyXG5cclxuLyoqXHJcbiAqIEdldCByZWxldmFudCBjdXJyaWN1bHVtIGdhdGUgdXNpbmcga2V5d29yZCBtYXRjaGluZ1xyXG4gKiBUaGlzIGlzIHRoZSBNVlAgYXBwcm9hY2ggLSB3b3JrcyB3aXRob3V0IHZlY3RvciBzZWFyY2ggZnVuY3Rpb25cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRSZWxldmFudEdhdGUoc3R1ZGVudEdyYWRlLCBzdHVkZW50U3ViamVjdHMsIHN0dWRlbnRRdWVyeSkge1xyXG4gIGNvbnNvbGUubG9nKCfwn5SNIFF1ZXJ5aW5nIGN1cnJpY3VsdW0gZ2F0ZXMuLi4nKTtcclxuICBjb25zb2xlLmxvZygnR3JhZGU6Jywgc3R1ZGVudEdyYWRlKTtcclxuICBjb25zb2xlLmxvZygnU3ViamVjdHM6Jywgc3R1ZGVudFN1YmplY3RzKTtcclxuICBjb25zb2xlLmxvZygnUXVlcnk6Jywgc3R1ZGVudFF1ZXJ5KTtcclxuXHJcbiAgLy8gRmV0Y2ggYWxsIGN1cnJpY3VsdW0gZ2F0ZXNcclxuICBjb25zdCB7IGRhdGE6IGNodW5rcywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbSgna25vd2xlZGdlX2NodW5rcycpXHJcbiAgICAuc2VsZWN0KCcqJylcclxuICAgIC5lcSgnc291cmNlX2VudGl0eV90eXBlJywgJ2N1cnJpY3VsdW1fZ2F0ZScpO1xyXG5cclxuICBpZiAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBxdWVyeWluZyBnYXRlczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIGlmICghY2h1bmtzIHx8IGNodW5rcy5sZW5ndGggPT09IDApIHtcclxuICAgIGNvbnNvbGUubG9nKCfimqDvuI8gTm8gZ2F0ZXMgZm91bmQgaW4gZGF0YWJhc2UnKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLy8gS2V5d29yZCBtYXRjaGluZyBsb2dpY1xyXG4gIGNvbnN0IHF1ZXJ5ID0gc3R1ZGVudFF1ZXJ5LnRvTG93ZXJDYXNlKCk7XHJcbiAgY29uc3Qgc3ViamVjdHNMb3dlciA9IHN0dWRlbnRTdWJqZWN0cy5tYXAocyA9PiBzLnRvTG93ZXJDYXNlKCkpO1xyXG5cclxuICBsZXQgYmVzdE1hdGNoID0gbnVsbDtcclxuICBsZXQgYmVzdFNjb3JlID0gMDtcclxuXHJcbiAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3MpIHtcclxuICAgIGNvbnN0IG1ldGFkYXRhID0gY2h1bmsuY2h1bmtfbWV0YWRhdGE7XHJcbiAgICBjb25zdCB0ZXh0ID0gY2h1bmsuY2h1bmtfdGV4dC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgbGV0IHNjb3JlID0gMDtcclxuXHJcbiAgICAvLyBSdWxlIDE6IE1hdGggTGl0ICsgRW5naW5lZXJpbmcgcXVlcnlcclxuICAgIGlmICgoc3ViamVjdHNMb3dlci5pbmNsdWRlcygnbWF0aGVtYXRpY2FsIGxpdGVyYWN5JykgfHwgc3ViamVjdHNMb3dlci5pbmNsdWRlcygnbWF0aCBsaXQnKSkgJiZcclxuICAgICAgICAocXVlcnkuaW5jbHVkZXMoJ2VuZ2luZWVyJykgfHwgcXVlcnkuaW5jbHVkZXMoJ3N0ZW0nKSkpIHtcclxuICAgICAgaWYgKG1ldGFkYXRhLmdhdGVfdHlwZSA9PT0gJ2lycmV2ZXJzaWJsZScpIHtcclxuICAgICAgICBzY29yZSA9IDEwMDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFJ1bGUgMjogQVBTICsgTWVkaWNpbmUvaGlnaCByZXF1aXJlbWVudCBxdWVyeVxyXG4gICAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCdhcHMnKSAmJiAocXVlcnkuaW5jbHVkZXMoJ21lZGljaW5lJykgfHwgcXVlcnkuaW5jbHVkZXMoJ2VuZ2luZWVyaW5nJykpKSB7XHJcbiAgICAgIGlmIChtZXRhZGF0YS5nYXRlX3R5cGUgPT09ICdhcHNfc2hvcnRmYWxsJykge1xyXG4gICAgICAgIHNjb3JlID0gMTAwO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUnVsZSAzOiBJRUIgcXVlcnlcclxuICAgIGlmIChxdWVyeS5pbmNsdWRlcygnaWViJykgfHwgcXVlcnkuaW5jbHVkZXMoJ2luZGVwZW5kZW50JykpIHtcclxuICAgICAgaWYgKG1ldGFkYXRhLmdhdGVfdHlwZSA9PT0gJ2N1cnJpY3VsdW1fdHlwZScpIHtcclxuICAgICAgICBzY29yZSA9IDEwMDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFJ1bGUgNDogR3JhZGUgMTEvMTIgKyBjaGFuZ2UvZHJvcCBzdWJqZWN0c1xyXG4gICAgaWYgKChzdHVkZW50R3JhZGUgPT09IDExIHx8IHN0dWRlbnRHcmFkZSA9PT0gMTIpICYmIFxyXG4gICAgICAgIChxdWVyeS5pbmNsdWRlcygnY2hhbmdlJykgfHwgcXVlcnkuaW5jbHVkZXMoJ2Ryb3AnKSB8fCBxdWVyeS5pbmNsdWRlcygnc3dpdGNoJykpKSB7XHJcbiAgICAgIGlmIChtZXRhZGF0YS5nYXRlX3R5cGUgPT09ICdkZWFkbGluZScpIHtcclxuICAgICAgICBzY29yZSA9IDEwMDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFJ1bGUgNTogTWVkaWNpbmUgKyBtaXNzaW5nIFBoeXNpY2FsIFNjaWVuY2VzXHJcbiAgICBpZiAocXVlcnkuaW5jbHVkZXMoJ21lZGljaW5lJykgJiYgIXN1YmplY3RzTG93ZXIuaW5jbHVkZXMoJ3BoeXNpY2FsIHNjaWVuY2VzJykpIHtcclxuICAgICAgaWYgKG1ldGFkYXRhLmdhdGVfdHlwZSA9PT0gJ3N1YmplY3RfY2hhaW4nKSB7XHJcbiAgICAgICAgc2NvcmUgPSAxMDA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBHcmFkZSBsZXZlbCBtYXRjaCBib251c1xyXG4gICAgaWYgKG1ldGFkYXRhLmdyYWRlX2xldmVsICYmIG1ldGFkYXRhLmdyYWRlX2xldmVsLmluY2x1ZGVzKHN0dWRlbnRHcmFkZS50b1N0cmluZygpKSkge1xyXG4gICAgICBzY29yZSArPSAxMDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgYmVzdCBtYXRjaFxyXG4gICAgaWYgKHNjb3JlID4gYmVzdFNjb3JlKSB7XHJcbiAgICAgIGJlc3RTY29yZSA9IHNjb3JlO1xyXG4gICAgICBiZXN0TWF0Y2ggPSBjaHVuaztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmICghYmVzdE1hdGNoKSB7XHJcbiAgICBjb25zb2xlLmxvZygn4pqg77iPIE5vIG1hdGNoaW5nIGdhdGUgZm91bmQnKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgY29uc29sZS5sb2coJ+KchSBSZXRyaWV2ZWQgZ2F0ZTonLCBiZXN0TWF0Y2guY2h1bmtfbWV0YWRhdGEuZ2F0ZV90eXBlKTtcclxuICBjb25zb2xlLmxvZygnUkFHIHJldHJpZXZlZDonLCBiZXN0TWF0Y2guY2h1bmtfbWV0YWRhdGEuZ2F0ZV90eXBlKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHRleHQ6IGJlc3RNYXRjaC5jaHVua190ZXh0LFxyXG4gICAgbWV0YWRhdGE6IGJlc3RNYXRjaC5jaHVua19tZXRhZGF0YSxcclxuICAgIHNpbWlsYXJpdHk6IGJlc3RTY29yZSAvIDEwMFxyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDaGVjayBpZiBnYXRlIHNob3VsZCBiZSBzaG93biBpbiByZXBvcnRcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzaG91bGRTaG93R2F0ZShnYXRlLCBzdHVkZW50UHJvZmlsZSkge1xyXG4gIGlmICghZ2F0ZSB8fCAhZ2F0ZS5tZXRhZGF0YSkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICBjb25zdCB7IGdhdGVfdHlwZSwgc3ViamVjdHMsIHVyZ2VuY3kgfSA9IGdhdGUubWV0YWRhdGE7XHJcbiAgY29uc3Qgc3R1ZGVudFN1YmplY3RzID0gc3R1ZGVudFByb2ZpbGUuY3VycmVudFN1YmplY3RzIHx8IFtdO1xyXG4gIGNvbnN0IHN0dWRlbnRTdWJqZWN0c0xvd2VyID0gc3R1ZGVudFN1YmplY3RzLm1hcChzID0+IHMudG9Mb3dlckNhc2UoKSk7XHJcblxyXG4gIC8vIENSSVRJQ0FMIEZJWDogTWF0aCBMaXQgZ2F0ZSBzaG91bGQgT05MWSBzaG93IGlmIHN0dWRlbnQgYWN0dWFsbHkgaGFzIE1hdGggTGl0XHJcbiAgaWYgKGdhdGVfdHlwZSA9PT0gJ2lycmV2ZXJzaWJsZScgJiYgc3ViamVjdHMgJiYgc3ViamVjdHMuaW5jbHVkZXMoJ01hdGhlbWF0aWNhbCBMaXRlcmFjeScpKSB7XHJcbiAgICBjb25zdCBoYXNNYXRoTGl0ID0gc3R1ZGVudFN1YmplY3RzTG93ZXIuc29tZShzID0+IFxyXG4gICAgICBzLmluY2x1ZGVzKCdtYXRoZW1hdGljYWwgbGl0ZXJhY3knKSB8fCBzID09PSAnbWF0aCBsaXQnXHJcbiAgICApO1xyXG4gICAgY29uc3QgaGFzUHVyZU1hdGggPSBzdHVkZW50U3ViamVjdHNMb3dlci5zb21lKHMgPT4gXHJcbiAgICAgIHMgPT09ICdtYXRoZW1hdGljcycgJiYgIXMuaW5jbHVkZXMoJ2xpdGVyYWN5JylcclxuICAgICk7XHJcbiAgICBcclxuICAgIC8vIElmIHN0dWRlbnQgaGFzIFB1cmUgTWF0aCwgZG9uJ3Qgc2hvdyBNYXRoIExpdCBnYXRlXHJcbiAgICBpZiAoaGFzUHVyZU1hdGggJiYgIWhhc01hdGhMaXQpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBJZiBzdHVkZW50IGRvZXNuJ3QgaGF2ZSBNYXRoIExpdCwgZG9uJ3Qgc2hvdyBnYXRlXHJcbiAgICBpZiAoIWhhc01hdGhMaXQpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQWx3YXlzIHNob3cgY3JpdGljYWwgZ2F0ZXMgKGFmdGVyIE1hdGggTGl0IGNoZWNrKVxyXG4gIGlmICh1cmdlbmN5ID09PSAnY3JpdGljYWwnKSByZXR1cm4gdHJ1ZTtcclxuXHJcbiAgLy8gU2hvdyBoaWdoIHVyZ2VuY3kgZ2F0ZXMgZm9yIEdyYWRlIDEwLTExXHJcbiAgaWYgKHVyZ2VuY3kgPT09ICdoaWdoJyAmJiBzdHVkZW50UHJvZmlsZS5ncmFkZSA8PSAxMSkgcmV0dXJuIHRydWU7XHJcblxyXG4gIC8vIFNob3cgbWVkaXVtIHVyZ2VuY3kgZ2F0ZXMgaWYgcmVsZXZhbnQgdG8gcXVlcnlcclxuICBpZiAodXJnZW5jeSA9PT0gJ21lZGl1bScpIHJldHVybiB0cnVlO1xyXG5cclxuICByZXR1cm4gZmFsc2U7XHJcbn1cclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJnZXRSZWxldmFudEdhdGUiLCJzdHVkZW50R3JhZGUiLCJzdHVkZW50U3ViamVjdHMiLCJzdHVkZW50UXVlcnkiLCJjb25zb2xlIiwibG9nIiwiZGF0YSIsImNodW5rcyIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwibGVuZ3RoIiwicXVlcnkiLCJ0b0xvd2VyQ2FzZSIsInN1YmplY3RzTG93ZXIiLCJtYXAiLCJzIiwiYmVzdE1hdGNoIiwiYmVzdFNjb3JlIiwiY2h1bmsiLCJtZXRhZGF0YSIsImNodW5rX21ldGFkYXRhIiwidGV4dCIsImNodW5rX3RleHQiLCJzY29yZSIsImluY2x1ZGVzIiwiZ2F0ZV90eXBlIiwiZ3JhZGVfbGV2ZWwiLCJ0b1N0cmluZyIsInNpbWlsYXJpdHkiLCJzaG91bGRTaG93R2F0ZSIsImdhdGUiLCJzdHVkZW50UHJvZmlsZSIsInN1YmplY3RzIiwidXJnZW5jeSIsImN1cnJlbnRTdWJqZWN0cyIsInN0dWRlbnRTdWJqZWN0c0xvd2VyIiwiaGFzTWF0aExpdCIsInNvbWUiLCJoYXNQdXJlTWF0aCIsImdyYWRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/curriculum/query-gates-simple.js\n");

/***/ }),

/***/ "(rsc)/./lib/llm/guarded-client.js":
/*!***********************************!*\
  !*** ./lib/llm/guarded-client.js ***!
  \***********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GuardedClient: () => (/* binding */ GuardedClient),\n/* harmony export */   guardedClient: () => (/* binding */ guardedClient)\n/* harmony export */ });\n// Guarded LLM Client - Timeout + Token Cap protection\n// Required for demo reliability and cost control\nclass GuardedClient {\n    constructor(config = {}){\n        this.timeout = config.timeout || 5000; // 5 seconds default\n        this.maxTokens = config.maxTokens || 3000; // Token cap per request\n        this.maxRetries = config.maxRetries || 1; // Single retry on timeout\n        this.costPerToken = config.costPerToken || 0.000015; // Claude Sonnet pricing\n    }\n    /**\r\n   * Execute LLM call with timeout and token protection\r\n   * @param {Function} apiCall - The actual API call function\r\n   * @param {Object} options - Call options\r\n   * @returns {Promise} - API response or timeout error\r\n   */ async execute(apiCall, options = {}) {\n        const startTime = Date.now();\n        const requestId = this._generateRequestId();\n        // Enforce token cap\n        const cappedTokens = Math.min(options.maxTokens || this.maxTokens, this.maxTokens);\n        console.log(`[GUARDED] Request ${requestId}: max_tokens=${cappedTokens}, timeout=${this.timeout}ms`);\n        try {\n            // Wrap API call with timeout\n            const result = await this._withTimeout(apiCall({\n                ...options,\n                maxTokens: cappedTokens\n            }), this.timeout, requestId);\n            const duration = Date.now() - startTime;\n            const tokensUsed = this._estimateTokens(result);\n            const cost = tokensUsed * this.costPerToken;\n            console.log(`[GUARDED] Request ${requestId}: success in ${duration}ms, ~${tokensUsed} tokens, ~R${cost.toFixed(2)}`);\n            return {\n                success: true,\n                data: result,\n                metadata: {\n                    requestId,\n                    duration,\n                    tokensUsed,\n                    cost,\n                    timedOut: false\n                }\n            };\n        } catch (error) {\n            const duration = Date.now() - startTime;\n            if (error.name === \"TimeoutError\") {\n                console.error(`[GUARDED] Request ${requestId}: TIMEOUT after ${duration}ms`);\n                // Retry once on timeout\n                if (this.maxRetries > 0 && !options._isRetry) {\n                    console.log(`[GUARDED] Request ${requestId}: Retrying...`);\n                    return this.execute(apiCall, {\n                        ...options,\n                        _isRetry: true\n                    });\n                }\n                return {\n                    success: false,\n                    error: \"Request timed out\",\n                    fallback: this._getFallbackResponse(options),\n                    metadata: {\n                        requestId,\n                        duration,\n                        timedOut: true\n                    }\n                };\n            }\n            // Other errors\n            console.error(`[GUARDED] Request ${requestId}: ERROR`, error.message);\n            return {\n                success: false,\n                error: error.message,\n                fallback: this._getFallbackResponse(options),\n                metadata: {\n                    requestId,\n                    duration,\n                    timedOut: false\n                }\n            };\n        }\n    }\n    /**\r\n   * Wrap promise with timeout\r\n   */ async _withTimeout(promise, timeoutMs, requestId) {\n        let timeoutHandle;\n        const timeoutPromise = new Promise((_, reject)=>{\n            timeoutHandle = setTimeout(()=>{\n                const error = new Error(`Request ${requestId} timed out after ${timeoutMs}ms`);\n                error.name = \"TimeoutError\";\n                reject(error);\n            }, timeoutMs);\n        });\n        try {\n            const result = await Promise.race([\n                promise,\n                timeoutPromise\n            ]);\n            clearTimeout(timeoutHandle);\n            return result;\n        } catch (error) {\n            clearTimeout(timeoutHandle);\n            throw error;\n        }\n    }\n    /**\r\n   * Estimate tokens used (rough approximation)\r\n   */ _estimateTokens(result) {\n        if (!result) return 0;\n        // Rough estimate: 1 token ≈ 4 characters\n        const text = typeof result === \"string\" ? result : JSON.stringify(result);\n        return Math.ceil(text.length / 4);\n    }\n    /**\r\n   * Generate unique request ID\r\n   */ _generateRequestId() {\n        return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    }\n    /**\r\n   * Get fallback response when API fails\r\n   */ _getFallbackResponse(options) {\n        if (options.fallback) {\n            return options.fallback;\n        }\n        // Default fallback\n        return {\n            message: \"We are experiencing high demand. Your report has been generated using our standard recommendations. For a personalized report, please try again in a few minutes.\",\n            useStandardReport: true\n        };\n    }\n    /**\r\n   * Batch multiple requests with rate limiting\r\n   */ async executeBatch(apiCalls, options = {}) {\n        const batchSize = options.batchSize || 3;\n        const delayBetweenBatches = options.delay || 1000;\n        const results = [];\n        for(let i = 0; i < apiCalls.length; i += batchSize){\n            const batch = apiCalls.slice(i, i + batchSize);\n            const batchResults = await Promise.all(batch.map((call)=>this.execute(call, options)));\n            results.push(...batchResults);\n            // Delay between batches\n            if (i + batchSize < apiCalls.length) {\n                await new Promise((resolve)=>setTimeout(resolve, delayBetweenBatches));\n            }\n        }\n        return results;\n    }\n    /**\r\n   * Get cost estimate before making call\r\n   */ estimateCost(inputTokens, outputTokens) {\n        const totalTokens = inputTokens + outputTokens;\n        return {\n            tokens: totalTokens,\n            cost: totalTokens * this.costPerToken,\n            currency: \"ZAR\"\n        };\n    }\n}\n// Export singleton with production settings\nconst guardedClient = new GuardedClient({\n    timeout: 5000,\n    maxTokens: 3000,\n    maxRetries: 1,\n    costPerToken: 0.000015 // Claude Sonnet 4 pricing\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q25ELEdBQUciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90aGFuZGktcmFnLXN5c3RlbS8uL2xpYi9sbG0vZ3VhcmRlZC1jbGllbnQuanM/M2JhOCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBHdWFyZGVkIExMTSBDbGllbnQgLSBUaW1lb3V0ICsgVG9rZW4gQ2FwIHByb3RlY3Rpb25cclxuLy8gUmVxdWlyZWQgZm9yIGRlbW8gcmVsaWFiaWxpdHkgYW5kIGNvc3QgY29udHJvbFxyXG5cclxuZXhwb3J0IGNsYXNzIEd1YXJkZWRDbGllbnQge1xyXG4gIGNvbnN0cnVjdG9yKGNvbmZpZyA9IHt9KSB7XHJcbiAgICB0aGlzLnRpbWVvdXQgPSBjb25maWcudGltZW91dCB8fCA1MDAwOyAvLyA1IHNlY29uZHMgZGVmYXVsdFxyXG4gICAgdGhpcy5tYXhUb2tlbnMgPSBjb25maWcubWF4VG9rZW5zIHx8IDMwMDA7IC8vIFRva2VuIGNhcCBwZXIgcmVxdWVzdFxyXG4gICAgdGhpcy5tYXhSZXRyaWVzID0gY29uZmlnLm1heFJldHJpZXMgfHwgMTsgLy8gU2luZ2xlIHJldHJ5IG9uIHRpbWVvdXRcclxuICAgIHRoaXMuY29zdFBlclRva2VuID0gY29uZmlnLmNvc3RQZXJUb2tlbiB8fCAwLjAwMDAxNTsgLy8gQ2xhdWRlIFNvbm5ldCBwcmljaW5nXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFeGVjdXRlIExMTSBjYWxsIHdpdGggdGltZW91dCBhbmQgdG9rZW4gcHJvdGVjdGlvblxyXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGFwaUNhbGwgLSBUaGUgYWN0dWFsIEFQSSBjYWxsIGZ1bmN0aW9uXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBDYWxsIG9wdGlvbnNcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gLSBBUEkgcmVzcG9uc2Ugb3IgdGltZW91dCBlcnJvclxyXG4gICAqL1xyXG4gIGFzeW5jIGV4ZWN1dGUoYXBpQ2FsbCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgY29uc3QgcmVxdWVzdElkID0gdGhpcy5fZ2VuZXJhdGVSZXF1ZXN0SWQoKTtcclxuXHJcbiAgICAvLyBFbmZvcmNlIHRva2VuIGNhcFxyXG4gICAgY29uc3QgY2FwcGVkVG9rZW5zID0gTWF0aC5taW4oXHJcbiAgICAgIG9wdGlvbnMubWF4VG9rZW5zIHx8IHRoaXMubWF4VG9rZW5zLFxyXG4gICAgICB0aGlzLm1heFRva2Vuc1xyXG4gICAgKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhgW0dVQVJERURdIFJlcXVlc3QgJHtyZXF1ZXN0SWR9OiBtYXhfdG9rZW5zPSR7Y2FwcGVkVG9rZW5zfSwgdGltZW91dD0ke3RoaXMudGltZW91dH1tc2ApO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFdyYXAgQVBJIGNhbGwgd2l0aCB0aW1lb3V0XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuX3dpdGhUaW1lb3V0KFxyXG4gICAgICAgIGFwaUNhbGwoeyAuLi5vcHRpb25zLCBtYXhUb2tlbnM6IGNhcHBlZFRva2VucyB9KSxcclxuICAgICAgICB0aGlzLnRpbWVvdXQsXHJcbiAgICAgICAgcmVxdWVzdElkXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcbiAgICAgIGNvbnN0IHRva2Vuc1VzZWQgPSB0aGlzLl9lc3RpbWF0ZVRva2VucyhyZXN1bHQpO1xyXG4gICAgICBjb25zdCBjb3N0ID0gdG9rZW5zVXNlZCAqIHRoaXMuY29zdFBlclRva2VuO1xyXG5cclxuICAgICAgY29uc29sZS5sb2coYFtHVUFSREVEXSBSZXF1ZXN0ICR7cmVxdWVzdElkfTogc3VjY2VzcyBpbiAke2R1cmF0aW9ufW1zLCB+JHt0b2tlbnNVc2VkfSB0b2tlbnMsIH5SJHtjb3N0LnRvRml4ZWQoMil9YCk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgZGF0YTogcmVzdWx0LFxyXG4gICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICByZXF1ZXN0SWQsXHJcbiAgICAgICAgICBkdXJhdGlvbixcclxuICAgICAgICAgIHRva2Vuc1VzZWQsXHJcbiAgICAgICAgICBjb3N0LFxyXG4gICAgICAgICAgdGltZWRPdXQ6IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcclxuXHJcbiAgICAgIGlmIChlcnJvci5uYW1lID09PSAnVGltZW91dEVycm9yJykge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFtHVUFSREVEXSBSZXF1ZXN0ICR7cmVxdWVzdElkfTogVElNRU9VVCBhZnRlciAke2R1cmF0aW9ufW1zYCk7XHJcblxyXG4gICAgICAgIC8vIFJldHJ5IG9uY2Ugb24gdGltZW91dFxyXG4gICAgICAgIGlmICh0aGlzLm1heFJldHJpZXMgPiAwICYmICFvcHRpb25zLl9pc1JldHJ5KSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgW0dVQVJERURdIFJlcXVlc3QgJHtyZXF1ZXN0SWR9OiBSZXRyeWluZy4uLmApO1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZXhlY3V0ZShhcGlDYWxsLCB7IC4uLm9wdGlvbnMsIF9pc1JldHJ5OiB0cnVlIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdSZXF1ZXN0IHRpbWVkIG91dCcsXHJcbiAgICAgICAgICBmYWxsYmFjazogdGhpcy5fZ2V0RmFsbGJhY2tSZXNwb25zZShvcHRpb25zKSxcclxuICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3RJZCxcclxuICAgICAgICAgICAgZHVyYXRpb24sXHJcbiAgICAgICAgICAgIHRpbWVkT3V0OiB0cnVlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gT3RoZXIgZXJyb3JzXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtHVUFSREVEXSBSZXF1ZXN0ICR7cmVxdWVzdElkfTogRVJST1JgLCBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgICBmYWxsYmFjazogdGhpcy5fZ2V0RmFsbGJhY2tSZXNwb25zZShvcHRpb25zKSxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgcmVxdWVzdElkLFxyXG4gICAgICAgICAgZHVyYXRpb24sXHJcbiAgICAgICAgICB0aW1lZE91dDogZmFsc2VcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXcmFwIHByb21pc2Ugd2l0aCB0aW1lb3V0XHJcbiAgICovXHJcbiAgYXN5bmMgX3dpdGhUaW1lb3V0KHByb21pc2UsIHRpbWVvdXRNcywgcmVxdWVzdElkKSB7XHJcbiAgICBsZXQgdGltZW91dEhhbmRsZTtcclxuXHJcbiAgICBjb25zdCB0aW1lb3V0UHJvbWlzZSA9IG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHtcclxuICAgICAgdGltZW91dEhhbmRsZSA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKGBSZXF1ZXN0ICR7cmVxdWVzdElkfSB0aW1lZCBvdXQgYWZ0ZXIgJHt0aW1lb3V0TXN9bXNgKTtcclxuICAgICAgICBlcnJvci5uYW1lID0gJ1RpbWVvdXRFcnJvcic7XHJcbiAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgfSwgdGltZW91dE1zKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb21pc2UucmFjZShbcHJvbWlzZSwgdGltZW91dFByb21pc2VdKTtcclxuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRIYW5kbGUpO1xyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRIYW5kbGUpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEVzdGltYXRlIHRva2VucyB1c2VkIChyb3VnaCBhcHByb3hpbWF0aW9uKVxyXG4gICAqL1xyXG4gIF9lc3RpbWF0ZVRva2VucyhyZXN1bHQpIHtcclxuICAgIGlmICghcmVzdWx0KSByZXR1cm4gMDtcclxuXHJcbiAgICAvLyBSb3VnaCBlc3RpbWF0ZTogMSB0b2tlbiDiiYggNCBjaGFyYWN0ZXJzXHJcbiAgICBjb25zdCB0ZXh0ID0gdHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycgXHJcbiAgICAgID8gcmVzdWx0IFxyXG4gICAgICA6IEpTT04uc3RyaW5naWZ5KHJlc3VsdCk7XHJcbiAgICBcclxuICAgIHJldHVybiBNYXRoLmNlaWwodGV4dC5sZW5ndGggLyA0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIHVuaXF1ZSByZXF1ZXN0IElEXHJcbiAgICovXHJcbiAgX2dlbmVyYXRlUmVxdWVzdElkKCkge1xyXG4gICAgcmV0dXJuIGByZXFfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGZhbGxiYWNrIHJlc3BvbnNlIHdoZW4gQVBJIGZhaWxzXHJcbiAgICovXHJcbiAgX2dldEZhbGxiYWNrUmVzcG9uc2Uob3B0aW9ucykge1xyXG4gICAgaWYgKG9wdGlvbnMuZmFsbGJhY2spIHtcclxuICAgICAgcmV0dXJuIG9wdGlvbnMuZmFsbGJhY2s7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRGVmYXVsdCBmYWxsYmFja1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbWVzc2FnZTogJ1dlIGFyZSBleHBlcmllbmNpbmcgaGlnaCBkZW1hbmQuIFlvdXIgcmVwb3J0IGhhcyBiZWVuIGdlbmVyYXRlZCB1c2luZyBvdXIgc3RhbmRhcmQgcmVjb21tZW5kYXRpb25zLiBGb3IgYSBwZXJzb25hbGl6ZWQgcmVwb3J0LCBwbGVhc2UgdHJ5IGFnYWluIGluIGEgZmV3IG1pbnV0ZXMuJyxcclxuICAgICAgdXNlU3RhbmRhcmRSZXBvcnQ6IHRydWVcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBCYXRjaCBtdWx0aXBsZSByZXF1ZXN0cyB3aXRoIHJhdGUgbGltaXRpbmdcclxuICAgKi9cclxuICBhc3luYyBleGVjdXRlQmF0Y2goYXBpQ2FsbHMsIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgY29uc3QgYmF0Y2hTaXplID0gb3B0aW9ucy5iYXRjaFNpemUgfHwgMztcclxuICAgIGNvbnN0IGRlbGF5QmV0d2VlbkJhdGNoZXMgPSBvcHRpb25zLmRlbGF5IHx8IDEwMDA7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0cyA9IFtdO1xyXG4gICAgXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFwaUNhbGxzLmxlbmd0aDsgaSArPSBiYXRjaFNpemUpIHtcclxuICAgICAgY29uc3QgYmF0Y2ggPSBhcGlDYWxscy5zbGljZShpLCBpICsgYmF0Y2hTaXplKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGJhdGNoUmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKFxyXG4gICAgICAgIGJhdGNoLm1hcChjYWxsID0+IHRoaXMuZXhlY3V0ZShjYWxsLCBvcHRpb25zKSlcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJlc3VsdHMucHVzaCguLi5iYXRjaFJlc3VsdHMpO1xyXG5cclxuICAgICAgLy8gRGVsYXkgYmV0d2VlbiBiYXRjaGVzXHJcbiAgICAgIGlmIChpICsgYmF0Y2hTaXplIDwgYXBpQ2FsbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5QmV0d2VlbkJhdGNoZXMpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXN1bHRzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGNvc3QgZXN0aW1hdGUgYmVmb3JlIG1ha2luZyBjYWxsXHJcbiAgICovXHJcbiAgZXN0aW1hdGVDb3N0KGlucHV0VG9rZW5zLCBvdXRwdXRUb2tlbnMpIHtcclxuICAgIGNvbnN0IHRvdGFsVG9rZW5zID0gaW5wdXRUb2tlbnMgKyBvdXRwdXRUb2tlbnM7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b2tlbnM6IHRvdGFsVG9rZW5zLFxyXG4gICAgICBjb3N0OiB0b3RhbFRva2VucyAqIHRoaXMuY29zdFBlclRva2VuLFxyXG4gICAgICBjdXJyZW5jeTogJ1pBUidcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vLyBFeHBvcnQgc2luZ2xldG9uIHdpdGggcHJvZHVjdGlvbiBzZXR0aW5nc1xyXG5leHBvcnQgY29uc3QgZ3VhcmRlZENsaWVudCA9IG5ldyBHdWFyZGVkQ2xpZW50KHtcclxuICB0aW1lb3V0OiA1MDAwLCAvLyA1IHNlY29uZHMgZm9yIGRlbW8gcmVsaWFiaWxpdHlcclxuICBtYXhUb2tlbnM6IDMwMDAsIC8vIENhcCBhdCAzSyB0b2tlbnNcclxuICBtYXhSZXRyaWVzOiAxLFxyXG4gIGNvc3RQZXJUb2tlbjogMC4wMDAwMTUgLy8gQ2xhdWRlIFNvbm5ldCA0IHByaWNpbmdcclxufSk7XHJcbiJdLCJuYW1lcyI6WyJHdWFyZGVkQ2xpZW50IiwiY29uc3RydWN0b3IiLCJjb25maWciLCJ0aW1lb3V0IiwibWF4VG9rZW5zIiwibWF4UmV0cmllcyIsImNvc3RQZXJUb2tlbiIsImV4ZWN1dGUiLCJhcGlDYWxsIiwib3B0aW9ucyIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJyZXF1ZXN0SWQiLCJfZ2VuZXJhdGVSZXF1ZXN0SWQiLCJjYXBwZWRUb2tlbnMiLCJNYXRoIiwibWluIiwiY29uc29sZSIsImxvZyIsInJlc3VsdCIsIl93aXRoVGltZW91dCIsImR1cmF0aW9uIiwidG9rZW5zVXNlZCIsIl9lc3RpbWF0ZVRva2VucyIsImNvc3QiLCJ0b0ZpeGVkIiwic3VjY2VzcyIsImRhdGEiLCJtZXRhZGF0YSIsInRpbWVkT3V0IiwiZXJyb3IiLCJuYW1lIiwiX2lzUmV0cnkiLCJmYWxsYmFjayIsIl9nZXRGYWxsYmFja1Jlc3BvbnNlIiwibWVzc2FnZSIsInByb21pc2UiLCJ0aW1lb3V0TXMiLCJ0aW1lb3V0SGFuZGxlIiwidGltZW91dFByb21pc2UiLCJQcm9taXNlIiwiXyIsInJlamVjdCIsInNldFRpbWVvdXQiLCJFcnJvciIsInJhY2UiLCJjbGVhclRpbWVvdXQiLCJ0ZXh0IiwiSlNPTiIsInN0cmluZ2lmeSIsImNlaWwiLCJsZW5ndGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsInVzZVN0YW5kYXJkUmVwb3J0IiwiZXhlY3V0ZUJhdGNoIiwiYXBpQ2FsbHMiLCJiYXRjaFNpemUiLCJkZWxheUJldHdlZW5CYXRjaGVzIiwiZGVsYXkiLCJyZXN1bHRzIiwiaSIsImJhdGNoIiwic2xpY2UiLCJiYXRjaFJlc3VsdHMiLCJhbGwiLCJtYXAiLCJjYWxsIiwicHVzaCIsInJlc29sdmUiLCJlc3RpbWF0ZUNvc3QiLCJpbnB1dFRva2VucyIsIm91dHB1dFRva2VucyIsInRvdGFsVG9rZW5zIiwidG9rZW5zIiwiY3VycmVuY3kiLCJndWFyZGVkQ2xpZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/llm/guarded-client.js\n");

/***/ }),

/***/ "(rsc)/./lib/llm/llm-adapter.js":
/*!********************************!*\
  !*** ./lib/llm/llm-adapter.js ***!
  \********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ClaudeProvider: () => (/* binding */ ClaudeProvider),\n/* harmony export */   LLMAdapter: () => (/* binding */ LLMAdapter),\n/* harmony export */   LLMProvider: () => (/* binding */ LLMProvider),\n/* harmony export */   MockProvider: () => (/* binding */ MockProvider),\n/* harmony export */   OpenAIProvider: () => (/* binding */ OpenAIProvider),\n/* harmony export */   getDefaultLLMProvider: () => (/* binding */ getDefaultLLMProvider),\n/* harmony export */   llmProvider: () => (/* binding */ llmProvider)\n/* harmony export */ });\n/* harmony import */ var _guarded_client_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./guarded-client.js */ \"(rsc)/./lib/llm/guarded-client.js\");\n// LLM Adapter Pattern - Vendor-agnostic interface\n// Prevents vendor lock-in, allows switching between Claude/GPT/Local models\n\n/**\r\n * Abstract LLM Provider interface\r\n */ class LLMProvider {\n    constructor(config){\n        this.config = config;\n        this.name = \"base\";\n    }\n    async generateText(prompt, options = {}) {\n        throw new Error(\"generateText must be implemented by provider\");\n    }\n    async generateJSON(prompt, options = {}) {\n        throw new Error(\"generateJSON must be implemented by provider\");\n    }\n    estimateCost(inputTokens, outputTokens) {\n        throw new Error(\"estimateCost must be implemented by provider\");\n    }\n}\n/**\r\n * Claude (Anthropic) Provider\r\n */ class ClaudeProvider extends LLMProvider {\n    constructor(config = {}){\n        super(config);\n        this.name = \"claude\";\n        this.apiKey = config.apiKey || process.env.ANTHROPIC_API_KEY;\n        this.model = config.model || \"claude-sonnet-4-20250514\";\n        this.baseURL = \"https://api.anthropic.com/v1/messages\";\n    }\n    async generateText(prompt, options = {}) {\n        const apiCall = async (opts)=>{\n            const response = await fetch(this.baseURL, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"x-api-key\": this.apiKey,\n                    \"anthropic-version\": \"2023-06-01\"\n                },\n                body: JSON.stringify({\n                    model: this.model,\n                    max_tokens: opts.maxTokens || 3000,\n                    messages: [\n                        {\n                            role: \"user\",\n                            content: prompt\n                        }\n                    ],\n                    temperature: options.temperature || 0.7\n                })\n            });\n            if (!response.ok) {\n                throw new Error(`Claude API error: ${response.statusText}`);\n            }\n            const data = await response.json();\n            return data.content[0].text;\n        };\n        return _guarded_client_js__WEBPACK_IMPORTED_MODULE_0__.guardedClient.execute(apiCall, options);\n    }\n    async generateJSON(prompt, options = {}) {\n        const jsonPrompt = `${prompt}\\n\\nRespond with valid JSON only. No markdown, no explanation.`;\n        const result = await this.generateText(jsonPrompt, options);\n        if (result.success) {\n            try {\n                result.data = JSON.parse(result.data);\n            } catch (e) {\n                result.success = false;\n                result.error = \"Invalid JSON response\";\n            }\n        }\n        return result;\n    }\n    estimateCost(inputTokens, outputTokens) {\n        // Claude Sonnet 4 pricing (approximate)\n        const inputCost = inputTokens * 0.000003; // $3 per 1M tokens\n        const outputCost = outputTokens * 0.000015; // $15 per 1M tokens\n        return {\n            inputCost,\n            outputCost,\n            totalCost: inputCost + outputCost,\n            currency: \"USD\"\n        };\n    }\n}\n/**\r\n * OpenAI (GPT) Provider\r\n */ class OpenAIProvider extends LLMProvider {\n    constructor(config = {}){\n        super(config);\n        this.name = \"openai\";\n        this.apiKey = config.apiKey || process.env.OPENAI_API_KEY;\n        this.model = config.model || \"gpt-4-turbo-preview\";\n        this.baseURL = \"https://api.openai.com/v1/chat/completions\";\n    }\n    async generateText(prompt, options = {}) {\n        const apiCall = async (opts)=>{\n            const response = await fetch(this.baseURL, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Authorization\": `Bearer ${this.apiKey}`\n                },\n                body: JSON.stringify({\n                    model: this.model,\n                    max_tokens: opts.maxTokens || 3000,\n                    messages: [\n                        {\n                            role: \"user\",\n                            content: prompt\n                        }\n                    ],\n                    temperature: options.temperature || 0.7\n                })\n            });\n            if (!response.ok) {\n                throw new Error(`OpenAI API error: ${response.statusText}`);\n            }\n            const data = await response.json();\n            return data.choices[0].message.content;\n        };\n        return _guarded_client_js__WEBPACK_IMPORTED_MODULE_0__.guardedClient.execute(apiCall, options);\n    }\n    async generateJSON(prompt, options = {}) {\n        const jsonPrompt = `${prompt}\\n\\nRespond with valid JSON only.`;\n        const result = await this.generateText(jsonPrompt, options);\n        if (result.success) {\n            try {\n                result.data = JSON.parse(result.data);\n            } catch (e) {\n                result.success = false;\n                result.error = \"Invalid JSON response\";\n            }\n        }\n        return result;\n    }\n    estimateCost(inputTokens, outputTokens) {\n        // GPT-4 Turbo pricing\n        const inputCost = inputTokens * 0.00001; // $10 per 1M tokens\n        const outputCost = outputTokens * 0.00003; // $30 per 1M tokens\n        return {\n            inputCost,\n            outputCost,\n            totalCost: inputCost + outputCost,\n            currency: \"USD\"\n        };\n    }\n}\n/**\r\n * Mock Provider (for testing/development)\r\n */ class MockProvider extends LLMProvider {\n    constructor(config = {}){\n        super(config);\n        this.name = \"mock\";\n        this.delay = config.delay || 100;\n    }\n    async generateText(prompt, options = {}) {\n        await new Promise((resolve)=>setTimeout(resolve, this.delay));\n        return {\n            success: true,\n            data: `Mock response to: ${prompt.substring(0, 50)}...`,\n            metadata: {\n                requestId: \"mock_\" + Date.now(),\n                duration: this.delay,\n                tokensUsed: 100,\n                cost: 0\n            }\n        };\n    }\n    async generateJSON(prompt, options = {}) {\n        await new Promise((resolve)=>setTimeout(resolve, this.delay));\n        return {\n            success: true,\n            data: {\n                mock: true,\n                prompt: prompt.substring(0, 50)\n            },\n            metadata: {\n                requestId: \"mock_\" + Date.now(),\n                duration: this.delay,\n                tokensUsed: 100,\n                cost: 0\n            }\n        };\n    }\n    estimateCost(inputTokens, outputTokens) {\n        return {\n            inputCost: 0,\n            outputCost: 0,\n            totalCost: 0,\n            currency: \"USD\"\n        };\n    }\n}\n/**\r\n * LLM Adapter - Factory for creating providers\r\n */ class LLMAdapter {\n    static{\n        this.providers = {\n            claude: ClaudeProvider,\n            openai: OpenAIProvider,\n            mock: MockProvider\n        };\n    }\n    /**\r\n   * Create provider instance\r\n   * @param {string} providerName - 'claude', 'openai', or 'mock'\r\n   * @param {Object} config - Provider configuration\r\n   */ static createProvider(providerName, config = {}) {\n        // Trim whitespace and convert to lowercase\n        const cleanName = (providerName || \"\").trim().toLowerCase();\n        const ProviderClass = this.providers[cleanName];\n        if (!ProviderClass) {\n            console.error(`Unknown provider: \"${cleanName}\". Available: ${Object.keys(this.providers).join(\", \")}`);\n            // Fallback to mock provider in production to avoid breaking the app\n            return new MockProvider(config);\n        }\n        return new ProviderClass(config);\n    }\n    /**\r\n   * Get default provider from environment\r\n   */ static getDefaultProvider() {\n        const providerName = (process.env.LLM_PROVIDER || \"claude\").trim().toLowerCase();\n        return this.createProvider(providerName);\n    }\n    /**\r\n   * Register custom provider\r\n   */ static registerProvider(name, ProviderClass) {\n        this.providers[name] = ProviderClass;\n    }\n}\n// Lazy-load default provider to avoid build-time initialization\nlet _defaultProvider = null;\nfunction getDefaultLLMProvider() {\n    if (!_defaultProvider) {\n        _defaultProvider = LLMAdapter.getDefaultProvider();\n    }\n    return _defaultProvider;\n}\n// Export for backward compatibility (but don't initialize at module load)\nconst llmProvider = {\n    get instance () {\n        return getDefaultLLMProvider();\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBRUssT0FBT0MsSUFBSSxDQUFDLElBQUksQ0FBQ1gsU0FBUyxFQUFFWSxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ3RHLG9FQUFvRTtZQUNwRSxPQUFPLElBQUkzQixhQUFhcEQ7UUFDMUI7UUFFQSxPQUFPLElBQUkyRSxjQUFjM0U7SUFDM0I7SUFFQTs7R0FFQyxHQUNELE9BQU9nRixxQkFBcUI7UUFDMUIsTUFBTVQsZUFBZSxDQUFDM0QsUUFBUUMsR0FBRyxDQUFDb0UsWUFBWSxJQUFJLFFBQU8sRUFBR1IsSUFBSSxHQUFHQyxXQUFXO1FBQzlFLE9BQU8sSUFBSSxDQUFDSixjQUFjLENBQUNDO0lBQzdCO0lBRUE7O0dBRUMsR0FDRCxPQUFPVyxpQkFBaUJqRixJQUFJLEVBQUUwRSxhQUFhLEVBQUU7UUFDM0MsSUFBSSxDQUFDUixTQUFTLENBQUNsRSxLQUFLLEdBQUcwRTtJQUN6QjtBQUNGO0FBRUEsZ0VBQWdFO0FBQ2hFLElBQUlRLG1CQUFtQjtBQUNoQixTQUFTQztJQUNkLElBQUksQ0FBQ0Qsa0JBQWtCO1FBQ3JCQSxtQkFBbUJqQixXQUFXYyxrQkFBa0I7SUFDbEQ7SUFDQSxPQUFPRztBQUNUO0FBRUEsMEVBQTBFO0FBQ25FLE1BQU1FLGNBQWM7SUFDekIsSUFBSUMsWUFBVztRQUNiLE9BQU9GO0lBQ1Q7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGhhbmRpLXJhZy1zeXN0ZW0vLi9saWIvbGxtL2xsbS1hZGFwdGVyLmpzPzRlMGMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gTExNIEFkYXB0ZXIgUGF0dGVybiAtIFZlbmRvci1hZ25vc3RpYyBpbnRlcmZhY2VcclxuLy8gUHJldmVudHMgdmVuZG9yIGxvY2staW4sIGFsbG93cyBzd2l0Y2hpbmcgYmV0d2VlbiBDbGF1ZGUvR1BUL0xvY2FsIG1vZGVsc1xyXG5cclxuaW1wb3J0IHsgZ3VhcmRlZENsaWVudCB9IGZyb20gJy4vZ3VhcmRlZC1jbGllbnQuanMnO1xyXG5cclxuLyoqXHJcbiAqIEFic3RyYWN0IExMTSBQcm92aWRlciBpbnRlcmZhY2VcclxuICovXHJcbmV4cG9ydCBjbGFzcyBMTE1Qcm92aWRlciB7XHJcbiAgY29uc3RydWN0b3IoY29uZmlnKSB7XHJcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcclxuICAgIHRoaXMubmFtZSA9ICdiYXNlJztcclxuICB9XHJcblxyXG4gIGFzeW5jIGdlbmVyYXRlVGV4dChwcm9tcHQsIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdnZW5lcmF0ZVRleHQgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBwcm92aWRlcicpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2VuZXJhdGVKU09OKHByb21wdCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2dlbmVyYXRlSlNPTiBtdXN0IGJlIGltcGxlbWVudGVkIGJ5IHByb3ZpZGVyJyk7XHJcbiAgfVxyXG5cclxuICBlc3RpbWF0ZUNvc3QoaW5wdXRUb2tlbnMsIG91dHB1dFRva2Vucykge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdlc3RpbWF0ZUNvc3QgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBwcm92aWRlcicpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENsYXVkZSAoQW50aHJvcGljKSBQcm92aWRlclxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIENsYXVkZVByb3ZpZGVyIGV4dGVuZHMgTExNUHJvdmlkZXIge1xyXG4gIGNvbnN0cnVjdG9yKGNvbmZpZyA9IHt9KSB7XHJcbiAgICBzdXBlcihjb25maWcpO1xyXG4gICAgdGhpcy5uYW1lID0gJ2NsYXVkZSc7XHJcbiAgICB0aGlzLmFwaUtleSA9IGNvbmZpZy5hcGlLZXkgfHwgcHJvY2Vzcy5lbnYuQU5USFJPUElDX0FQSV9LRVk7XHJcbiAgICB0aGlzLm1vZGVsID0gY29uZmlnLm1vZGVsIHx8ICdjbGF1ZGUtc29ubmV0LTQtMjAyNTA1MTQnO1xyXG4gICAgdGhpcy5iYXNlVVJMID0gJ2h0dHBzOi8vYXBpLmFudGhyb3BpYy5jb20vdjEvbWVzc2FnZXMnO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2VuZXJhdGVUZXh0KHByb21wdCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICBjb25zdCBhcGlDYWxsID0gYXN5bmMgKG9wdHMpID0+IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh0aGlzLmJhc2VVUkwsIHtcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgJ3gtYXBpLWtleSc6IHRoaXMuYXBpS2V5LFxyXG4gICAgICAgICAgJ2FudGhyb3BpYy12ZXJzaW9uJzogJzIwMjMtMDYtMDEnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcclxuICAgICAgICAgIG1heF90b2tlbnM6IG9wdHMubWF4VG9rZW5zIHx8IDMwMDAsXHJcbiAgICAgICAgICBtZXNzYWdlczogW3sgcm9sZTogJ3VzZXInLCBjb250ZW50OiBwcm9tcHQgfV0sXHJcbiAgICAgICAgICB0ZW1wZXJhdHVyZTogb3B0aW9ucy50ZW1wZXJhdHVyZSB8fCAwLjdcclxuICAgICAgICB9KVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENsYXVkZSBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgcmV0dXJuIGRhdGEuY29udGVudFswXS50ZXh0O1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gZ3VhcmRlZENsaWVudC5leGVjdXRlKGFwaUNhbGwsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2VuZXJhdGVKU09OKHByb21wdCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICBjb25zdCBqc29uUHJvbXB0ID0gYCR7cHJvbXB0fVxcblxcblJlc3BvbmQgd2l0aCB2YWxpZCBKU09OIG9ubHkuIE5vIG1hcmtkb3duLCBubyBleHBsYW5hdGlvbi5gO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5nZW5lcmF0ZVRleHQoanNvblByb21wdCwgb3B0aW9ucyk7XHJcbiAgICBcclxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHJlc3VsdC5kYXRhID0gSlNPTi5wYXJzZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXN1bHQuc3VjY2VzcyA9IGZhbHNlO1xyXG4gICAgICAgIHJlc3VsdC5lcnJvciA9ICdJbnZhbGlkIEpTT04gcmVzcG9uc2UnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIGVzdGltYXRlQ29zdChpbnB1dFRva2Vucywgb3V0cHV0VG9rZW5zKSB7XHJcbiAgICAvLyBDbGF1ZGUgU29ubmV0IDQgcHJpY2luZyAoYXBwcm94aW1hdGUpXHJcbiAgICBjb25zdCBpbnB1dENvc3QgPSBpbnB1dFRva2VucyAqIDAuMDAwMDAzOyAvLyAkMyBwZXIgMU0gdG9rZW5zXHJcbiAgICBjb25zdCBvdXRwdXRDb3N0ID0gb3V0cHV0VG9rZW5zICogMC4wMDAwMTU7IC8vICQxNSBwZXIgMU0gdG9rZW5zXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpbnB1dENvc3QsXHJcbiAgICAgIG91dHB1dENvc3QsXHJcbiAgICAgIHRvdGFsQ29zdDogaW5wdXRDb3N0ICsgb3V0cHV0Q29zdCxcclxuICAgICAgY3VycmVuY3k6ICdVU0QnXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIE9wZW5BSSAoR1BUKSBQcm92aWRlclxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIE9wZW5BSVByb3ZpZGVyIGV4dGVuZHMgTExNUHJvdmlkZXIge1xyXG4gIGNvbnN0cnVjdG9yKGNvbmZpZyA9IHt9KSB7XHJcbiAgICBzdXBlcihjb25maWcpO1xyXG4gICAgdGhpcy5uYW1lID0gJ29wZW5haSc7XHJcbiAgICB0aGlzLmFwaUtleSA9IGNvbmZpZy5hcGlLZXkgfHwgcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVk7XHJcbiAgICB0aGlzLm1vZGVsID0gY29uZmlnLm1vZGVsIHx8ICdncHQtNC10dXJiby1wcmV2aWV3JztcclxuICAgIHRoaXMuYmFzZVVSTCA9ICdodHRwczovL2FwaS5vcGVuYWkuY29tL3YxL2NoYXQvY29tcGxldGlvbnMnO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2VuZXJhdGVUZXh0KHByb21wdCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICBjb25zdCBhcGlDYWxsID0gYXN5bmMgKG9wdHMpID0+IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh0aGlzLmJhc2VVUkwsIHtcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hcGlLZXl9YFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXHJcbiAgICAgICAgICBtYXhfdG9rZW5zOiBvcHRzLm1heFRva2VucyB8fCAzMDAwLFxyXG4gICAgICAgICAgbWVzc2FnZXM6IFt7IHJvbGU6ICd1c2VyJywgY29udGVudDogcHJvbXB0IH1dLFxyXG4gICAgICAgICAgdGVtcGVyYXR1cmU6IG9wdGlvbnMudGVtcGVyYXR1cmUgfHwgMC43XHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBPcGVuQUkgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIHJldHVybiBkYXRhLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50O1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gZ3VhcmRlZENsaWVudC5leGVjdXRlKGFwaUNhbGwsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2VuZXJhdGVKU09OKHByb21wdCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICBjb25zdCBqc29uUHJvbXB0ID0gYCR7cHJvbXB0fVxcblxcblJlc3BvbmQgd2l0aCB2YWxpZCBKU09OIG9ubHkuYDtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVUZXh0KGpzb25Qcm9tcHQsIG9wdGlvbnMpO1xyXG4gICAgXHJcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICByZXN1bHQuZGF0YSA9IEpTT04ucGFyc2UocmVzdWx0LmRhdGEpO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgcmVzdWx0LnN1Y2Nlc3MgPSBmYWxzZTtcclxuICAgICAgICByZXN1bHQuZXJyb3IgPSAnSW52YWxpZCBKU09OIHJlc3BvbnNlJztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICBlc3RpbWF0ZUNvc3QoaW5wdXRUb2tlbnMsIG91dHB1dFRva2Vucykge1xyXG4gICAgLy8gR1BULTQgVHVyYm8gcHJpY2luZ1xyXG4gICAgY29uc3QgaW5wdXRDb3N0ID0gaW5wdXRUb2tlbnMgKiAwLjAwMDAxOyAvLyAkMTAgcGVyIDFNIHRva2Vuc1xyXG4gICAgY29uc3Qgb3V0cHV0Q29zdCA9IG91dHB1dFRva2VucyAqIDAuMDAwMDM7IC8vICQzMCBwZXIgMU0gdG9rZW5zXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpbnB1dENvc3QsXHJcbiAgICAgIG91dHB1dENvc3QsXHJcbiAgICAgIHRvdGFsQ29zdDogaW5wdXRDb3N0ICsgb3V0cHV0Q29zdCxcclxuICAgICAgY3VycmVuY3k6ICdVU0QnXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIE1vY2sgUHJvdmlkZXIgKGZvciB0ZXN0aW5nL2RldmVsb3BtZW50KVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIE1vY2tQcm92aWRlciBleHRlbmRzIExMTVByb3ZpZGVyIHtcclxuICBjb25zdHJ1Y3Rvcihjb25maWcgPSB7fSkge1xyXG4gICAgc3VwZXIoY29uZmlnKTtcclxuICAgIHRoaXMubmFtZSA9ICdtb2NrJztcclxuICAgIHRoaXMuZGVsYXkgPSBjb25maWcuZGVsYXkgfHwgMTAwO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2VuZXJhdGVUZXh0KHByb21wdCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgdGhpcy5kZWxheSkpO1xyXG4gICAgXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiBgTW9jayByZXNwb25zZSB0bzogJHtwcm9tcHQuc3Vic3RyaW5nKDAsIDUwKX0uLi5gLFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIHJlcXVlc3RJZDogJ21vY2tfJyArIERhdGUubm93KCksXHJcbiAgICAgICAgZHVyYXRpb246IHRoaXMuZGVsYXksXHJcbiAgICAgICAgdG9rZW5zVXNlZDogMTAwLFxyXG4gICAgICAgIGNvc3Q6IDBcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdlbmVyYXRlSlNPTihwcm9tcHQsIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIHRoaXMuZGVsYXkpKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YTogeyBtb2NrOiB0cnVlLCBwcm9tcHQ6IHByb21wdC5zdWJzdHJpbmcoMCwgNTApIH0sXHJcbiAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgcmVxdWVzdElkOiAnbW9ja18nICsgRGF0ZS5ub3coKSxcclxuICAgICAgICBkdXJhdGlvbjogdGhpcy5kZWxheSxcclxuICAgICAgICB0b2tlbnNVc2VkOiAxMDAsXHJcbiAgICAgICAgY29zdDogMFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZXN0aW1hdGVDb3N0KGlucHV0VG9rZW5zLCBvdXRwdXRUb2tlbnMpIHtcclxuICAgIHJldHVybiB7IGlucHV0Q29zdDogMCwgb3V0cHV0Q29zdDogMCwgdG90YWxDb3N0OiAwLCBjdXJyZW5jeTogJ1VTRCcgfTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBMTE0gQWRhcHRlciAtIEZhY3RvcnkgZm9yIGNyZWF0aW5nIHByb3ZpZGVyc1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIExMTUFkYXB0ZXIge1xyXG4gIHN0YXRpYyBwcm92aWRlcnMgPSB7XHJcbiAgICBjbGF1ZGU6IENsYXVkZVByb3ZpZGVyLFxyXG4gICAgb3BlbmFpOiBPcGVuQUlQcm92aWRlcixcclxuICAgIG1vY2s6IE1vY2tQcm92aWRlclxyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBwcm92aWRlciBpbnN0YW5jZVxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwcm92aWRlck5hbWUgLSAnY2xhdWRlJywgJ29wZW5haScsIG9yICdtb2NrJ1xyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgLSBQcm92aWRlciBjb25maWd1cmF0aW9uXHJcbiAgICovXHJcbiAgc3RhdGljIGNyZWF0ZVByb3ZpZGVyKHByb3ZpZGVyTmFtZSwgY29uZmlnID0ge30pIHtcclxuICAgIC8vIFRyaW0gd2hpdGVzcGFjZSBhbmQgY29udmVydCB0byBsb3dlcmNhc2VcclxuICAgIGNvbnN0IGNsZWFuTmFtZSA9IChwcm92aWRlck5hbWUgfHwgJycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgY29uc3QgUHJvdmlkZXJDbGFzcyA9IHRoaXMucHJvdmlkZXJzW2NsZWFuTmFtZV07XHJcbiAgICBcclxuICAgIGlmICghUHJvdmlkZXJDbGFzcykge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBVbmtub3duIHByb3ZpZGVyOiBcIiR7Y2xlYW5OYW1lfVwiLiBBdmFpbGFibGU6ICR7T2JqZWN0LmtleXModGhpcy5wcm92aWRlcnMpLmpvaW4oJywgJyl9YCk7XHJcbiAgICAgIC8vIEZhbGxiYWNrIHRvIG1vY2sgcHJvdmlkZXIgaW4gcHJvZHVjdGlvbiB0byBhdm9pZCBicmVha2luZyB0aGUgYXBwXHJcbiAgICAgIHJldHVybiBuZXcgTW9ja1Byb3ZpZGVyKGNvbmZpZyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm92aWRlckNsYXNzKGNvbmZpZyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgZGVmYXVsdCBwcm92aWRlciBmcm9tIGVudmlyb25tZW50XHJcbiAgICovXHJcbiAgc3RhdGljIGdldERlZmF1bHRQcm92aWRlcigpIHtcclxuICAgIGNvbnN0IHByb3ZpZGVyTmFtZSA9IChwcm9jZXNzLmVudi5MTE1fUFJPVklERVIgfHwgJ2NsYXVkZScpLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlUHJvdmlkZXIocHJvdmlkZXJOYW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlZ2lzdGVyIGN1c3RvbSBwcm92aWRlclxyXG4gICAqL1xyXG4gIHN0YXRpYyByZWdpc3RlclByb3ZpZGVyKG5hbWUsIFByb3ZpZGVyQ2xhc3MpIHtcclxuICAgIHRoaXMucHJvdmlkZXJzW25hbWVdID0gUHJvdmlkZXJDbGFzcztcclxuICB9XHJcbn1cclxuXHJcbi8vIExhenktbG9hZCBkZWZhdWx0IHByb3ZpZGVyIHRvIGF2b2lkIGJ1aWxkLXRpbWUgaW5pdGlhbGl6YXRpb25cclxubGV0IF9kZWZhdWx0UHJvdmlkZXIgPSBudWxsO1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdExMTVByb3ZpZGVyKCkge1xyXG4gIGlmICghX2RlZmF1bHRQcm92aWRlcikge1xyXG4gICAgX2RlZmF1bHRQcm92aWRlciA9IExMTUFkYXB0ZXIuZ2V0RGVmYXVsdFByb3ZpZGVyKCk7XHJcbiAgfVxyXG4gIHJldHVybiBfZGVmYXVsdFByb3ZpZGVyO1xyXG59XHJcblxyXG4vLyBFeHBvcnQgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgKGJ1dCBkb24ndCBpbml0aWFsaXplIGF0IG1vZHVsZSBsb2FkKVxyXG5leHBvcnQgY29uc3QgbGxtUHJvdmlkZXIgPSB7XHJcbiAgZ2V0IGluc3RhbmNlKCkge1xyXG4gICAgcmV0dXJuIGdldERlZmF1bHRMTE1Qcm92aWRlcigpO1xyXG4gIH1cclxufTtcclxuIl0sIm5hbWVzIjpbImd1YXJkZWRDbGllbnQiLCJMTE1Qcm92aWRlciIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwibmFtZSIsImdlbmVyYXRlVGV4dCIsInByb21wdCIsIm9wdGlvbnMiLCJFcnJvciIsImdlbmVyYXRlSlNPTiIsImVzdGltYXRlQ29zdCIsImlucHV0VG9rZW5zIiwib3V0cHV0VG9rZW5zIiwiQ2xhdWRlUHJvdmlkZXIiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiQU5USFJPUElDX0FQSV9LRVkiLCJtb2RlbCIsImJhc2VVUkwiLCJhcGlDYWxsIiwib3B0cyIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtYXhfdG9rZW5zIiwibWF4VG9rZW5zIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsInRlbXBlcmF0dXJlIiwib2siLCJzdGF0dXNUZXh0IiwiZGF0YSIsImpzb24iLCJ0ZXh0IiwiZXhlY3V0ZSIsImpzb25Qcm9tcHQiLCJyZXN1bHQiLCJzdWNjZXNzIiwicGFyc2UiLCJlIiwiZXJyb3IiLCJpbnB1dENvc3QiLCJvdXRwdXRDb3N0IiwidG90YWxDb3N0IiwiY3VycmVuY3kiLCJPcGVuQUlQcm92aWRlciIsIk9QRU5BSV9BUElfS0VZIiwiY2hvaWNlcyIsIm1lc3NhZ2UiLCJNb2NrUHJvdmlkZXIiLCJkZWxheSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInN1YnN0cmluZyIsIm1ldGFkYXRhIiwicmVxdWVzdElkIiwiRGF0ZSIsIm5vdyIsImR1cmF0aW9uIiwidG9rZW5zVXNlZCIsImNvc3QiLCJtb2NrIiwiTExNQWRhcHRlciIsInByb3ZpZGVycyIsImNsYXVkZSIsIm9wZW5haSIsImNyZWF0ZVByb3ZpZGVyIiwicHJvdmlkZXJOYW1lIiwiY2xlYW5OYW1lIiwidHJpbSIsInRvTG93ZXJDYXNlIiwiUHJvdmlkZXJDbGFzcyIsImNvbnNvbGUiLCJPYmplY3QiLCJrZXlzIiwiam9pbiIsImdldERlZmF1bHRQcm92aWRlciIsIkxMTV9QUk9WSURFUiIsInJlZ2lzdGVyUHJvdmlkZXIiLCJfZGVmYXVsdFByb3ZpZGVyIiwiZ2V0RGVmYXVsdExMTVByb3ZpZGVyIiwibGxtUHJvdmlkZXIiLCJpbnN0YW5jZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/llm/llm-adapter.js\n");

/***/ }),

/***/ "(rsc)/./lib/rag/career-matcher.js":
/*!***********************************!*\
  !*** ./lib/rag/career-matcher.js ***!
  \***********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getFallbackCareers: () => (/* binding */ getFallbackCareers),\n/* harmony export */   matchCareersToProfile: () => (/* binding */ matchCareersToProfile)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var _search_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./search.js */ \"(rsc)/./lib/rag/search.js\");\n// lib/rag/career-matcher.js\n// Phase 2: Career Matching Algorithm\n// Replaces hardcoded career suggestions with intelligent knowledge base queries\n\n\n\n// Lazy initialization\nlet supabase = null;\nlet openai = null;\nfunction getSupabaseClient() {\n    if (!supabase) {\n        supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(\"https://pvvnxupuukuefajypovz.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY);\n    }\n    return supabase;\n}\nfunction getOpenAIClient() {\n    if (!openai) {\n        openai = new openai__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n            apiKey: process.env.OPENAI_API_KEY\n        });\n    }\n    return openai;\n}\n/**\r\n * Generate embedding for a text query\r\n * @param {string} text - Text to embed\r\n * @returns {Promise<Array>} - 1536-dimensional embedding vector\r\n */ async function generateEmbedding(text) {\n    try {\n        const client = getOpenAIClient();\n        const response = await client.embeddings.create({\n            model: \"text-embedding-ada-002\",\n            input: text\n        });\n        return response.data[0].embedding;\n    } catch (error) {\n        console.error(\"Error generating embedding:\", error.message);\n        throw error;\n    }\n}\n/**\r\n * Build search query from user profile\r\n * @param {Object} profile - User profile with subjects, interests, etc.\r\n * @returns {string} - Search query string\r\n */ function buildSearchQuery(profile) {\n    const parts = [];\n    // Add subjects\n    if (profile.subjects && profile.subjects.length > 0) {\n        parts.push(profile.subjects.join(\" \"));\n    }\n    // Add interests\n    if (profile.interests && profile.interests.length > 0) {\n        parts.push(profile.interests.join(\" \"));\n    }\n    // Add career preferences if available\n    if (profile.careerPreferences) {\n        parts.push(profile.careerPreferences);\n    }\n    // Add context based on grade\n    if (profile.grade) {\n        parts.push(`grade ${profile.grade} student`);\n    }\n    return parts.join(\" \");\n}\n/**\r\n * Extract keywords for hybrid search\r\n * @param {Object} profile - User profile\r\n * @returns {Array<string>} - Keywords for matching\r\n */ function extractKeywords(profile) {\n    const keywords = [];\n    // Subject keywords\n    if (profile.subjects) {\n        keywords.push(...profile.subjects);\n    }\n    // Interest keywords\n    if (profile.interests) {\n        keywords.push(...profile.interests);\n    }\n    return keywords;\n}\n/**\r\n * Match careers to user profile using RAG\r\n * @param {Object} profile - User profile with subjects, interests, marks, etc.\r\n * @param {Object} options - Matching options\r\n * @returns {Promise<Array>} - Matched careers with metadata\r\n */ async function matchCareersToProfile(profile, options = {}) {\n    const { limit = 5, minSimilarity = 0.7, useHybrid = true } = options;\n    try {\n        console.log(\"\\uD83D\\uDD0D Matching careers for profile:\", {\n            grade: profile.grade,\n            subjects: profile.subjects,\n            interests: profile.interests\n        });\n        // Build search query\n        const searchQuery = buildSearchQuery(profile);\n        console.log(\"\\uD83D\\uDCDD Search query:\", searchQuery);\n        // Generate embedding\n        const queryEmbedding = await generateEmbedding(searchQuery);\n        // Perform search (get more results to filter)\n        let results;\n        if (useHybrid) {\n            const keywords = extractKeywords(profile);\n            results = await (0,_search_js__WEBPACK_IMPORTED_MODULE_0__.hybridSearch)(queryEmbedding, keywords, {\n                limit: limit * 4\n            });\n        } else {\n            results = await (0,_search_js__WEBPACK_IMPORTED_MODULE_0__.semanticSearch)(queryEmbedding, {\n                limit: limit * 4\n            });\n        }\n        console.log(`✅ Found ${results.length} potential matches`);\n        // Filter and rank results\n        console.log(\"\\uD83D\\uDD0D Filtering results...\");\n        console.log(`   - Before filter: ${results.length} results`);\n        if (results.length > 0) {\n            const sample = results[0];\n            console.log(`   - Sample result metadata:`, sample.chunk_metadata);\n        }\n        const rankedCareers = results.filter((r)=>r.similarity >= minSimilarity).filter((r)=>{\n            // Check if it's career-related content by looking at metadata\n            const metadata = r.chunk_metadata || {};\n            // Accept various career metadata formats\n            const hasCareerData = metadata.career_code && metadata.career_title || metadata.career_code && metadata.career_name || metadata.career && metadata.type === \"keyword_rich_summary\" || metadata.career_name;\n            return hasCareerData;\n        }).slice(0, limit);\n        console.log(`   - After filter: ${rankedCareers.length} results`);\n        // Enrich with career metadata\n        const enrichedCareers = await enrichCareerData(rankedCareers);\n        console.log(`🎯 Returning ${enrichedCareers.length} matched careers`);\n        return enrichedCareers;\n    } catch (error) {\n        console.error(\"❌ Error matching careers:\", error);\n        throw error;\n    }\n}\n/**\r\n * Enrich career chunks with full career data from database\r\n * @param {Array} careerChunks - Matched career chunks\r\n * @returns {Promise<Array>} - Enriched career data\r\n */ async function enrichCareerData(careerChunks) {\n    const enriched = [];\n    for (const chunk of careerChunks){\n        const metadata = chunk.chunk_metadata || {};\n        const careerCode = metadata.career_code;\n        // Try to get full career data from careers table\n        let careerData = null;\n        if (careerCode) {\n            const client = getSupabaseClient();\n            const { data, error } = await client.from(\"careers\").select(\"*\").eq(\"career_code\", careerCode).single();\n            if (!error && data) {\n                careerData = data;\n            }\n        }\n        // Extract career title from various metadata formats\n        const title = metadata.career_title || metadata.career_name || metadata.career || careerData?.career_title;\n        if (!title) {\n            console.log(`   ⚠️ Skipping chunk without career title`);\n            continue;\n        }\n        // Build enriched career object\n        enriched.push({\n            title: title,\n            code: careerCode,\n            category: metadata.career_category || careerData?.career_category,\n            description: chunk.chunk_text,\n            similarity: chunk.similarity,\n            // From database if available\n            education: careerData?.required_education,\n            qualifications: careerData?.required_qualifications,\n            subjects: careerData?.required_subjects,\n            salaryRange: careerData ? {\n                entry: {\n                    min: careerData.salary_entry_min,\n                    max: careerData.salary_entry_max\n                },\n                mid: {\n                    min: careerData.salary_mid_min,\n                    max: careerData.salary_mid_max\n                },\n                senior: {\n                    min: careerData.salary_senior_min,\n                    max: careerData.salary_senior_max\n                }\n            } : null,\n            outlook: careerData?.job_outlook,\n            demand: careerData?.demand_level,\n            // Metadata\n            metadata: metadata,\n            fullData: careerData\n        });\n    }\n    return enriched;\n}\n/**\r\n * Fallback: Get broad career suggestions when no good matches\r\n * @param {Object} profile - User profile\r\n * @returns {Promise<Array>} - Broad career suggestions\r\n */ async function getFallbackCareers(profile) {\n    console.log(\"⚠️ Using fallback career suggestions\");\n    // Get popular careers from different categories\n    const client = getSupabaseClient();\n    const { data, error } = await client.from(\"careers\").select(\"*\").in(\"demand_level\", [\n        \"very_high\",\n        \"high\"\n    ]).limit(5);\n    if (error || !data) {\n        console.error(\"Error fetching fallback careers:\", error);\n        return [];\n    }\n    return data.map((career)=>({\n            title: career.career_title,\n            code: career.career_code,\n            category: career.career_category,\n            description: career.short_description,\n            similarity: 0.5,\n            education: career.required_education,\n            qualifications: career.required_qualifications,\n            subjects: career.required_subjects,\n            salaryRange: {\n                entry: {\n                    min: career.salary_entry_min,\n                    max: career.salary_entry_max\n                }\n            },\n            outlook: career.job_outlook,\n            demand: career.demand_level,\n            fullData: career\n        }));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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MUJpQixNQUFNZixPQUFPSCxXQUFXO1lBQ3hCbUIsVUFBVWhCLE9BQU9pQixlQUFlO1lBQ2hDQyxhQUFhbEIsT0FBTzZDLGlCQUFpQjtZQUNyQ25ELFlBQVk7WUFDWjBCLFdBQVdwQixPQUFPcUIsa0JBQWtCO1lBQ3BDQyxnQkFBZ0J0QixPQUFPdUIsdUJBQXVCO1lBQzlDcEQsVUFBVTZCLE9BQU93QixpQkFBaUI7WUFDbENDLGFBQWE7Z0JBQ1hDLE9BQU87b0JBQUVDLEtBQUszQixPQUFPNEIsZ0JBQWdCO29CQUFFQyxLQUFLN0IsT0FBTzhCLGdCQUFnQjtnQkFBQztZQUN0RTtZQUNBTyxTQUFTckMsT0FBT3NDLFdBQVc7WUFDM0JDLFFBQVF2QyxPQUFPd0MsWUFBWTtZQUMzQkMsVUFBVXpDO1FBQ1o7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3RoYW5kaS1yYWctc3lzdGVtLy4vbGliL3JhZy9jYXJlZXItbWF0Y2hlci5qcz9kYzZkIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9yYWcvY2FyZWVyLW1hdGNoZXIuanNcclxuLy8gUGhhc2UgMjogQ2FyZWVyIE1hdGNoaW5nIEFsZ29yaXRobVxyXG4vLyBSZXBsYWNlcyBoYXJkY29kZWQgY2FyZWVyIHN1Z2dlc3Rpb25zIHdpdGggaW50ZWxsaWdlbnQga25vd2xlZGdlIGJhc2UgcXVlcmllc1xyXG5cclxuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcclxuaW1wb3J0IE9wZW5BSSBmcm9tICdvcGVuYWknO1xyXG5pbXBvcnQgeyBzZW1hbnRpY1NlYXJjaCwgaHlicmlkU2VhcmNoIH0gZnJvbSAnLi9zZWFyY2guanMnO1xyXG5cclxuLy8gTGF6eSBpbml0aWFsaXphdGlvblxyXG5sZXQgc3VwYWJhc2UgPSBudWxsO1xyXG5sZXQgb3BlbmFpID0gbnVsbDtcclxuXHJcbmZ1bmN0aW9uIGdldFN1cGFiYXNlQ2xpZW50KCkge1xyXG4gIGlmICghc3VwYWJhc2UpIHtcclxuICAgIHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxyXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwsXHJcbiAgICAgIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVlcclxuICAgICk7XHJcbiAgfVxyXG4gIHJldHVybiBzdXBhYmFzZTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0T3BlbkFJQ2xpZW50KCkge1xyXG4gIGlmICghb3BlbmFpKSB7XHJcbiAgICBvcGVuYWkgPSBuZXcgT3BlbkFJKHsgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSB9KTtcclxuICB9XHJcbiAgcmV0dXJuIG9wZW5haTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdlbmVyYXRlIGVtYmVkZGluZyBmb3IgYSB0ZXh0IHF1ZXJ5XHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IC0gVGV4dCB0byBlbWJlZFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxBcnJheT59IC0gMTUzNi1kaW1lbnNpb25hbCBlbWJlZGRpbmcgdmVjdG9yXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUVtYmVkZGluZyh0ZXh0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNsaWVudCA9IGdldE9wZW5BSUNsaWVudCgpO1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuZW1iZWRkaW5ncy5jcmVhdGUoe1xyXG4gICAgICBtb2RlbDogJ3RleHQtZW1iZWRkaW5nLWFkYS0wMDInLFxyXG4gICAgICBpbnB1dDogdGV4dCxcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlLmRhdGFbMF0uZW1iZWRkaW5nO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZW5lcmF0aW5nIGVtYmVkZGluZzonLCBlcnJvci5tZXNzYWdlKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEJ1aWxkIHNlYXJjaCBxdWVyeSBmcm9tIHVzZXIgcHJvZmlsZVxyXG4gKiBAcGFyYW0ge09iamVjdH0gcHJvZmlsZSAtIFVzZXIgcHJvZmlsZSB3aXRoIHN1YmplY3RzLCBpbnRlcmVzdHMsIGV0Yy5cclxuICogQHJldHVybnMge3N0cmluZ30gLSBTZWFyY2ggcXVlcnkgc3RyaW5nXHJcbiAqL1xyXG5mdW5jdGlvbiBidWlsZFNlYXJjaFF1ZXJ5KHByb2ZpbGUpIHtcclxuICBjb25zdCBwYXJ0cyA9IFtdO1xyXG4gIFxyXG4gIC8vIEFkZCBzdWJqZWN0c1xyXG4gIGlmIChwcm9maWxlLnN1YmplY3RzICYmIHByb2ZpbGUuc3ViamVjdHMubGVuZ3RoID4gMCkge1xyXG4gICAgcGFydHMucHVzaChwcm9maWxlLnN1YmplY3RzLmpvaW4oJyAnKSk7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIEFkZCBpbnRlcmVzdHNcclxuICBpZiAocHJvZmlsZS5pbnRlcmVzdHMgJiYgcHJvZmlsZS5pbnRlcmVzdHMubGVuZ3RoID4gMCkge1xyXG4gICAgcGFydHMucHVzaChwcm9maWxlLmludGVyZXN0cy5qb2luKCcgJykpO1xyXG4gIH1cclxuICBcclxuICAvLyBBZGQgY2FyZWVyIHByZWZlcmVuY2VzIGlmIGF2YWlsYWJsZVxyXG4gIGlmIChwcm9maWxlLmNhcmVlclByZWZlcmVuY2VzKSB7XHJcbiAgICBwYXJ0cy5wdXNoKHByb2ZpbGUuY2FyZWVyUHJlZmVyZW5jZXMpO1xyXG4gIH1cclxuICBcclxuICAvLyBBZGQgY29udGV4dCBiYXNlZCBvbiBncmFkZVxyXG4gIGlmIChwcm9maWxlLmdyYWRlKSB7XHJcbiAgICBwYXJ0cy5wdXNoKGBncmFkZSAke3Byb2ZpbGUuZ3JhZGV9IHN0dWRlbnRgKTtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHBhcnRzLmpvaW4oJyAnKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEV4dHJhY3Qga2V5d29yZHMgZm9yIGh5YnJpZCBzZWFyY2hcclxuICogQHBhcmFtIHtPYmplY3R9IHByb2ZpbGUgLSBVc2VyIHByb2ZpbGVcclxuICogQHJldHVybnMge0FycmF5PHN0cmluZz59IC0gS2V5d29yZHMgZm9yIG1hdGNoaW5nXHJcbiAqL1xyXG5mdW5jdGlvbiBleHRyYWN0S2V5d29yZHMocHJvZmlsZSkge1xyXG4gIGNvbnN0IGtleXdvcmRzID0gW107XHJcbiAgXHJcbiAgLy8gU3ViamVjdCBrZXl3b3Jkc1xyXG4gIGlmIChwcm9maWxlLnN1YmplY3RzKSB7XHJcbiAgICBrZXl3b3Jkcy5wdXNoKC4uLnByb2ZpbGUuc3ViamVjdHMpO1xyXG4gIH1cclxuICBcclxuICAvLyBJbnRlcmVzdCBrZXl3b3Jkc1xyXG4gIGlmIChwcm9maWxlLmludGVyZXN0cykge1xyXG4gICAga2V5d29yZHMucHVzaCguLi5wcm9maWxlLmludGVyZXN0cyk7XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiBrZXl3b3JkcztcclxufVxyXG5cclxuLyoqXHJcbiAqIE1hdGNoIGNhcmVlcnMgdG8gdXNlciBwcm9maWxlIHVzaW5nIFJBR1xyXG4gKiBAcGFyYW0ge09iamVjdH0gcHJvZmlsZSAtIFVzZXIgcHJvZmlsZSB3aXRoIHN1YmplY3RzLCBpbnRlcmVzdHMsIG1hcmtzLCBldGMuXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gTWF0Y2hpbmcgb3B0aW9uc1xyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxBcnJheT59IC0gTWF0Y2hlZCBjYXJlZXJzIHdpdGggbWV0YWRhdGFcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtYXRjaENhcmVlcnNUb1Byb2ZpbGUocHJvZmlsZSwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgY29uc3Qge1xyXG4gICAgbGltaXQgPSA1LFxyXG4gICAgbWluU2ltaWxhcml0eSA9IDAuNyxcclxuICAgIHVzZUh5YnJpZCA9IHRydWVcclxuICB9ID0gb3B0aW9ucztcclxuICBcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coJ/CflI0gTWF0Y2hpbmcgY2FyZWVycyBmb3IgcHJvZmlsZTonLCB7XHJcbiAgICAgIGdyYWRlOiBwcm9maWxlLmdyYWRlLFxyXG4gICAgICBzdWJqZWN0czogcHJvZmlsZS5zdWJqZWN0cyxcclxuICAgICAgaW50ZXJlc3RzOiBwcm9maWxlLmludGVyZXN0c1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8vIEJ1aWxkIHNlYXJjaCBxdWVyeVxyXG4gICAgY29uc3Qgc2VhcmNoUXVlcnkgPSBidWlsZFNlYXJjaFF1ZXJ5KHByb2ZpbGUpO1xyXG4gICAgY29uc29sZS5sb2coJ/Cfk50gU2VhcmNoIHF1ZXJ5OicsIHNlYXJjaFF1ZXJ5KTtcclxuICAgIFxyXG4gICAgLy8gR2VuZXJhdGUgZW1iZWRkaW5nXHJcbiAgICBjb25zdCBxdWVyeUVtYmVkZGluZyA9IGF3YWl0IGdlbmVyYXRlRW1iZWRkaW5nKHNlYXJjaFF1ZXJ5KTtcclxuICAgIFxyXG4gICAgLy8gUGVyZm9ybSBzZWFyY2ggKGdldCBtb3JlIHJlc3VsdHMgdG8gZmlsdGVyKVxyXG4gICAgbGV0IHJlc3VsdHM7XHJcbiAgICBpZiAodXNlSHlicmlkKSB7XHJcbiAgICAgIGNvbnN0IGtleXdvcmRzID0gZXh0cmFjdEtleXdvcmRzKHByb2ZpbGUpO1xyXG4gICAgICByZXN1bHRzID0gYXdhaXQgaHlicmlkU2VhcmNoKHF1ZXJ5RW1iZWRkaW5nLCBrZXl3b3JkcywgeyBsaW1pdDogbGltaXQgKiA0IH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzdWx0cyA9IGF3YWl0IHNlbWFudGljU2VhcmNoKHF1ZXJ5RW1iZWRkaW5nLCB7IGxpbWl0OiBsaW1pdCAqIDQgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKGDinIUgRm91bmQgJHtyZXN1bHRzLmxlbmd0aH0gcG90ZW50aWFsIG1hdGNoZXNgKTtcclxuICAgIFxyXG4gICAgLy8gRmlsdGVyIGFuZCByYW5rIHJlc3VsdHNcclxuICAgIGNvbnNvbGUubG9nKCfwn5SNIEZpbHRlcmluZyByZXN1bHRzLi4uJyk7XHJcbiAgICBjb25zb2xlLmxvZyhgICAgLSBCZWZvcmUgZmlsdGVyOiAke3Jlc3VsdHMubGVuZ3RofSByZXN1bHRzYCk7XHJcbiAgICBpZiAocmVzdWx0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IHNhbXBsZSA9IHJlc3VsdHNbMF07XHJcbiAgICAgIGNvbnNvbGUubG9nKGAgICAtIFNhbXBsZSByZXN1bHQgbWV0YWRhdGE6YCwgc2FtcGxlLmNodW5rX21ldGFkYXRhKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgcmFua2VkQ2FyZWVycyA9IHJlc3VsdHNcclxuICAgICAgLmZpbHRlcihyID0+IHIuc2ltaWxhcml0eSA+PSBtaW5TaW1pbGFyaXR5KVxyXG4gICAgICAuZmlsdGVyKHIgPT4ge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIGl0J3MgY2FyZWVyLXJlbGF0ZWQgY29udGVudCBieSBsb29raW5nIGF0IG1ldGFkYXRhXHJcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSByLmNodW5rX21ldGFkYXRhIHx8IHt9O1xyXG4gICAgICAgIC8vIEFjY2VwdCB2YXJpb3VzIGNhcmVlciBtZXRhZGF0YSBmb3JtYXRzXHJcbiAgICAgICAgY29uc3QgaGFzQ2FyZWVyRGF0YSA9IChtZXRhZGF0YS5jYXJlZXJfY29kZSAmJiBtZXRhZGF0YS5jYXJlZXJfdGl0bGUpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG1ldGFkYXRhLmNhcmVlcl9jb2RlICYmIG1ldGFkYXRhLmNhcmVlcl9uYW1lKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtZXRhZGF0YS5jYXJlZXIgJiYgbWV0YWRhdGEudHlwZSA9PT0gJ2tleXdvcmRfcmljaF9zdW1tYXJ5JykgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5jYXJlZXJfbmFtZTtcclxuICAgICAgICByZXR1cm4gaGFzQ2FyZWVyRGF0YTtcclxuICAgICAgfSlcclxuICAgICAgLnNsaWNlKDAsIGxpbWl0KTtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coYCAgIC0gQWZ0ZXIgZmlsdGVyOiAke3JhbmtlZENhcmVlcnMubGVuZ3RofSByZXN1bHRzYCk7XHJcbiAgICBcclxuICAgIC8vIEVucmljaCB3aXRoIGNhcmVlciBtZXRhZGF0YVxyXG4gICAgY29uc3QgZW5yaWNoZWRDYXJlZXJzID0gYXdhaXQgZW5yaWNoQ2FyZWVyRGF0YShyYW5rZWRDYXJlZXJzKTtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coYPCfjq8gUmV0dXJuaW5nICR7ZW5yaWNoZWRDYXJlZXJzLmxlbmd0aH0gbWF0Y2hlZCBjYXJlZXJzYCk7XHJcbiAgICBcclxuICAgIHJldHVybiBlbnJpY2hlZENhcmVlcnM7XHJcbiAgICBcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIG1hdGNoaW5nIGNhcmVlcnM6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogRW5yaWNoIGNhcmVlciBjaHVua3Mgd2l0aCBmdWxsIGNhcmVlciBkYXRhIGZyb20gZGF0YWJhc2VcclxuICogQHBhcmFtIHtBcnJheX0gY2FyZWVyQ2h1bmtzIC0gTWF0Y2hlZCBjYXJlZXIgY2h1bmtzXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPEFycmF5Pn0gLSBFbnJpY2hlZCBjYXJlZXIgZGF0YVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZW5yaWNoQ2FyZWVyRGF0YShjYXJlZXJDaHVua3MpIHtcclxuICBjb25zdCBlbnJpY2hlZCA9IFtdO1xyXG4gIFxyXG4gIGZvciAoY29uc3QgY2h1bmsgb2YgY2FyZWVyQ2h1bmtzKSB7XHJcbiAgICBjb25zdCBtZXRhZGF0YSA9IGNodW5rLmNodW5rX21ldGFkYXRhIHx8IHt9O1xyXG4gICAgY29uc3QgY2FyZWVyQ29kZSA9IG1ldGFkYXRhLmNhcmVlcl9jb2RlO1xyXG4gICAgXHJcbiAgICAvLyBUcnkgdG8gZ2V0IGZ1bGwgY2FyZWVyIGRhdGEgZnJvbSBjYXJlZXJzIHRhYmxlXHJcbiAgICBsZXQgY2FyZWVyRGF0YSA9IG51bGw7XHJcbiAgICBpZiAoY2FyZWVyQ29kZSkge1xyXG4gICAgICBjb25zdCBjbGllbnQgPSBnZXRTdXBhYmFzZUNsaWVudCgpO1xyXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBjbGllbnRcclxuICAgICAgICAuZnJvbSgnY2FyZWVycycpXHJcbiAgICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgICAgLmVxKCdjYXJlZXJfY29kZScsIGNhcmVlckNvZGUpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFlcnJvciAmJiBkYXRhKSB7XHJcbiAgICAgICAgY2FyZWVyRGF0YSA9IGRhdGE7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gRXh0cmFjdCBjYXJlZXIgdGl0bGUgZnJvbSB2YXJpb3VzIG1ldGFkYXRhIGZvcm1hdHNcclxuICAgIGNvbnN0IHRpdGxlID0gbWV0YWRhdGEuY2FyZWVyX3RpdGxlIHx8IFxyXG4gICAgICAgICAgICAgICAgIG1ldGFkYXRhLmNhcmVlcl9uYW1lIHx8IFxyXG4gICAgICAgICAgICAgICAgIG1ldGFkYXRhLmNhcmVlciB8fFxyXG4gICAgICAgICAgICAgICAgIGNhcmVlckRhdGE/LmNhcmVlcl90aXRsZTtcclxuICAgIFxyXG4gICAgaWYgKCF0aXRsZSkge1xyXG4gICAgICBjb25zb2xlLmxvZyhgICAg4pqg77iPIFNraXBwaW5nIGNodW5rIHdpdGhvdXQgY2FyZWVyIHRpdGxlYCk7XHJcbiAgICAgIGNvbnRpbnVlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBCdWlsZCBlbnJpY2hlZCBjYXJlZXIgb2JqZWN0XHJcbiAgICBlbnJpY2hlZC5wdXNoKHtcclxuICAgICAgdGl0bGU6IHRpdGxlLFxyXG4gICAgICBjb2RlOiBjYXJlZXJDb2RlLFxyXG4gICAgICBjYXRlZ29yeTogbWV0YWRhdGEuY2FyZWVyX2NhdGVnb3J5IHx8IGNhcmVlckRhdGE/LmNhcmVlcl9jYXRlZ29yeSxcclxuICAgICAgZGVzY3JpcHRpb246IGNodW5rLmNodW5rX3RleHQsXHJcbiAgICAgIHNpbWlsYXJpdHk6IGNodW5rLnNpbWlsYXJpdHksXHJcbiAgICAgIFxyXG4gICAgICAvLyBGcm9tIGRhdGFiYXNlIGlmIGF2YWlsYWJsZVxyXG4gICAgICBlZHVjYXRpb246IGNhcmVlckRhdGE/LnJlcXVpcmVkX2VkdWNhdGlvbixcclxuICAgICAgcXVhbGlmaWNhdGlvbnM6IGNhcmVlckRhdGE/LnJlcXVpcmVkX3F1YWxpZmljYXRpb25zLFxyXG4gICAgICBzdWJqZWN0czogY2FyZWVyRGF0YT8ucmVxdWlyZWRfc3ViamVjdHMsXHJcbiAgICAgIHNhbGFyeVJhbmdlOiBjYXJlZXJEYXRhID8ge1xyXG4gICAgICAgIGVudHJ5OiB7IG1pbjogY2FyZWVyRGF0YS5zYWxhcnlfZW50cnlfbWluLCBtYXg6IGNhcmVlckRhdGEuc2FsYXJ5X2VudHJ5X21heCB9LFxyXG4gICAgICAgIG1pZDogeyBtaW46IGNhcmVlckRhdGEuc2FsYXJ5X21pZF9taW4sIG1heDogY2FyZWVyRGF0YS5zYWxhcnlfbWlkX21heCB9LFxyXG4gICAgICAgIHNlbmlvcjogeyBtaW46IGNhcmVlckRhdGEuc2FsYXJ5X3Nlbmlvcl9taW4sIG1heDogY2FyZWVyRGF0YS5zYWxhcnlfc2VuaW9yX21heCB9XHJcbiAgICAgIH0gOiBudWxsLFxyXG4gICAgICBvdXRsb29rOiBjYXJlZXJEYXRhPy5qb2Jfb3V0bG9vayxcclxuICAgICAgZGVtYW5kOiBjYXJlZXJEYXRhPy5kZW1hbmRfbGV2ZWwsXHJcbiAgICAgIFxyXG4gICAgICAvLyBNZXRhZGF0YVxyXG4gICAgICBtZXRhZGF0YTogbWV0YWRhdGEsXHJcbiAgICAgIGZ1bGxEYXRhOiBjYXJlZXJEYXRhXHJcbiAgICB9KTtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIGVucmljaGVkO1xyXG59XHJcblxyXG4vKipcclxuICogRmFsbGJhY2s6IEdldCBicm9hZCBjYXJlZXIgc3VnZ2VzdGlvbnMgd2hlbiBubyBnb29kIG1hdGNoZXNcclxuICogQHBhcmFtIHtPYmplY3R9IHByb2ZpbGUgLSBVc2VyIHByb2ZpbGVcclxuICogQHJldHVybnMge1Byb21pc2U8QXJyYXk+fSAtIEJyb2FkIGNhcmVlciBzdWdnZXN0aW9uc1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEZhbGxiYWNrQ2FyZWVycyhwcm9maWxlKSB7XHJcbiAgY29uc29sZS5sb2coJ+KaoO+4jyBVc2luZyBmYWxsYmFjayBjYXJlZXIgc3VnZ2VzdGlvbnMnKTtcclxuICBcclxuICAvLyBHZXQgcG9wdWxhciBjYXJlZXJzIGZyb20gZGlmZmVyZW50IGNhdGVnb3JpZXNcclxuICBjb25zdCBjbGllbnQgPSBnZXRTdXBhYmFzZUNsaWVudCgpO1xyXG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IGNsaWVudFxyXG4gICAgLmZyb20oJ2NhcmVlcnMnKVxyXG4gICAgLnNlbGVjdCgnKicpXHJcbiAgICAuaW4oJ2RlbWFuZF9sZXZlbCcsIFsndmVyeV9oaWdoJywgJ2hpZ2gnXSlcclxuICAgIC5saW1pdCg1KTtcclxuICBcclxuICBpZiAoZXJyb3IgfHwgIWRhdGEpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGZhbGxiYWNrIGNhcmVlcnM6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gZGF0YS5tYXAoY2FyZWVyID0+ICh7XHJcbiAgICB0aXRsZTogY2FyZWVyLmNhcmVlcl90aXRsZSxcclxuICAgIGNvZGU6IGNhcmVlci5jYXJlZXJfY29kZSxcclxuICAgIGNhdGVnb3J5OiBjYXJlZXIuY2FyZWVyX2NhdGVnb3J5LFxyXG4gICAgZGVzY3JpcHRpb246IGNhcmVlci5zaG9ydF9kZXNjcmlwdGlvbixcclxuICAgIHNpbWlsYXJpdHk6IDAuNSwgLy8gTG93ZXIgc2ltaWxhcml0eSBmb3IgZmFsbGJhY2tcclxuICAgIGVkdWNhdGlvbjogY2FyZWVyLnJlcXVpcmVkX2VkdWNhdGlvbixcclxuICAgIHF1YWxpZmljYXRpb25zOiBjYXJlZXIucmVxdWlyZWRfcXVhbGlmaWNhdGlvbnMsXHJcbiAgICBzdWJqZWN0czogY2FyZWVyLnJlcXVpcmVkX3N1YmplY3RzLFxyXG4gICAgc2FsYXJ5UmFuZ2U6IHtcclxuICAgICAgZW50cnk6IHsgbWluOiBjYXJlZXIuc2FsYXJ5X2VudHJ5X21pbiwgbWF4OiBjYXJlZXIuc2FsYXJ5X2VudHJ5X21heCB9XHJcbiAgICB9LFxyXG4gICAgb3V0bG9vazogY2FyZWVyLmpvYl9vdXRsb29rLFxyXG4gICAgZGVtYW5kOiBjYXJlZXIuZGVtYW5kX2xldmVsLFxyXG4gICAgZnVsbERhdGE6IGNhcmVlclxyXG4gIH0pKTtcclxufVxyXG4iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50IiwiT3BlbkFJIiwic2VtYW50aWNTZWFyY2giLCJoeWJyaWRTZWFyY2giLCJzdXBhYmFzZSIsIm9wZW5haSIsImdldFN1cGFiYXNlQ2xpZW50IiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJnZXRPcGVuQUlDbGllbnQiLCJhcGlLZXkiLCJPUEVOQUlfQVBJX0tFWSIsImdlbmVyYXRlRW1iZWRkaW5nIiwidGV4dCIsImNsaWVudCIsInJlc3BvbnNlIiwiZW1iZWRkaW5ncyIsImNyZWF0ZSIsIm1vZGVsIiwiaW5wdXQiLCJkYXRhIiwiZW1iZWRkaW5nIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsImJ1aWxkU2VhcmNoUXVlcnkiLCJwcm9maWxlIiwicGFydHMiLCJzdWJqZWN0cyIsImxlbmd0aCIsInB1c2giLCJqb2luIiwiaW50ZXJlc3RzIiwiY2FyZWVyUHJlZmVyZW5jZXMiLCJncmFkZSIsImV4dHJhY3RLZXl3b3JkcyIsImtleXdvcmRzIiwibWF0Y2hDYXJlZXJzVG9Qcm9maWxlIiwib3B0aW9ucyIsImxpbWl0IiwibWluU2ltaWxhcml0eSIsInVzZUh5YnJpZCIsImxvZyIsInNlYXJjaFF1ZXJ5IiwicXVlcnlFbWJlZGRpbmciLCJyZXN1bHRzIiwic2FtcGxlIiwiY2h1bmtfbWV0YWRhdGEiLCJyYW5rZWRDYXJlZXJzIiwiZmlsdGVyIiwiciIsInNpbWlsYXJpdHkiLCJtZXRhZGF0YSIsImhhc0NhcmVlckRhdGEiLCJjYXJlZXJfY29kZSIsImNhcmVlcl90aXRsZSIsImNhcmVlcl9uYW1lIiwiY2FyZWVyIiwidHlwZSIsInNsaWNlIiwiZW5yaWNoZWRDYXJlZXJzIiwiZW5yaWNoQ2FyZWVyRGF0YSIsImNhcmVlckNodW5rcyIsImVucmljaGVkIiwiY2h1bmsiLCJjYXJlZXJDb2RlIiwiY2FyZWVyRGF0YSIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsInRpdGxlIiwiY29kZSIsImNhdGVnb3J5IiwiY2FyZWVyX2NhdGVnb3J5IiwiZGVzY3JpcHRpb24iLCJjaHVua190ZXh0IiwiZWR1Y2F0aW9uIiwicmVxdWlyZWRfZWR1Y2F0aW9uIiwicXVhbGlmaWNhdGlvbnMiLCJyZXF1aXJlZF9xdWFsaWZpY2F0aW9ucyIsInJlcXVpcmVkX3N1YmplY3RzIiwic2FsYXJ5UmFuZ2UiLCJlbnRyeSIsIm1pbiIsInNhbGFyeV9lbnRyeV9taW4iLCJtYXgiLCJzYWxhcnlfZW50cnlfbWF4IiwibWlkIiwic2FsYXJ5X21pZF9taW4iLCJzYWxhcnlfbWlkX21heCIsInNlbmlvciIsInNhbGFyeV9zZW5pb3JfbWluIiwic2FsYXJ5X3Nlbmlvcl9tYXgiLCJvdXRsb29rIiwiam9iX291dGxvb2siLCJkZW1hbmQiLCJkZW1hbmRfbGV2ZWwiLCJmdWxsRGF0YSIsImdldEZhbGxiYWNrQ2FyZWVycyIsImluIiwibWFwIiwic2hvcnRfZGVzY3JpcHRpb24iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/rag/career-matcher.js\n");

/***/ }),

/***/ "(rsc)/./lib/rag/report-generator.js":
/*!*************************************!*\
  !*** ./lib/rag/report-generator.js ***!
  \*************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generatePersonalizedReport: () => (/* binding */ generatePersonalizedReport)\n/* harmony export */ });\n/* harmony import */ var _career_matcher_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./career-matcher.js */ \"(rsc)/./lib/rag/career-matcher.js\");\n// lib/rag/report-generator.js\n// Phase 3: Dynamic Report Generation\n// Generates personalized career reports from matched careers\n\n/**\r\n * Generate personalized career report using RAG\r\n * @param {Object} profile - User profile from assessment\r\n * @returns {Promise<Object>} - Structured career report\r\n */ async function generatePersonalizedReport(profile) {\n    console.log(\"\\uD83C\\uDFAF Generating personalized report for profile:\", {\n        grade: profile.grade,\n        subjects: profile.subjects?.slice(0, 3),\n        interests: profile.interests?.slice(0, 3)\n    });\n    try {\n        // Step 1: Match careers using RAG\n        let matchedCareers = await (0,_career_matcher_js__WEBPACK_IMPORTED_MODULE_0__.matchCareersToProfile)(profile, {\n            limit: 5,\n            minSimilarity: 0.7\n        });\n        // Step 2: Fallback if no good matches\n        if (matchedCareers.length === 0) {\n            console.log(\"⚠️ No RAG matches found, using fallback careers\");\n            matchedCareers = await (0,_career_matcher_js__WEBPACK_IMPORTED_MODULE_0__.getFallbackCareers)(profile);\n        }\n        // Step 3: Format careers for response\n        const careerSuggestions = matchedCareers.map((career, index)=>({\n                title: career.title,\n                match: `${Math.round((career.similarity || 0.5) * 100)}%`,\n                description: extractDescription(career.description),\n                requirements: career.education || career.qualifications || \"Requirements vary by institution\",\n                pathways: generatePathways(career),\n                salaryRange: formatSalaryRange(career.salaryRange),\n                category: career.category,\n                demand: career.demand,\n                outlook: career.outlook\n            }));\n        // Step 4: Generate personalized guidance text\n        const personalizedGuidance = generateGuidanceText(profile, careerSuggestions);\n        // Step 5: Generate next steps based on profile\n        const nextSteps = generateNextSteps(profile, careerSuggestions);\n        // Step 6: Generate additional resources\n        const additionalResources = generateResources(profile, careerSuggestions);\n        console.log(`✅ Generated report with ${careerSuggestions.length} personalized careers`);\n        return {\n            personalizedGuidance,\n            careers: careerSuggestions,\n            nextSteps,\n            additionalResources,\n            matchingMethod: matchedCareers.length > 0 ? \"rag_semantic_search\" : \"fallback_popular\",\n            dataSource: \"supabase_knowledge_base\"\n        };\n    } catch (error) {\n        console.error(\"❌ Error generating personalized report:\", error);\n        // Emergency fallback - return basic structure\n        return generateEmergencyFallback(profile);\n    }\n}\n/**\r\n * Extract clean description from career chunk text\r\n * @param {string} description - Raw description from knowledge base\r\n * @returns {string} - Clean, user-friendly description\r\n */ function extractDescription(description) {\n    if (!description) return \"Career description not available\";\n    // Extract the description part after \"Description:\"\n    const match = description.match(/Description:\\s*([^.]+\\.)/);\n    if (match) {\n        return match[1].trim();\n    }\n    // Fallback: take first sentence\n    const firstSentence = description.split(\".\")[0];\n    return firstSentence.length > 20 ? firstSentence + \".\" : description.substring(0, 100) + \"...\";\n}\n/**\r\n * Generate pathways based on career data\r\n * @param {Object} career - Career object with metadata\r\n * @returns {Array<string>} - Array of pathway options\r\n */ function generatePathways(career) {\n    const pathways = [];\n    // Check education requirements\n    if (career.education) {\n        if (career.education.includes(\"Bachelor\") || career.education.includes(\"Degree\")) {\n            pathways.push(\"University\");\n        }\n        if (career.education.includes(\"Diploma\")) {\n            pathways.push(\"TVET College\");\n        }\n        if (career.education.includes(\"Certificate\")) {\n            pathways.push(\"Skills Training\");\n        }\n    }\n    // Add category-specific pathways\n    if (career.category) {\n        switch(career.category.toLowerCase()){\n            case \"engineering\":\n                pathways.push(\"University\", \"TVET College\");\n                break;\n            case \"healthcare\":\n                pathways.push(\"University\", \"Nursing College\", \"Medical School\");\n                break;\n            case \"technology\":\n                pathways.push(\"University\", \"Coding Bootcamp\", \"Online Courses\");\n                break;\n            case \"business\":\n                pathways.push(\"University\", \"Business School\");\n                break;\n            default:\n                pathways.push(\"University\", \"TVET College\");\n        }\n    }\n    // Remove duplicates and return\n    return [\n        ...new Set(pathways)\n    ].slice(0, 3);\n}\n/**\r\n * Format salary range for display\r\n * @param {Object} salaryRange - Salary range object\r\n * @returns {string} - Formatted salary string\r\n */ function formatSalaryRange(salaryRange) {\n    if (!salaryRange || !salaryRange.entry) {\n        return \"Salary varies by experience and location\";\n    }\n    const { min, max } = salaryRange.entry;\n    if (min && max) {\n        return `R${min.toLocaleString()} - R${max.toLocaleString()} per month (entry level)`;\n    }\n    return \"Competitive salary based on experience\";\n}\n/**\r\n * Generate personalized guidance text\r\n * @param {Object} profile - User profile\r\n * @param {Array} careers - Matched careers\r\n * @returns {string} - Personalized guidance text\r\n */ function generateGuidanceText(profile, careers) {\n    const { grade, subjects, mathType, mathMark, interests } = profile;\n    let guidance = `Based on your Grade ${grade} profile`;\n    // Add subjects context\n    if (subjects && subjects.length > 0) {\n        guidance += ` with ${subjects.slice(0, 3).join(\", \")} subjects`;\n    }\n    // Add math context\n    if (mathType && mathMark) {\n        guidance += ` and ${mathType} (${mathMark}%)`;\n    }\n    // Add interests context\n    if (interests && interests.length > 0) {\n        guidance += `, plus your interests in ${interests.slice(0, 2).join(\" and \")}`;\n    }\n    guidance += `, here are your top personalized career matches:`;\n    return guidance;\n}\n/**\r\n * Generate next steps based on profile and careers\r\n * @param {Object} profile - User profile\r\n * @param {Array} careers - Matched careers\r\n * @returns {Array<string>} - Next steps recommendations\r\n */ function generateNextSteps(profile, careers) {\n    const steps = [];\n    // Always include research step\n    steps.push(\"Research these careers in more detail using the provided information\");\n    // Add grade-specific steps\n    if (profile.grade <= 10) {\n        steps.push(\"Consider subject choices for Grade 11-12 based on career requirements\");\n        steps.push(\"Speak to professionals in these fields through career days or networking\");\n    } else {\n        steps.push(\"Research university/college entry requirements for your chosen careers\");\n        steps.push(\"Apply for relevant bursaries and financial aid\");\n    }\n    // Add career-specific steps\n    const categories = [\n        ...new Set(careers.map((c)=>c.category).filter(Boolean))\n    ];\n    if (categories.includes(\"Engineering\")) {\n        steps.push(\"Ensure strong performance in Mathematics and Physical Sciences\");\n    }\n    if (categories.includes(\"Healthcare\")) {\n        steps.push(\"Consider volunteer work at hospitals or clinics for experience\");\n    }\n    if (categories.includes(\"Technology\")) {\n        steps.push(\"Start building a portfolio with coding projects or technical skills\");\n    }\n    return steps.slice(0, 4); // Limit to 4 steps\n}\n/**\r\n * Generate additional resources based on profile\r\n * @param {Object} profile - User profile\r\n * @param {Array} careers - Matched careers\r\n * @returns {Array<string>} - Resource recommendations\r\n */ function generateResources(profile, careers) {\n    const resources = [\n        \"Career guidance counselor at your school\",\n        \"University open days and information sessions\"\n    ];\n    // Add career-specific resources\n    const categories = [\n        ...new Set(careers.map((c)=>c.category).filter(Boolean))\n    ];\n    if (categories.includes(\"Engineering\")) {\n        resources.push(\"Engineering Council of South Africa (ECSA) career information\");\n    }\n    if (categories.includes(\"Healthcare\")) {\n        resources.push(\"Health Professions Council of South Africa (HPCSA) resources\");\n    }\n    if (categories.includes(\"Technology\")) {\n        resources.push(\"Online coding platforms and tech career websites\");\n    }\n    // Add general resources\n    resources.push(\"NSFAS information for funding opportunities\");\n    resources.push(\"Industry professionals on LinkedIn for career insights\");\n    return resources.slice(0, 5); // Limit to 5 resources\n}\n/**\r\n * Emergency fallback when RAG fails completely\r\n * @param {Object} profile - User profile\r\n * @returns {Object} - Basic career report\r\n */ function generateEmergencyFallback(profile) {\n    console.log(\"\\uD83D\\uDEA8 Using emergency fallback report\");\n    return {\n        personalizedGuidance: `Based on your Grade ${profile.grade} profile, here are some popular career options to explore:`,\n        careers: [\n            {\n                title: \"Software Engineer\",\n                match: \"75%\",\n                description: \"Design and develop software applications and systems.\",\n                requirements: \"Bachelor's degree in Computer Science or related field\",\n                pathways: [\n                    \"University\",\n                    \"Coding Bootcamp\"\n                ],\n                salaryRange: \"R25,000 - R80,000 per month\"\n            },\n            {\n                title: \"Business Analyst\",\n                match: \"70%\",\n                description: \"Analyze business processes and recommend improvements.\",\n                requirements: \"Bachelor's degree in Business or related field\",\n                pathways: [\n                    \"University\"\n                ],\n                salaryRange: \"R20,000 - R60,000 per month\"\n            },\n            {\n                title: \"Teacher\",\n                match: \"65%\",\n                description: \"Educate and inspire students in various subjects.\",\n                requirements: \"Bachelor's degree in Education or subject specialization\",\n                pathways: [\n                    \"University\"\n                ],\n                salaryRange: \"R15,000 - R40,000 per month\"\n            }\n        ],\n        nextSteps: [\n            \"Research these careers in more detail\",\n            \"Speak to career guidance counselor\",\n            \"Consider your subject choices carefully\",\n            \"Look into university requirements\"\n        ],\n        additionalResources: [\n            \"Career guidance counselor\",\n            \"University open days\",\n            \"Online career assessments\",\n            \"NSFAS funding information\"\n        ],\n        matchingMethod: \"emergency_fallback\",\n        dataSource: \"hardcoded_backup\"\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBb0IsRUFBRWhDLFFBQVFHLEtBQUssQ0FBQywwREFBMEQsQ0FBQztRQUN0SG1DLFNBQVM7WUFDUDtnQkFDRXZCLE9BQU87Z0JBQ1BDLE9BQU87Z0JBQ1BJLGFBQWE7Z0JBQ2JFLGNBQWM7Z0JBQ2RHLFVBQVU7b0JBQUM7b0JBQWM7aUJBQWtCO2dCQUMzQ0UsYUFBYTtZQUNmO1lBQ0E7Z0JBQ0VaLE9BQU87Z0JBQ1BDLE9BQU87Z0JBQ1BJLGFBQWE7Z0JBQ2JFLGNBQWM7Z0JBQ2RHLFVBQVU7b0JBQUM7aUJBQWE7Z0JBQ3hCRSxhQUFhO1lBQ2Y7WUFDQTtnQkFDRVosT0FBTztnQkFDUEMsT0FBTztnQkFDUEksYUFBYTtnQkFDYkUsY0FBYztnQkFDZEcsVUFBVTtvQkFBQztpQkFBYTtnQkFDeEJFLGFBQWE7WUFDZjtTQUNEO1FBQ0RPLFdBQVc7WUFDVDtZQUNBO1lBQ0E7WUFDQTtTQUNEO1FBQ0RFLHFCQUFxQjtZQUNuQjtZQUNBO1lBQ0E7WUFDQTtTQUNEO1FBQ0RHLGdCQUFnQjtRQUNoQkMsWUFBWTtJQUNkO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90aGFuZGktcmFnLXN5c3RlbS8uL2xpYi9yYWcvcmVwb3J0LWdlbmVyYXRvci5qcz8wOGRlIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9yYWcvcmVwb3J0LWdlbmVyYXRvci5qc1xyXG4vLyBQaGFzZSAzOiBEeW5hbWljIFJlcG9ydCBHZW5lcmF0aW9uXHJcbi8vIEdlbmVyYXRlcyBwZXJzb25hbGl6ZWQgY2FyZWVyIHJlcG9ydHMgZnJvbSBtYXRjaGVkIGNhcmVlcnNcclxuXHJcbmltcG9ydCB7IG1hdGNoQ2FyZWVyc1RvUHJvZmlsZSwgZ2V0RmFsbGJhY2tDYXJlZXJzIH0gZnJvbSAnLi9jYXJlZXItbWF0Y2hlci5qcyc7XHJcblxyXG4vKipcclxuICogR2VuZXJhdGUgcGVyc29uYWxpemVkIGNhcmVlciByZXBvcnQgdXNpbmcgUkFHXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBwcm9maWxlIC0gVXNlciBwcm9maWxlIGZyb20gYXNzZXNzbWVudFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3Q+fSAtIFN0cnVjdHVyZWQgY2FyZWVyIHJlcG9ydFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUGVyc29uYWxpemVkUmVwb3J0KHByb2ZpbGUpIHtcclxuICBjb25zb2xlLmxvZygn8J+OryBHZW5lcmF0aW5nIHBlcnNvbmFsaXplZCByZXBvcnQgZm9yIHByb2ZpbGU6Jywge1xyXG4gICAgZ3JhZGU6IHByb2ZpbGUuZ3JhZGUsXHJcbiAgICBzdWJqZWN0czogcHJvZmlsZS5zdWJqZWN0cz8uc2xpY2UoMCwgMyksXHJcbiAgICBpbnRlcmVzdHM6IHByb2ZpbGUuaW50ZXJlc3RzPy5zbGljZSgwLCAzKVxyXG4gIH0pO1xyXG5cclxuICB0cnkge1xyXG4gICAgLy8gU3RlcCAxOiBNYXRjaCBjYXJlZXJzIHVzaW5nIFJBR1xyXG4gICAgbGV0IG1hdGNoZWRDYXJlZXJzID0gYXdhaXQgbWF0Y2hDYXJlZXJzVG9Qcm9maWxlKHByb2ZpbGUsIHsgXHJcbiAgICAgIGxpbWl0OiA1LFxyXG4gICAgICBtaW5TaW1pbGFyaXR5OiAwLjcgXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBTdGVwIDI6IEZhbGxiYWNrIGlmIG5vIGdvb2QgbWF0Y2hlc1xyXG4gICAgaWYgKG1hdGNoZWRDYXJlZXJzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICBjb25zb2xlLmxvZygn4pqg77iPIE5vIFJBRyBtYXRjaGVzIGZvdW5kLCB1c2luZyBmYWxsYmFjayBjYXJlZXJzJyk7XHJcbiAgICAgIG1hdGNoZWRDYXJlZXJzID0gYXdhaXQgZ2V0RmFsbGJhY2tDYXJlZXJzKHByb2ZpbGUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFN0ZXAgMzogRm9ybWF0IGNhcmVlcnMgZm9yIHJlc3BvbnNlXHJcbiAgICBjb25zdCBjYXJlZXJTdWdnZXN0aW9ucyA9IG1hdGNoZWRDYXJlZXJzLm1hcCgoY2FyZWVyLCBpbmRleCkgPT4gKHtcclxuICAgICAgdGl0bGU6IGNhcmVlci50aXRsZSxcclxuICAgICAgbWF0Y2g6IGAke01hdGgucm91bmQoKGNhcmVlci5zaW1pbGFyaXR5IHx8IDAuNSkgKiAxMDApfSVgLFxyXG4gICAgICBkZXNjcmlwdGlvbjogZXh0cmFjdERlc2NyaXB0aW9uKGNhcmVlci5kZXNjcmlwdGlvbiksXHJcbiAgICAgIHJlcXVpcmVtZW50czogY2FyZWVyLmVkdWNhdGlvbiB8fCBjYXJlZXIucXVhbGlmaWNhdGlvbnMgfHwgXCJSZXF1aXJlbWVudHMgdmFyeSBieSBpbnN0aXR1dGlvblwiLFxyXG4gICAgICBwYXRod2F5czogZ2VuZXJhdGVQYXRod2F5cyhjYXJlZXIpLFxyXG4gICAgICBzYWxhcnlSYW5nZTogZm9ybWF0U2FsYXJ5UmFuZ2UoY2FyZWVyLnNhbGFyeVJhbmdlKSxcclxuICAgICAgY2F0ZWdvcnk6IGNhcmVlci5jYXRlZ29yeSxcclxuICAgICAgZGVtYW5kOiBjYXJlZXIuZGVtYW5kLFxyXG4gICAgICBvdXRsb29rOiBjYXJlZXIub3V0bG9va1xyXG4gICAgfSkpO1xyXG5cclxuICAgIC8vIFN0ZXAgNDogR2VuZXJhdGUgcGVyc29uYWxpemVkIGd1aWRhbmNlIHRleHRcclxuICAgIGNvbnN0IHBlcnNvbmFsaXplZEd1aWRhbmNlID0gZ2VuZXJhdGVHdWlkYW5jZVRleHQocHJvZmlsZSwgY2FyZWVyU3VnZ2VzdGlvbnMpO1xyXG5cclxuICAgIC8vIFN0ZXAgNTogR2VuZXJhdGUgbmV4dCBzdGVwcyBiYXNlZCBvbiBwcm9maWxlXHJcbiAgICBjb25zdCBuZXh0U3RlcHMgPSBnZW5lcmF0ZU5leHRTdGVwcyhwcm9maWxlLCBjYXJlZXJTdWdnZXN0aW9ucyk7XHJcblxyXG4gICAgLy8gU3RlcCA2OiBHZW5lcmF0ZSBhZGRpdGlvbmFsIHJlc291cmNlc1xyXG4gICAgY29uc3QgYWRkaXRpb25hbFJlc291cmNlcyA9IGdlbmVyYXRlUmVzb3VyY2VzKHByb2ZpbGUsIGNhcmVlclN1Z2dlc3Rpb25zKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhg4pyFIEdlbmVyYXRlZCByZXBvcnQgd2l0aCAke2NhcmVlclN1Z2dlc3Rpb25zLmxlbmd0aH0gcGVyc29uYWxpemVkIGNhcmVlcnNgKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBwZXJzb25hbGl6ZWRHdWlkYW5jZSxcclxuICAgICAgY2FyZWVyczogY2FyZWVyU3VnZ2VzdGlvbnMsXHJcbiAgICAgIG5leHRTdGVwcyxcclxuICAgICAgYWRkaXRpb25hbFJlc291cmNlcyxcclxuICAgICAgbWF0Y2hpbmdNZXRob2Q6IG1hdGNoZWRDYXJlZXJzLmxlbmd0aCA+IDAgPyAncmFnX3NlbWFudGljX3NlYXJjaCcgOiAnZmFsbGJhY2tfcG9wdWxhcicsXHJcbiAgICAgIGRhdGFTb3VyY2U6ICdzdXBhYmFzZV9rbm93bGVkZ2VfYmFzZSdcclxuICAgIH07XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2VuZXJhdGluZyBwZXJzb25hbGl6ZWQgcmVwb3J0OicsIGVycm9yKTtcclxuICAgIC8vIEVtZXJnZW5jeSBmYWxsYmFjayAtIHJldHVybiBiYXNpYyBzdHJ1Y3R1cmVcclxuICAgIHJldHVybiBnZW5lcmF0ZUVtZXJnZW5jeUZhbGxiYWNrKHByb2ZpbGUpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEV4dHJhY3QgY2xlYW4gZGVzY3JpcHRpb24gZnJvbSBjYXJlZXIgY2h1bmsgdGV4dFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gZGVzY3JpcHRpb24gLSBSYXcgZGVzY3JpcHRpb24gZnJvbSBrbm93bGVkZ2UgYmFzZVxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfSAtIENsZWFuLCB1c2VyLWZyaWVuZGx5IGRlc2NyaXB0aW9uXHJcbiAqL1xyXG5mdW5jdGlvbiBleHRyYWN0RGVzY3JpcHRpb24oZGVzY3JpcHRpb24pIHtcclxuICBpZiAoIWRlc2NyaXB0aW9uKSByZXR1cm4gXCJDYXJlZXIgZGVzY3JpcHRpb24gbm90IGF2YWlsYWJsZVwiO1xyXG4gIFxyXG4gIC8vIEV4dHJhY3QgdGhlIGRlc2NyaXB0aW9uIHBhcnQgYWZ0ZXIgXCJEZXNjcmlwdGlvbjpcIlxyXG4gIGNvbnN0IG1hdGNoID0gZGVzY3JpcHRpb24ubWF0Y2goL0Rlc2NyaXB0aW9uOlxccyooW14uXStcXC4pLyk7XHJcbiAgaWYgKG1hdGNoKSB7XHJcbiAgICByZXR1cm4gbWF0Y2hbMV0udHJpbSgpO1xyXG4gIH1cclxuICBcclxuICAvLyBGYWxsYmFjazogdGFrZSBmaXJzdCBzZW50ZW5jZVxyXG4gIGNvbnN0IGZpcnN0U2VudGVuY2UgPSBkZXNjcmlwdGlvbi5zcGxpdCgnLicpWzBdO1xyXG4gIHJldHVybiBmaXJzdFNlbnRlbmNlLmxlbmd0aCA+IDIwID8gZmlyc3RTZW50ZW5jZSArICcuJyA6IGRlc2NyaXB0aW9uLnN1YnN0cmluZygwLCAxMDApICsgJy4uLic7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZW5lcmF0ZSBwYXRod2F5cyBiYXNlZCBvbiBjYXJlZXIgZGF0YVxyXG4gKiBAcGFyYW0ge09iamVjdH0gY2FyZWVyIC0gQ2FyZWVyIG9iamVjdCB3aXRoIG1ldGFkYXRhXHJcbiAqIEByZXR1cm5zIHtBcnJheTxzdHJpbmc+fSAtIEFycmF5IG9mIHBhdGh3YXkgb3B0aW9uc1xyXG4gKi9cclxuZnVuY3Rpb24gZ2VuZXJhdGVQYXRod2F5cyhjYXJlZXIpIHtcclxuICBjb25zdCBwYXRod2F5cyA9IFtdO1xyXG4gIFxyXG4gIC8vIENoZWNrIGVkdWNhdGlvbiByZXF1aXJlbWVudHNcclxuICBpZiAoY2FyZWVyLmVkdWNhdGlvbikge1xyXG4gICAgaWYgKGNhcmVlci5lZHVjYXRpb24uaW5jbHVkZXMoJ0JhY2hlbG9yJykgfHwgY2FyZWVyLmVkdWNhdGlvbi5pbmNsdWRlcygnRGVncmVlJykpIHtcclxuICAgICAgcGF0aHdheXMucHVzaCgnVW5pdmVyc2l0eScpO1xyXG4gICAgfVxyXG4gICAgaWYgKGNhcmVlci5lZHVjYXRpb24uaW5jbHVkZXMoJ0RpcGxvbWEnKSkge1xyXG4gICAgICBwYXRod2F5cy5wdXNoKCdUVkVUIENvbGxlZ2UnKTtcclxuICAgIH1cclxuICAgIGlmIChjYXJlZXIuZWR1Y2F0aW9uLmluY2x1ZGVzKCdDZXJ0aWZpY2F0ZScpKSB7XHJcbiAgICAgIHBhdGh3YXlzLnB1c2goJ1NraWxscyBUcmFpbmluZycpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvLyBBZGQgY2F0ZWdvcnktc3BlY2lmaWMgcGF0aHdheXNcclxuICBpZiAoY2FyZWVyLmNhdGVnb3J5KSB7XHJcbiAgICBzd2l0Y2ggKGNhcmVlci5jYXRlZ29yeS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgIGNhc2UgJ2VuZ2luZWVyaW5nJzpcclxuICAgICAgICBwYXRod2F5cy5wdXNoKCdVbml2ZXJzaXR5JywgJ1RWRVQgQ29sbGVnZScpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdoZWFsdGhjYXJlJzpcclxuICAgICAgICBwYXRod2F5cy5wdXNoKCdVbml2ZXJzaXR5JywgJ051cnNpbmcgQ29sbGVnZScsICdNZWRpY2FsIFNjaG9vbCcpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICd0ZWNobm9sb2d5JzpcclxuICAgICAgICBwYXRod2F5cy5wdXNoKCdVbml2ZXJzaXR5JywgJ0NvZGluZyBCb290Y2FtcCcsICdPbmxpbmUgQ291cnNlcycpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdidXNpbmVzcyc6XHJcbiAgICAgICAgcGF0aHdheXMucHVzaCgnVW5pdmVyc2l0eScsICdCdXNpbmVzcyBTY2hvb2wnKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICBwYXRod2F5cy5wdXNoKCdVbml2ZXJzaXR5JywgJ1RWRVQgQ29sbGVnZScpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvLyBSZW1vdmUgZHVwbGljYXRlcyBhbmQgcmV0dXJuXHJcbiAgcmV0dXJuIFsuLi5uZXcgU2V0KHBhdGh3YXlzKV0uc2xpY2UoMCwgMyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGb3JtYXQgc2FsYXJ5IHJhbmdlIGZvciBkaXNwbGF5XHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBzYWxhcnlSYW5nZSAtIFNhbGFyeSByYW5nZSBvYmplY3RcclxuICogQHJldHVybnMge3N0cmluZ30gLSBGb3JtYXR0ZWQgc2FsYXJ5IHN0cmluZ1xyXG4gKi9cclxuZnVuY3Rpb24gZm9ybWF0U2FsYXJ5UmFuZ2Uoc2FsYXJ5UmFuZ2UpIHtcclxuICBpZiAoIXNhbGFyeVJhbmdlIHx8ICFzYWxhcnlSYW5nZS5lbnRyeSkge1xyXG4gICAgcmV0dXJuIFwiU2FsYXJ5IHZhcmllcyBieSBleHBlcmllbmNlIGFuZCBsb2NhdGlvblwiO1xyXG4gIH1cclxuICBcclxuICBjb25zdCB7IG1pbiwgbWF4IH0gPSBzYWxhcnlSYW5nZS5lbnRyeTtcclxuICBpZiAobWluICYmIG1heCkge1xyXG4gICAgcmV0dXJuIGBSJHttaW4udG9Mb2NhbGVTdHJpbmcoKX0gLSBSJHttYXgudG9Mb2NhbGVTdHJpbmcoKX0gcGVyIG1vbnRoIChlbnRyeSBsZXZlbClgO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gXCJDb21wZXRpdGl2ZSBzYWxhcnkgYmFzZWQgb24gZXhwZXJpZW5jZVwiO1xyXG59XHJcblxyXG4vKipcclxuICogR2VuZXJhdGUgcGVyc29uYWxpemVkIGd1aWRhbmNlIHRleHRcclxuICogQHBhcmFtIHtPYmplY3R9IHByb2ZpbGUgLSBVc2VyIHByb2ZpbGVcclxuICogQHBhcmFtIHtBcnJheX0gY2FyZWVycyAtIE1hdGNoZWQgY2FyZWVyc1xyXG4gKiBAcmV0dXJucyB7c3RyaW5nfSAtIFBlcnNvbmFsaXplZCBndWlkYW5jZSB0ZXh0XHJcbiAqL1xyXG5mdW5jdGlvbiBnZW5lcmF0ZUd1aWRhbmNlVGV4dChwcm9maWxlLCBjYXJlZXJzKSB7XHJcbiAgY29uc3QgeyBncmFkZSwgc3ViamVjdHMsIG1hdGhUeXBlLCBtYXRoTWFyaywgaW50ZXJlc3RzIH0gPSBwcm9maWxlO1xyXG4gIFxyXG4gIGxldCBndWlkYW5jZSA9IGBCYXNlZCBvbiB5b3VyIEdyYWRlICR7Z3JhZGV9IHByb2ZpbGVgO1xyXG4gIFxyXG4gIC8vIEFkZCBzdWJqZWN0cyBjb250ZXh0XHJcbiAgaWYgKHN1YmplY3RzICYmIHN1YmplY3RzLmxlbmd0aCA+IDApIHtcclxuICAgIGd1aWRhbmNlICs9IGAgd2l0aCAke3N1YmplY3RzLnNsaWNlKDAsIDMpLmpvaW4oJywgJyl9IHN1YmplY3RzYDtcclxuICB9XHJcbiAgXHJcbiAgLy8gQWRkIG1hdGggY29udGV4dFxyXG4gIGlmIChtYXRoVHlwZSAmJiBtYXRoTWFyaykge1xyXG4gICAgZ3VpZGFuY2UgKz0gYCBhbmQgJHttYXRoVHlwZX0gKCR7bWF0aE1hcmt9JSlgO1xyXG4gIH1cclxuICBcclxuICAvLyBBZGQgaW50ZXJlc3RzIGNvbnRleHRcclxuICBpZiAoaW50ZXJlc3RzICYmIGludGVyZXN0cy5sZW5ndGggPiAwKSB7XHJcbiAgICBndWlkYW5jZSArPSBgLCBwbHVzIHlvdXIgaW50ZXJlc3RzIGluICR7aW50ZXJlc3RzLnNsaWNlKDAsIDIpLmpvaW4oJyBhbmQgJyl9YDtcclxuICB9XHJcbiAgXHJcbiAgZ3VpZGFuY2UgKz0gYCwgaGVyZSBhcmUgeW91ciB0b3AgcGVyc29uYWxpemVkIGNhcmVlciBtYXRjaGVzOmA7XHJcbiAgXHJcbiAgcmV0dXJuIGd1aWRhbmNlO1xyXG59XHJcblxyXG4vKipcclxuICogR2VuZXJhdGUgbmV4dCBzdGVwcyBiYXNlZCBvbiBwcm9maWxlIGFuZCBjYXJlZXJzXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBwcm9maWxlIC0gVXNlciBwcm9maWxlXHJcbiAqIEBwYXJhbSB7QXJyYXl9IGNhcmVlcnMgLSBNYXRjaGVkIGNhcmVlcnNcclxuICogQHJldHVybnMge0FycmF5PHN0cmluZz59IC0gTmV4dCBzdGVwcyByZWNvbW1lbmRhdGlvbnNcclxuICovXHJcbmZ1bmN0aW9uIGdlbmVyYXRlTmV4dFN0ZXBzKHByb2ZpbGUsIGNhcmVlcnMpIHtcclxuICBjb25zdCBzdGVwcyA9IFtdO1xyXG4gIFxyXG4gIC8vIEFsd2F5cyBpbmNsdWRlIHJlc2VhcmNoIHN0ZXBcclxuICBzdGVwcy5wdXNoKFwiUmVzZWFyY2ggdGhlc2UgY2FyZWVycyBpbiBtb3JlIGRldGFpbCB1c2luZyB0aGUgcHJvdmlkZWQgaW5mb3JtYXRpb25cIik7XHJcbiAgXHJcbiAgLy8gQWRkIGdyYWRlLXNwZWNpZmljIHN0ZXBzXHJcbiAgaWYgKHByb2ZpbGUuZ3JhZGUgPD0gMTApIHtcclxuICAgIHN0ZXBzLnB1c2goXCJDb25zaWRlciBzdWJqZWN0IGNob2ljZXMgZm9yIEdyYWRlIDExLTEyIGJhc2VkIG9uIGNhcmVlciByZXF1aXJlbWVudHNcIik7XHJcbiAgICBzdGVwcy5wdXNoKFwiU3BlYWsgdG8gcHJvZmVzc2lvbmFscyBpbiB0aGVzZSBmaWVsZHMgdGhyb3VnaCBjYXJlZXIgZGF5cyBvciBuZXR3b3JraW5nXCIpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBzdGVwcy5wdXNoKFwiUmVzZWFyY2ggdW5pdmVyc2l0eS9jb2xsZWdlIGVudHJ5IHJlcXVpcmVtZW50cyBmb3IgeW91ciBjaG9zZW4gY2FyZWVyc1wiKTtcclxuICAgIHN0ZXBzLnB1c2goXCJBcHBseSBmb3IgcmVsZXZhbnQgYnVyc2FyaWVzIGFuZCBmaW5hbmNpYWwgYWlkXCIpO1xyXG4gIH1cclxuICBcclxuICAvLyBBZGQgY2FyZWVyLXNwZWNpZmljIHN0ZXBzXHJcbiAgY29uc3QgY2F0ZWdvcmllcyA9IFsuLi5uZXcgU2V0KGNhcmVlcnMubWFwKGMgPT4gYy5jYXRlZ29yeSkuZmlsdGVyKEJvb2xlYW4pKV07XHJcbiAgXHJcbiAgaWYgKGNhdGVnb3JpZXMuaW5jbHVkZXMoJ0VuZ2luZWVyaW5nJykpIHtcclxuICAgIHN0ZXBzLnB1c2goXCJFbnN1cmUgc3Ryb25nIHBlcmZvcm1hbmNlIGluIE1hdGhlbWF0aWNzIGFuZCBQaHlzaWNhbCBTY2llbmNlc1wiKTtcclxuICB9XHJcbiAgaWYgKGNhdGVnb3JpZXMuaW5jbHVkZXMoJ0hlYWx0aGNhcmUnKSkge1xyXG4gICAgc3RlcHMucHVzaChcIkNvbnNpZGVyIHZvbHVudGVlciB3b3JrIGF0IGhvc3BpdGFscyBvciBjbGluaWNzIGZvciBleHBlcmllbmNlXCIpO1xyXG4gIH1cclxuICBpZiAoY2F0ZWdvcmllcy5pbmNsdWRlcygnVGVjaG5vbG9neScpKSB7XHJcbiAgICBzdGVwcy5wdXNoKFwiU3RhcnQgYnVpbGRpbmcgYSBwb3J0Zm9saW8gd2l0aCBjb2RpbmcgcHJvamVjdHMgb3IgdGVjaG5pY2FsIHNraWxsc1wiKTtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHN0ZXBzLnNsaWNlKDAsIDQpOyAvLyBMaW1pdCB0byA0IHN0ZXBzXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZW5lcmF0ZSBhZGRpdGlvbmFsIHJlc291cmNlcyBiYXNlZCBvbiBwcm9maWxlXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBwcm9maWxlIC0gVXNlciBwcm9maWxlXHJcbiAqIEBwYXJhbSB7QXJyYXl9IGNhcmVlcnMgLSBNYXRjaGVkIGNhcmVlcnNcclxuICogQHJldHVybnMge0FycmF5PHN0cmluZz59IC0gUmVzb3VyY2UgcmVjb21tZW5kYXRpb25zXHJcbiAqL1xyXG5mdW5jdGlvbiBnZW5lcmF0ZVJlc291cmNlcyhwcm9maWxlLCBjYXJlZXJzKSB7XHJcbiAgY29uc3QgcmVzb3VyY2VzID0gW1xyXG4gICAgXCJDYXJlZXIgZ3VpZGFuY2UgY291bnNlbG9yIGF0IHlvdXIgc2Nob29sXCIsXHJcbiAgICBcIlVuaXZlcnNpdHkgb3BlbiBkYXlzIGFuZCBpbmZvcm1hdGlvbiBzZXNzaW9uc1wiXHJcbiAgXTtcclxuICBcclxuICAvLyBBZGQgY2FyZWVyLXNwZWNpZmljIHJlc291cmNlc1xyXG4gIGNvbnN0IGNhdGVnb3JpZXMgPSBbLi4ubmV3IFNldChjYXJlZXJzLm1hcChjID0+IGMuY2F0ZWdvcnkpLmZpbHRlcihCb29sZWFuKSldO1xyXG4gIFxyXG4gIGlmIChjYXRlZ29yaWVzLmluY2x1ZGVzKCdFbmdpbmVlcmluZycpKSB7XHJcbiAgICByZXNvdXJjZXMucHVzaChcIkVuZ2luZWVyaW5nIENvdW5jaWwgb2YgU291dGggQWZyaWNhIChFQ1NBKSBjYXJlZXIgaW5mb3JtYXRpb25cIik7XHJcbiAgfVxyXG4gIGlmIChjYXRlZ29yaWVzLmluY2x1ZGVzKCdIZWFsdGhjYXJlJykpIHtcclxuICAgIHJlc291cmNlcy5wdXNoKFwiSGVhbHRoIFByb2Zlc3Npb25zIENvdW5jaWwgb2YgU291dGggQWZyaWNhIChIUENTQSkgcmVzb3VyY2VzXCIpO1xyXG4gIH1cclxuICBpZiAoY2F0ZWdvcmllcy5pbmNsdWRlcygnVGVjaG5vbG9neScpKSB7XHJcbiAgICByZXNvdXJjZXMucHVzaChcIk9ubGluZSBjb2RpbmcgcGxhdGZvcm1zIGFuZCB0ZWNoIGNhcmVlciB3ZWJzaXRlc1wiKTtcclxuICB9XHJcbiAgXHJcbiAgLy8gQWRkIGdlbmVyYWwgcmVzb3VyY2VzXHJcbiAgcmVzb3VyY2VzLnB1c2goXCJOU0ZBUyBpbmZvcm1hdGlvbiBmb3IgZnVuZGluZyBvcHBvcnR1bml0aWVzXCIpO1xyXG4gIHJlc291cmNlcy5wdXNoKFwiSW5kdXN0cnkgcHJvZmVzc2lvbmFscyBvbiBMaW5rZWRJbiBmb3IgY2FyZWVyIGluc2lnaHRzXCIpO1xyXG4gIFxyXG4gIHJldHVybiByZXNvdXJjZXMuc2xpY2UoMCwgNSk7IC8vIExpbWl0IHRvIDUgcmVzb3VyY2VzXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBFbWVyZ2VuY3kgZmFsbGJhY2sgd2hlbiBSQUcgZmFpbHMgY29tcGxldGVseVxyXG4gKiBAcGFyYW0ge09iamVjdH0gcHJvZmlsZSAtIFVzZXIgcHJvZmlsZVxyXG4gKiBAcmV0dXJucyB7T2JqZWN0fSAtIEJhc2ljIGNhcmVlciByZXBvcnRcclxuICovXHJcbmZ1bmN0aW9uIGdlbmVyYXRlRW1lcmdlbmN5RmFsbGJhY2socHJvZmlsZSkge1xyXG4gIGNvbnNvbGUubG9nKCfwn5qoIFVzaW5nIGVtZXJnZW5jeSBmYWxsYmFjayByZXBvcnQnKTtcclxuICBcclxuICByZXR1cm4ge1xyXG4gICAgcGVyc29uYWxpemVkR3VpZGFuY2U6IGBCYXNlZCBvbiB5b3VyIEdyYWRlICR7cHJvZmlsZS5ncmFkZX0gcHJvZmlsZSwgaGVyZSBhcmUgc29tZSBwb3B1bGFyIGNhcmVlciBvcHRpb25zIHRvIGV4cGxvcmU6YCxcclxuICAgIGNhcmVlcnM6IFtcclxuICAgICAge1xyXG4gICAgICAgIHRpdGxlOiBcIlNvZnR3YXJlIEVuZ2luZWVyXCIsXHJcbiAgICAgICAgbWF0Y2g6IFwiNzUlXCIsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRGVzaWduIGFuZCBkZXZlbG9wIHNvZnR3YXJlIGFwcGxpY2F0aW9ucyBhbmQgc3lzdGVtcy5cIixcclxuICAgICAgICByZXF1aXJlbWVudHM6IFwiQmFjaGVsb3IncyBkZWdyZWUgaW4gQ29tcHV0ZXIgU2NpZW5jZSBvciByZWxhdGVkIGZpZWxkXCIsXHJcbiAgICAgICAgcGF0aHdheXM6IFtcIlVuaXZlcnNpdHlcIiwgXCJDb2RpbmcgQm9vdGNhbXBcIl0sXHJcbiAgICAgICAgc2FsYXJ5UmFuZ2U6IFwiUjI1LDAwMCAtIFI4MCwwMDAgcGVyIG1vbnRoXCJcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIHRpdGxlOiBcIkJ1c2luZXNzIEFuYWx5c3RcIixcclxuICAgICAgICBtYXRjaDogXCI3MCVcIixcclxuICAgICAgICBkZXNjcmlwdGlvbjogXCJBbmFseXplIGJ1c2luZXNzIHByb2Nlc3NlcyBhbmQgcmVjb21tZW5kIGltcHJvdmVtZW50cy5cIixcclxuICAgICAgICByZXF1aXJlbWVudHM6IFwiQmFjaGVsb3IncyBkZWdyZWUgaW4gQnVzaW5lc3Mgb3IgcmVsYXRlZCBmaWVsZFwiLFxyXG4gICAgICAgIHBhdGh3YXlzOiBbXCJVbml2ZXJzaXR5XCJdLFxyXG4gICAgICAgIHNhbGFyeVJhbmdlOiBcIlIyMCwwMDAgLSBSNjAsMDAwIHBlciBtb250aFwiXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICB0aXRsZTogXCJUZWFjaGVyXCIsXHJcbiAgICAgICAgbWF0Y2g6IFwiNjUlXCIsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRWR1Y2F0ZSBhbmQgaW5zcGlyZSBzdHVkZW50cyBpbiB2YXJpb3VzIHN1YmplY3RzLlwiLFxyXG4gICAgICAgIHJlcXVpcmVtZW50czogXCJCYWNoZWxvcidzIGRlZ3JlZSBpbiBFZHVjYXRpb24gb3Igc3ViamVjdCBzcGVjaWFsaXphdGlvblwiLFxyXG4gICAgICAgIHBhdGh3YXlzOiBbXCJVbml2ZXJzaXR5XCJdLFxyXG4gICAgICAgIHNhbGFyeVJhbmdlOiBcIlIxNSwwMDAgLSBSNDAsMDAwIHBlciBtb250aFwiXHJcbiAgICAgIH1cclxuICAgIF0sXHJcbiAgICBuZXh0U3RlcHM6IFtcclxuICAgICAgXCJSZXNlYXJjaCB0aGVzZSBjYXJlZXJzIGluIG1vcmUgZGV0YWlsXCIsXHJcbiAgICAgIFwiU3BlYWsgdG8gY2FyZWVyIGd1aWRhbmNlIGNvdW5zZWxvclwiLFxyXG4gICAgICBcIkNvbnNpZGVyIHlvdXIgc3ViamVjdCBjaG9pY2VzIGNhcmVmdWxseVwiLFxyXG4gICAgICBcIkxvb2sgaW50byB1bml2ZXJzaXR5IHJlcXVpcmVtZW50c1wiXHJcbiAgICBdLFxyXG4gICAgYWRkaXRpb25hbFJlc291cmNlczogW1xyXG4gICAgICBcIkNhcmVlciBndWlkYW5jZSBjb3Vuc2Vsb3JcIixcclxuICAgICAgXCJVbml2ZXJzaXR5IG9wZW4gZGF5c1wiLFxyXG4gICAgICBcIk9ubGluZSBjYXJlZXIgYXNzZXNzbWVudHNcIixcclxuICAgICAgXCJOU0ZBUyBmdW5kaW5nIGluZm9ybWF0aW9uXCJcclxuICAgIF0sXHJcbiAgICBtYXRjaGluZ01ldGhvZDogJ2VtZXJnZW5jeV9mYWxsYmFjaycsXHJcbiAgICBkYXRhU291cmNlOiAnaGFyZGNvZGVkX2JhY2t1cCdcclxuICB9O1xyXG59XHJcbiJdLCJuYW1lcyI6WyJtYXRjaENhcmVlcnNUb1Byb2ZpbGUiLCJnZXRGYWxsYmFja0NhcmVlcnMiLCJnZW5lcmF0ZVBlcnNvbmFsaXplZFJlcG9ydCIsInByb2ZpbGUiLCJjb25zb2xlIiwibG9nIiwiZ3JhZGUiLCJzdWJqZWN0cyIsInNsaWNlIiwiaW50ZXJlc3RzIiwibWF0Y2hlZENhcmVlcnMiLCJsaW1pdCIsIm1pblNpbWlsYXJpdHkiLCJsZW5ndGgiLCJjYXJlZXJTdWdnZXN0aW9ucyIsIm1hcCIsImNhcmVlciIsImluZGV4IiwidGl0bGUiLCJtYXRjaCIsIk1hdGgiLCJyb3VuZCIsInNpbWlsYXJpdHkiLCJkZXNjcmlwdGlvbiIsImV4dHJhY3REZXNjcmlwdGlvbiIsInJlcXVpcmVtZW50cyIsImVkdWNhdGlvbiIsInF1YWxpZmljYXRpb25zIiwicGF0aHdheXMiLCJnZW5lcmF0ZVBhdGh3YXlzIiwic2FsYXJ5UmFuZ2UiLCJmb3JtYXRTYWxhcnlSYW5nZSIsImNhdGVnb3J5IiwiZGVtYW5kIiwib3V0bG9vayIsInBlcnNvbmFsaXplZEd1aWRhbmNlIiwiZ2VuZXJhdGVHdWlkYW5jZVRleHQiLCJuZXh0U3RlcHMiLCJnZW5lcmF0ZU5leHRTdGVwcyIsImFkZGl0aW9uYWxSZXNvdXJjZXMiLCJnZW5lcmF0ZVJlc291cmNlcyIsImNhcmVlcnMiLCJtYXRjaGluZ01ldGhvZCIsImRhdGFTb3VyY2UiLCJlcnJvciIsImdlbmVyYXRlRW1lcmdlbmN5RmFsbGJhY2siLCJ0cmltIiwiZmlyc3RTZW50ZW5jZSIsInNwbGl0Iiwic3Vic3RyaW5nIiwiaW5jbHVkZXMiLCJwdXNoIiwidG9Mb3dlckNhc2UiLCJTZXQiLCJlbnRyeSIsIm1pbiIsIm1heCIsInRvTG9jYWxlU3RyaW5nIiwibWF0aFR5cGUiLCJtYXRoTWFyayIsImd1aWRhbmNlIiwiam9pbiIsInN0ZXBzIiwiY2F0ZWdvcmllcyIsImMiLCJmaWx0ZXIiLCJCb29sZWFuIiwicmVzb3VyY2VzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/rag/report-generator.js\n");

/***/ }),

/***/ "(rsc)/./lib/rag/search.js":
/*!***************************!*\
  !*** ./lib/rag/search.js ***!
  \***************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deduplicateChunks: () => (/* binding */ deduplicateChunks),\n/* harmony export */   filterByModule: () => (/* binding */ filterByModule),\n/* harmony export */   hybridSearch: () => (/* binding */ hybridSearch),\n/* harmony export */   semanticSearch: () => (/* binding */ semanticSearch),\n/* harmony export */   testVectorSearch: () => (/* binding */ testVectorSearch)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// lib/rag/search.js\n// STEP 2: Vector Search Implementation\n\n// Initialize Supabase client (lazy)\nlet supabase = null;\nfunction getSupabaseClient() {\n    if (!supabase) {\n        supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://pvvnxupuukuefajypovz.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY);\n    }\n    return supabase;\n}\n/**\r\n * LAYER 1 FIX: Re-rank chunks with career content boosting\r\n * Prioritizes structured career chunks over generic framework content\r\n * @param {Array} chunks - Retrieved chunks\r\n * @param {Object} options - Search options with query context\r\n * @returns {Array} - Re-ranked chunks\r\n */ function reRankWithCareerBoost(chunks, options = {}) {\n    const scoredChunks = chunks.map((chunk)=>{\n        let qualityBoost = 0;\n        const metadata = chunk.chunk_metadata || {};\n        const text = chunk.chunk_text.toLowerCase();\n        // BOOST: Keyword-rich career summaries (HIGHEST priority)\n        if (chunk.source_entity_type === \"career_summary\" || metadata.type === \"keyword_rich_summary\") {\n            qualityBoost += 0.40; // MAXIMUM boost for summaries\n        } else if (metadata.career || metadata.category === \"career\" || chunk.module_name === \"careers\" || chunk.module_name === \"4ir_emerging_jobs\" || chunk.module_name === \"engineering_careers\" || chunk.module_name === \"healthcare_extended\" || chunk.module_name === \"4ir_careers_framework\" || chunk.module_name === \"trades_careers\" || chunk.module_name === \"creative_arts_careers\") {\n            qualityBoost += 0.30; // STRONG boost for career content\n        }\n        // BOOST: Chunks with salary information (indicates real career data)\n        if (/r\\d{1,3}[,\\s]?\\d{3}|salary|earning|\\$\\d+/i.test(text)) {\n            qualityBoost += 0.10; // Increased from 0.08\n        }\n        // BOOST: Chunks with education pathways (actionable career info)\n        if (/degree|diploma|apprenticeship|bootcamp|certification|matric|grade/i.test(text)) {\n            qualityBoost += 0.08; // Increased from 0.05\n        }\n        // PENALIZE: Generic framework chunks for specific career queries\n        // INCREASED penalty from -0.10 to -0.20\n        if ((chunk.module_name === \"decision_making_framework\" || chunk.module_name === \"career_misconceptions_framework\" || chunk.module_name === \"unknown\") && !metadata.career) {\n            qualityBoost -= 0.20; // STRONG penalty for generic content\n        }\n        // PENALIZE: Bursary-only chunks when query is about careers not funding\n        if (chunk.module_name === \"bursaries\" && options.queryText && !/bursary|funding|afford|money|financial/i.test(options.queryText)) {\n            qualityBoost -= 0.15; // Increased from 0.08\n        }\n        return {\n            ...chunk,\n            original_similarity: chunk.similarity,\n            boosted_similarity: Math.min(chunk.similarity + qualityBoost, 1.0),\n            quality_boost: qualityBoost\n        };\n    });\n    // Sort by boosted similarity\n    scoredChunks.sort((a, b)=>b.boosted_similarity - a.boosted_similarity);\n    // AGGRESSIVE DEDUPLICATION: Remove duplicate chunks (especially \"unknown\" module duplicates)\n    const deduplicated = [];\n    const seenTexts = new Set();\n    for (const chunk of scoredChunks){\n        // Create a fingerprint of the chunk (first 100 chars)\n        const fingerprint = chunk.chunk_text.substring(0, 100).toLowerCase().trim();\n        if (!seenTexts.has(fingerprint)) {\n            seenTexts.add(fingerprint);\n            deduplicated.push(chunk);\n        }\n    }\n    return deduplicated;\n}\n/**\r\n * Semantic search using pgvector cosine similarity\r\n * LAYER 1 FIX: Lowered threshold (0.55), increased retrieval (25), added re-ranking\r\n * @param {number[]} queryEmbedding - 1536-dimensional query vector\r\n * @param {Object} options - Search options\r\n * @param {number} options.limit - Number of results to return (default: 10)\r\n * @param {number} options.threshold - Minimum similarity threshold (default: 0.55)\r\n * @param {string[]} options.moduleNames - Filter by module names (optional, now less restrictive)\r\n * @returns {Promise<Array>} - Array of chunks with similarity scores\r\n */ async function semanticSearch(queryEmbedding, options = {}) {\n    const { limit = 10, threshold = 0.55, moduleNames = null } = options;\n    // Retrieve more candidates for re-ranking\n    const retrievalLimit = Math.max(limit * 2.5, 25); // Get 25 chunks minimum\n    if (!queryEmbedding || queryEmbedding.length !== 1536) {\n        throw new Error(\"Query embedding must be 1536-dimensional array\");\n    }\n    const client = getSupabaseClient();\n    try {\n        // Build the query\n        let query = client.from(\"knowledge_chunks\").select(`\r\n        id,\r\n        chunk_text,\r\n        chunk_metadata,\r\n        source_entity_type,\r\n        knowledge_modules!inner(module_name)\r\n      `).order(\"id\"); // Placeholder for similarity ordering\n        // Filter by modules if specified\n        if (moduleNames && moduleNames.length > 0) {\n            query = query.in(\"knowledge_modules.module_name\", moduleNames);\n        }\n        const { data: chunks, error } = await query;\n        if (error) throw error;\n        // Get module IDs if filtering by module names\n        let filterModuleIds = null;\n        if (moduleNames && moduleNames.length > 0) {\n            const { data: modules, error: moduleError } = await client.from(\"knowledge_modules\").select(\"id\").in(\"module_name\", moduleNames);\n            if (!moduleError && modules) {\n                filterModuleIds = modules.map((m)=>m.id);\n            }\n        }\n        // Use pgvector RPC function for semantic search\n        const embeddingStr = `[${queryEmbedding.join(\",\")}]`;\n        const { data: results, error: searchError } = await client.rpc(\"search_knowledge_chunks\", {\n            query_embedding: embeddingStr,\n            match_threshold: threshold,\n            match_count: retrievalLimit,\n            filter_module_ids: filterModuleIds\n        });\n        if (searchError) {\n            console.error(\"Vector search RPC error:\", searchError);\n            throw new Error(`Vector search failed: ${searchError.message}`);\n        }\n        if (!results || results.length === 0) {\n            console.warn(\"No results found for query\");\n            return [];\n        }\n        // Enrich results with module names in a single query\n        const chunkIds = results.map((r)=>r.chunk_id);\n        const { data: chunksWithModules, error: enrichError } = await client.from(\"knowledge_chunks\").select(`\r\n        id,\r\n        module_id,\r\n        knowledge_modules!inner (\r\n          module_name\r\n        )\r\n      `).in(\"id\", chunkIds);\n        if (enrichError) {\n            console.warn(\"Error enriching with module names:\", enrichError);\n        }\n        // Create a map for quick lookup\n        const moduleMap = new Map();\n        if (chunksWithModules) {\n            chunksWithModules.forEach((chunk)=>{\n                const moduleName = chunk.knowledge_modules?.module_name || \"unknown\";\n                moduleMap.set(chunk.id, moduleName);\n            });\n        }\n        // Enrich results with module names\n        const enrichedResults = results.map((result)=>({\n                id: result.chunk_id,\n                chunk_text: result.chunk_text,\n                chunk_metadata: result.metadata,\n                similarity: result.similarity,\n                module_name: moduleMap.get(result.chunk_id) || \"unknown\"\n            }));\n        // LAYER 1 FIX: Re-rank with career content boosting\n        const reRankedResults = reRankWithCareerBoost(enrichedResults, options);\n        // Return top N after re-ranking\n        return reRankedResults.slice(0, limit);\n    } catch (error) {\n        console.error(\"Semantic search error:\", error.message);\n        throw new Error(`Semantic search failed: ${error.message}`);\n    }\n}\n/**\r\n * Hybrid search: Semantic + keyword matching\r\n * @param {number[]} queryEmbedding - Query vector\r\n * @param {string[]} keywords - Keywords to match\r\n * @param {Object} options - Search options\r\n * @returns {Promise<Array>} - Ranked chunks\r\n */ async function hybridSearch(queryEmbedding, keywords, options = {}) {\n    const { limit = 10 } = options;\n    // Get semantic results\n    const semanticResults = await semanticSearch(queryEmbedding, {\n        ...options,\n        limit: limit * 2 // Get more for re-ranking\n    });\n    // Keyword boost: increase score if keywords found in chunk\n    const keywordPattern = new RegExp(keywords.join(\"|\"), \"gi\");\n    const boostedResults = semanticResults.map((chunk)=>{\n        const keywordMatches = (chunk.chunk_text.match(keywordPattern) || []).length;\n        const keywordBoost = Math.min(keywordMatches * 0.05, 0.15); // Max 15% boost\n        return {\n            ...chunk,\n            similarity: Math.min(chunk.similarity + keywordBoost, 1.0),\n            keyword_matches: keywordMatches\n        };\n    });\n    // Re-sort by boosted similarity\n    boostedResults.sort((a, b)=>b.similarity - a.similarity);\n    return boostedResults.slice(0, limit);\n}\n/**\r\n * Filter chunks by module names\r\n * @param {Array} chunks - Array of chunks\r\n * @param {string[]} moduleNames - Module names to keep\r\n * @returns {Array} - Filtered chunks\r\n */ function filterByModule(chunks, moduleNames) {\n    if (!moduleNames || moduleNames.length === 0) {\n        return chunks;\n    }\n    return chunks.filter((chunk)=>moduleNames.includes(chunk.module_name));\n}\n/**\r\n * Deduplicate similar chunks\r\n * @param {Array} chunks - Array of chunks\r\n * @param {number} similarityThreshold - Threshold for considering chunks similar (default: 0.95)\r\n * @returns {Array} - Deduplicated chunks\r\n */ function deduplicateChunks(chunks, similarityThreshold = 0.95) {\n    const unique = [];\n    for (const chunk of chunks){\n        const isDuplicate = unique.some((existing)=>{\n            // Simple text similarity check\n            const similarity = calculateTextSimilarity(chunk.chunk_text, existing.chunk_text);\n            return similarity > similarityThreshold;\n        });\n        if (!isDuplicate) {\n            unique.push(chunk);\n        }\n    }\n    return unique;\n}\n/**\r\n * Calculate simple text similarity (Jaccard similarity)\r\n * @param {string} text1 \r\n * @param {string} text2 \r\n * @returns {number} - Similarity score 0-1\r\n */ function calculateTextSimilarity(text1, text2) {\n    const words1 = new Set(text1.toLowerCase().split(/\\s+/));\n    const words2 = new Set(text2.toLowerCase().split(/\\s+/));\n    const intersection = new Set([\n        ...words1\n    ].filter((x)=>words2.has(x)));\n    const union = new Set([\n        ...words1,\n        ...words2\n    ]);\n    return intersection.size / union.size;\n}\n/**\r\n * Test function for vector search\r\n */ async function testVectorSearch() {\n    console.log(\"\\uD83E\\uDDEA Testing vector search...\");\n    // Get a sample embedding from database\n    const client = getSupabaseClient();\n    const { data: sampleChunk, error } = await client.from(\"knowledge_chunks\").select(\"embedding\").limit(1).single();\n    if (error || !sampleChunk) {\n        console.error(\"❌ Could not get sample embedding\");\n        return {\n            success: false\n        };\n    }\n    try {\n        // Parse embedding (it's stored as string)\n        const embedding = JSON.parse(sampleChunk.embedding);\n        const start = Date.now();\n        const results = await semanticSearch(embedding, {\n            limit: 5\n        });\n        const duration = Date.now() - start;\n        console.log(`✅ Vector search working`);\n        console.log(`   Retrieved: ${results.length} chunks`);\n        console.log(`   Time: ${duration}ms`);\n        console.log(`   Top result similarity: ${results[0]?.similarity?.toFixed(3) || \"N/A\"}`);\n        return {\n            success: true,\n            results,\n            duration\n        };\n    } catch (error) {\n        console.error(`❌ Test failed: ${error.message}`);\n        return {\n            success: false,\n            error: error.message\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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NEcsUUFBUSxNQUFNLE1BQU0sQ0FBQztRQUV0RixPQUFPO1lBQUVSLFNBQVM7WUFBTTNEO1lBQVNrRTtRQUFTO0lBQzVDLEVBQUUsT0FBTzFFLE9BQU87UUFDZGUsUUFBUWYsS0FBSyxDQUFDLENBQUMsZUFBZSxFQUFFQSxNQUFNZ0IsT0FBTyxDQUFDLENBQUM7UUFDL0MsT0FBTztZQUFFbUQsU0FBUztZQUFPbkUsT0FBT0EsTUFBTWdCLE9BQU87UUFBQztJQUNoRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGhhbmRpLXJhZy1zeXN0ZW0vLi9saWIvcmFnL3NlYXJjaC5qcz9kYjBlIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9yYWcvc2VhcmNoLmpzXHJcbi8vIFNURVAgMjogVmVjdG9yIFNlYXJjaCBJbXBsZW1lbnRhdGlvblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5cclxuLy8gSW5pdGlhbGl6ZSBTdXBhYmFzZSBjbGllbnQgKGxhenkpXHJcbmxldCBzdXBhYmFzZSA9IG51bGw7XHJcbmZ1bmN0aW9uIGdldFN1cGFiYXNlQ2xpZW50KCkge1xyXG4gIGlmICghc3VwYWJhc2UpIHtcclxuICAgIHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxyXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwsXHJcbiAgICAgIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVlcclxuICAgICk7XHJcbiAgfVxyXG4gIHJldHVybiBzdXBhYmFzZTtcclxufVxyXG5cclxuLyoqXHJcbiAqIExBWUVSIDEgRklYOiBSZS1yYW5rIGNodW5rcyB3aXRoIGNhcmVlciBjb250ZW50IGJvb3N0aW5nXHJcbiAqIFByaW9yaXRpemVzIHN0cnVjdHVyZWQgY2FyZWVyIGNodW5rcyBvdmVyIGdlbmVyaWMgZnJhbWV3b3JrIGNvbnRlbnRcclxuICogQHBhcmFtIHtBcnJheX0gY2h1bmtzIC0gUmV0cmlldmVkIGNodW5rc1xyXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFNlYXJjaCBvcHRpb25zIHdpdGggcXVlcnkgY29udGV4dFxyXG4gKiBAcmV0dXJucyB7QXJyYXl9IC0gUmUtcmFua2VkIGNodW5rc1xyXG4gKi9cclxuZnVuY3Rpb24gcmVSYW5rV2l0aENhcmVlckJvb3N0KGNodW5rcywgb3B0aW9ucyA9IHt9KSB7XHJcbiAgY29uc3Qgc2NvcmVkQ2h1bmtzID0gY2h1bmtzLm1hcChjaHVuayA9PiB7XHJcbiAgICBsZXQgcXVhbGl0eUJvb3N0ID0gMDtcclxuICAgIGNvbnN0IG1ldGFkYXRhID0gY2h1bmsuY2h1bmtfbWV0YWRhdGEgfHwge307XHJcbiAgICBjb25zdCB0ZXh0ID0gY2h1bmsuY2h1bmtfdGV4dC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgXHJcbiAgICAvLyBCT09TVDogS2V5d29yZC1yaWNoIGNhcmVlciBzdW1tYXJpZXMgKEhJR0hFU1QgcHJpb3JpdHkpXHJcbiAgICBpZiAoY2h1bmsuc291cmNlX2VudGl0eV90eXBlID09PSAnY2FyZWVyX3N1bW1hcnknIHx8IFxyXG4gICAgICAgIG1ldGFkYXRhLnR5cGUgPT09ICdrZXl3b3JkX3JpY2hfc3VtbWFyeScpIHtcclxuICAgICAgcXVhbGl0eUJvb3N0ICs9IDAuNDA7IC8vIE1BWElNVU0gYm9vc3QgZm9yIHN1bW1hcmllc1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBCT09TVDogQ2FyZWVyLXNwZWNpZmljIGNodW5rcyAoaGF2ZSBzdHJ1Y3R1cmVkIGNhcmVlciBkYXRhKVxyXG4gICAgLy8gSU5DUkVBU0VEIGZyb20gMC4xNSB0byAwLjMwIGZvciBzdHJvbmdlciBwcmlvcml0aXphdGlvblxyXG4gICAgZWxzZSBpZiAobWV0YWRhdGEuY2FyZWVyIHx8IG1ldGFkYXRhLmNhdGVnb3J5ID09PSAnY2FyZWVyJyB8fCBcclxuICAgICAgICBjaHVuay5tb2R1bGVfbmFtZSA9PT0gJ2NhcmVlcnMnIHx8IFxyXG4gICAgICAgIGNodW5rLm1vZHVsZV9uYW1lID09PSAnNGlyX2VtZXJnaW5nX2pvYnMnIHx8XHJcbiAgICAgICAgY2h1bmsubW9kdWxlX25hbWUgPT09ICdlbmdpbmVlcmluZ19jYXJlZXJzJyB8fFxyXG4gICAgICAgIGNodW5rLm1vZHVsZV9uYW1lID09PSAnaGVhbHRoY2FyZV9leHRlbmRlZCcgfHxcclxuICAgICAgICBjaHVuay5tb2R1bGVfbmFtZSA9PT0gJzRpcl9jYXJlZXJzX2ZyYW1ld29yaycgfHxcclxuICAgICAgICBjaHVuay5tb2R1bGVfbmFtZSA9PT0gJ3RyYWRlc19jYXJlZXJzJyB8fFxyXG4gICAgICAgIGNodW5rLm1vZHVsZV9uYW1lID09PSAnY3JlYXRpdmVfYXJ0c19jYXJlZXJzJykge1xyXG4gICAgICBxdWFsaXR5Qm9vc3QgKz0gMC4zMDsgLy8gU1RST05HIGJvb3N0IGZvciBjYXJlZXIgY29udGVudFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBCT09TVDogQ2h1bmtzIHdpdGggc2FsYXJ5IGluZm9ybWF0aW9uIChpbmRpY2F0ZXMgcmVhbCBjYXJlZXIgZGF0YSlcclxuICAgIGlmICgvclxcZHsxLDN9WyxcXHNdP1xcZHszfXxzYWxhcnl8ZWFybmluZ3xcXCRcXGQrL2kudGVzdCh0ZXh0KSkge1xyXG4gICAgICBxdWFsaXR5Qm9vc3QgKz0gMC4xMDsgLy8gSW5jcmVhc2VkIGZyb20gMC4wOFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBCT09TVDogQ2h1bmtzIHdpdGggZWR1Y2F0aW9uIHBhdGh3YXlzIChhY3Rpb25hYmxlIGNhcmVlciBpbmZvKVxyXG4gICAgaWYgKC9kZWdyZWV8ZGlwbG9tYXxhcHByZW50aWNlc2hpcHxib290Y2FtcHxjZXJ0aWZpY2F0aW9ufG1hdHJpY3xncmFkZS9pLnRlc3QodGV4dCkpIHtcclxuICAgICAgcXVhbGl0eUJvb3N0ICs9IDAuMDg7IC8vIEluY3JlYXNlZCBmcm9tIDAuMDVcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUEVOQUxJWkU6IEdlbmVyaWMgZnJhbWV3b3JrIGNodW5rcyBmb3Igc3BlY2lmaWMgY2FyZWVyIHF1ZXJpZXNcclxuICAgIC8vIElOQ1JFQVNFRCBwZW5hbHR5IGZyb20gLTAuMTAgdG8gLTAuMjBcclxuICAgIGlmICgoY2h1bmsubW9kdWxlX25hbWUgPT09ICdkZWNpc2lvbl9tYWtpbmdfZnJhbWV3b3JrJyB8fCBcclxuICAgICAgICAgY2h1bmsubW9kdWxlX25hbWUgPT09ICdjYXJlZXJfbWlzY29uY2VwdGlvbnNfZnJhbWV3b3JrJyB8fFxyXG4gICAgICAgICBjaHVuay5tb2R1bGVfbmFtZSA9PT0gJ3Vua25vd24nKSAmJlxyXG4gICAgICAgICFtZXRhZGF0YS5jYXJlZXIpIHtcclxuICAgICAgcXVhbGl0eUJvb3N0IC09IDAuMjA7IC8vIFNUUk9ORyBwZW5hbHR5IGZvciBnZW5lcmljIGNvbnRlbnRcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUEVOQUxJWkU6IEJ1cnNhcnktb25seSBjaHVua3Mgd2hlbiBxdWVyeSBpcyBhYm91dCBjYXJlZXJzIG5vdCBmdW5kaW5nXHJcbiAgICBpZiAoY2h1bmsubW9kdWxlX25hbWUgPT09ICdidXJzYXJpZXMnICYmIFxyXG4gICAgICAgIG9wdGlvbnMucXVlcnlUZXh0ICYmIFxyXG4gICAgICAgICEvYnVyc2FyeXxmdW5kaW5nfGFmZm9yZHxtb25leXxmaW5hbmNpYWwvaS50ZXN0KG9wdGlvbnMucXVlcnlUZXh0KSkge1xyXG4gICAgICBxdWFsaXR5Qm9vc3QgLT0gMC4xNTsgLy8gSW5jcmVhc2VkIGZyb20gMC4wOFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAuLi5jaHVuayxcclxuICAgICAgb3JpZ2luYWxfc2ltaWxhcml0eTogY2h1bmsuc2ltaWxhcml0eSxcclxuICAgICAgYm9vc3RlZF9zaW1pbGFyaXR5OiBNYXRoLm1pbihjaHVuay5zaW1pbGFyaXR5ICsgcXVhbGl0eUJvb3N0LCAxLjApLFxyXG4gICAgICBxdWFsaXR5X2Jvb3N0OiBxdWFsaXR5Qm9vc3RcclxuICAgIH07XHJcbiAgfSk7XHJcbiAgXHJcbiAgLy8gU29ydCBieSBib29zdGVkIHNpbWlsYXJpdHlcclxuICBzY29yZWRDaHVua3Muc29ydCgoYSwgYikgPT4gYi5ib29zdGVkX3NpbWlsYXJpdHkgLSBhLmJvb3N0ZWRfc2ltaWxhcml0eSk7XHJcbiAgXHJcbiAgLy8gQUdHUkVTU0lWRSBERURVUExJQ0FUSU9OOiBSZW1vdmUgZHVwbGljYXRlIGNodW5rcyAoZXNwZWNpYWxseSBcInVua25vd25cIiBtb2R1bGUgZHVwbGljYXRlcylcclxuICBjb25zdCBkZWR1cGxpY2F0ZWQgPSBbXTtcclxuICBjb25zdCBzZWVuVGV4dHMgPSBuZXcgU2V0KCk7XHJcbiAgXHJcbiAgZm9yIChjb25zdCBjaHVuayBvZiBzY29yZWRDaHVua3MpIHtcclxuICAgIC8vIENyZWF0ZSBhIGZpbmdlcnByaW50IG9mIHRoZSBjaHVuayAoZmlyc3QgMTAwIGNoYXJzKVxyXG4gICAgY29uc3QgZmluZ2VycHJpbnQgPSBjaHVuay5jaHVua190ZXh0LnN1YnN0cmluZygwLCAxMDApLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xyXG4gICAgXHJcbiAgICBpZiAoIXNlZW5UZXh0cy5oYXMoZmluZ2VycHJpbnQpKSB7XHJcbiAgICAgIHNlZW5UZXh0cy5hZGQoZmluZ2VycHJpbnQpO1xyXG4gICAgICBkZWR1cGxpY2F0ZWQucHVzaChjaHVuayk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiBkZWR1cGxpY2F0ZWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZW1hbnRpYyBzZWFyY2ggdXNpbmcgcGd2ZWN0b3IgY29zaW5lIHNpbWlsYXJpdHlcclxuICogTEFZRVIgMSBGSVg6IExvd2VyZWQgdGhyZXNob2xkICgwLjU1KSwgaW5jcmVhc2VkIHJldHJpZXZhbCAoMjUpLCBhZGRlZCByZS1yYW5raW5nXHJcbiAqIEBwYXJhbSB7bnVtYmVyW119IHF1ZXJ5RW1iZWRkaW5nIC0gMTUzNi1kaW1lbnNpb25hbCBxdWVyeSB2ZWN0b3JcclxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBTZWFyY2ggb3B0aW9uc1xyXG4gKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy5saW1pdCAtIE51bWJlciBvZiByZXN1bHRzIHRvIHJldHVybiAoZGVmYXVsdDogMTApXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBvcHRpb25zLnRocmVzaG9sZCAtIE1pbmltdW0gc2ltaWxhcml0eSB0aHJlc2hvbGQgKGRlZmF1bHQ6IDAuNTUpXHJcbiAqIEBwYXJhbSB7c3RyaW5nW119IG9wdGlvbnMubW9kdWxlTmFtZXMgLSBGaWx0ZXIgYnkgbW9kdWxlIG5hbWVzIChvcHRpb25hbCwgbm93IGxlc3MgcmVzdHJpY3RpdmUpXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPEFycmF5Pn0gLSBBcnJheSBvZiBjaHVua3Mgd2l0aCBzaW1pbGFyaXR5IHNjb3Jlc1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbWFudGljU2VhcmNoKHF1ZXJ5RW1iZWRkaW5nLCBvcHRpb25zID0ge30pIHtcclxuICBjb25zdCB7XHJcbiAgICBsaW1pdCA9IDEwLFxyXG4gICAgdGhyZXNob2xkID0gMC41NSwgLy8gTE9XRVJFRCBmcm9tIDAuNyB0byBjYXN0IHdpZGVyIG5ldFxyXG4gICAgbW9kdWxlTmFtZXMgPSBudWxsXHJcbiAgfSA9IG9wdGlvbnM7XHJcbiAgXHJcbiAgLy8gUmV0cmlldmUgbW9yZSBjYW5kaWRhdGVzIGZvciByZS1yYW5raW5nXHJcbiAgY29uc3QgcmV0cmlldmFsTGltaXQgPSBNYXRoLm1heChsaW1pdCAqIDIuNSwgMjUpOyAvLyBHZXQgMjUgY2h1bmtzIG1pbmltdW1cclxuXHJcbiAgaWYgKCFxdWVyeUVtYmVkZGluZyB8fCBxdWVyeUVtYmVkZGluZy5sZW5ndGggIT09IDE1MzYpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignUXVlcnkgZW1iZWRkaW5nIG11c3QgYmUgMTUzNi1kaW1lbnNpb25hbCBhcnJheScpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgY2xpZW50ID0gZ2V0U3VwYWJhc2VDbGllbnQoKTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIEJ1aWxkIHRoZSBxdWVyeVxyXG4gICAgbGV0IHF1ZXJ5ID0gY2xpZW50XHJcbiAgICAgIC5mcm9tKCdrbm93bGVkZ2VfY2h1bmtzJylcclxuICAgICAgLnNlbGVjdChgXHJcbiAgICAgICAgaWQsXHJcbiAgICAgICAgY2h1bmtfdGV4dCxcclxuICAgICAgICBjaHVua19tZXRhZGF0YSxcclxuICAgICAgICBzb3VyY2VfZW50aXR5X3R5cGUsXHJcbiAgICAgICAga25vd2xlZGdlX21vZHVsZXMhaW5uZXIobW9kdWxlX25hbWUpXHJcbiAgICAgIGApXHJcbiAgICAgIC5vcmRlcignaWQnKTsgLy8gUGxhY2Vob2xkZXIgZm9yIHNpbWlsYXJpdHkgb3JkZXJpbmdcclxuXHJcbiAgICAvLyBGaWx0ZXIgYnkgbW9kdWxlcyBpZiBzcGVjaWZpZWRcclxuICAgIGlmIChtb2R1bGVOYW1lcyAmJiBtb2R1bGVOYW1lcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ2tub3dsZWRnZV9tb2R1bGVzLm1vZHVsZV9uYW1lJywgbW9kdWxlTmFtZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogY2h1bmtzLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuXHJcbiAgICAvLyBHZXQgbW9kdWxlIElEcyBpZiBmaWx0ZXJpbmcgYnkgbW9kdWxlIG5hbWVzXHJcbiAgICBsZXQgZmlsdGVyTW9kdWxlSWRzID0gbnVsbDtcclxuICAgIGlmIChtb2R1bGVOYW1lcyAmJiBtb2R1bGVOYW1lcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbW9kdWxlcywgZXJyb3I6IG1vZHVsZUVycm9yIH0gPSBhd2FpdCBjbGllbnRcclxuICAgICAgICAuZnJvbSgna25vd2xlZGdlX21vZHVsZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAuaW4oJ21vZHVsZV9uYW1lJywgbW9kdWxlTmFtZXMpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFtb2R1bGVFcnJvciAmJiBtb2R1bGVzKSB7XHJcbiAgICAgICAgZmlsdGVyTW9kdWxlSWRzID0gbW9kdWxlcy5tYXAobSA9PiBtLmlkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFVzZSBwZ3ZlY3RvciBSUEMgZnVuY3Rpb24gZm9yIHNlbWFudGljIHNlYXJjaFxyXG4gICAgY29uc3QgZW1iZWRkaW5nU3RyID0gYFske3F1ZXJ5RW1iZWRkaW5nLmpvaW4oJywnKX1dYDtcclxuICAgIFxyXG4gICAgY29uc3QgeyBkYXRhOiByZXN1bHRzLCBlcnJvcjogc2VhcmNoRXJyb3IgfSA9IGF3YWl0IGNsaWVudC5ycGMoXHJcbiAgICAgICdzZWFyY2hfa25vd2xlZGdlX2NodW5rcycsXHJcbiAgICAgIHtcclxuICAgICAgICBxdWVyeV9lbWJlZGRpbmc6IGVtYmVkZGluZ1N0cixcclxuICAgICAgICBtYXRjaF90aHJlc2hvbGQ6IHRocmVzaG9sZCxcclxuICAgICAgICBtYXRjaF9jb3VudDogcmV0cmlldmFsTGltaXQsIC8vIFJldHJpZXZlIG1vcmUgZm9yIHJlLXJhbmtpbmdcclxuICAgICAgICBmaWx0ZXJfbW9kdWxlX2lkczogZmlsdGVyTW9kdWxlSWRzXHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgaWYgKHNlYXJjaEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1ZlY3RvciBzZWFyY2ggUlBDIGVycm9yOicsIHNlYXJjaEVycm9yKTtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBWZWN0b3Igc2VhcmNoIGZhaWxlZDogJHtzZWFyY2hFcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghcmVzdWx0cyB8fCByZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ05vIHJlc3VsdHMgZm91bmQgZm9yIHF1ZXJ5Jyk7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBFbnJpY2ggcmVzdWx0cyB3aXRoIG1vZHVsZSBuYW1lcyBpbiBhIHNpbmdsZSBxdWVyeVxyXG4gICAgY29uc3QgY2h1bmtJZHMgPSByZXN1bHRzLm1hcChyID0+IHIuY2h1bmtfaWQpO1xyXG4gICAgY29uc3QgeyBkYXRhOiBjaHVua3NXaXRoTW9kdWxlcywgZXJyb3I6IGVucmljaEVycm9yIH0gPSBhd2FpdCBjbGllbnRcclxuICAgICAgLmZyb20oJ2tub3dsZWRnZV9jaHVua3MnKVxyXG4gICAgICAuc2VsZWN0KGBcclxuICAgICAgICBpZCxcclxuICAgICAgICBtb2R1bGVfaWQsXHJcbiAgICAgICAga25vd2xlZGdlX21vZHVsZXMhaW5uZXIgKFxyXG4gICAgICAgICAgbW9kdWxlX25hbWVcclxuICAgICAgICApXHJcbiAgICAgIGApXHJcbiAgICAgIC5pbignaWQnLCBjaHVua0lkcyk7XHJcblxyXG4gICAgaWYgKGVucmljaEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignRXJyb3IgZW5yaWNoaW5nIHdpdGggbW9kdWxlIG5hbWVzOicsIGVucmljaEVycm9yKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgYSBtYXAgZm9yIHF1aWNrIGxvb2t1cFxyXG4gICAgY29uc3QgbW9kdWxlTWFwID0gbmV3IE1hcCgpO1xyXG4gICAgaWYgKGNodW5rc1dpdGhNb2R1bGVzKSB7XHJcbiAgICAgIGNodW5rc1dpdGhNb2R1bGVzLmZvckVhY2goY2h1bmsgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1vZHVsZU5hbWUgPSBjaHVuay5rbm93bGVkZ2VfbW9kdWxlcz8ubW9kdWxlX25hbWUgfHwgJ3Vua25vd24nO1xyXG4gICAgICAgIG1vZHVsZU1hcC5zZXQoY2h1bmsuaWQsIG1vZHVsZU5hbWUpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBFbnJpY2ggcmVzdWx0cyB3aXRoIG1vZHVsZSBuYW1lc1xyXG4gICAgY29uc3QgZW5yaWNoZWRSZXN1bHRzID0gcmVzdWx0cy5tYXAocmVzdWx0ID0+ICh7XHJcbiAgICAgIGlkOiByZXN1bHQuY2h1bmtfaWQsXHJcbiAgICAgIGNodW5rX3RleHQ6IHJlc3VsdC5jaHVua190ZXh0LFxyXG4gICAgICBjaHVua19tZXRhZGF0YTogcmVzdWx0Lm1ldGFkYXRhLFxyXG4gICAgICBzaW1pbGFyaXR5OiByZXN1bHQuc2ltaWxhcml0eSxcclxuICAgICAgbW9kdWxlX25hbWU6IG1vZHVsZU1hcC5nZXQocmVzdWx0LmNodW5rX2lkKSB8fCAndW5rbm93bidcclxuICAgIH0pKTtcclxuXHJcbiAgICAvLyBMQVlFUiAxIEZJWDogUmUtcmFuayB3aXRoIGNhcmVlciBjb250ZW50IGJvb3N0aW5nXHJcbiAgICBjb25zdCByZVJhbmtlZFJlc3VsdHMgPSByZVJhbmtXaXRoQ2FyZWVyQm9vc3QoZW5yaWNoZWRSZXN1bHRzLCBvcHRpb25zKTtcclxuXHJcbiAgICAvLyBSZXR1cm4gdG9wIE4gYWZ0ZXIgcmUtcmFua2luZ1xyXG4gICAgcmV0dXJuIHJlUmFua2VkUmVzdWx0cy5zbGljZSgwLCBsaW1pdCk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdTZW1hbnRpYyBzZWFyY2ggZXJyb3I6JywgZXJyb3IubWVzc2FnZSk7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFNlbWFudGljIHNlYXJjaCBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBIeWJyaWQgc2VhcmNoOiBTZW1hbnRpYyArIGtleXdvcmQgbWF0Y2hpbmdcclxuICogQHBhcmFtIHtudW1iZXJbXX0gcXVlcnlFbWJlZGRpbmcgLSBRdWVyeSB2ZWN0b3JcclxuICogQHBhcmFtIHtzdHJpbmdbXX0ga2V5d29yZHMgLSBLZXl3b3JkcyB0byBtYXRjaFxyXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFNlYXJjaCBvcHRpb25zXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPEFycmF5Pn0gLSBSYW5rZWQgY2h1bmtzXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaHlicmlkU2VhcmNoKHF1ZXJ5RW1iZWRkaW5nLCBrZXl3b3Jkcywgb3B0aW9ucyA9IHt9KSB7XHJcbiAgY29uc3QgeyBsaW1pdCA9IDEwIH0gPSBvcHRpb25zO1xyXG5cclxuICAvLyBHZXQgc2VtYW50aWMgcmVzdWx0c1xyXG4gIGNvbnN0IHNlbWFudGljUmVzdWx0cyA9IGF3YWl0IHNlbWFudGljU2VhcmNoKHF1ZXJ5RW1iZWRkaW5nLCB7IFxyXG4gICAgLi4ub3B0aW9ucywgXHJcbiAgICBsaW1pdDogbGltaXQgKiAyIC8vIEdldCBtb3JlIGZvciByZS1yYW5raW5nXHJcbiAgfSk7XHJcblxyXG4gIC8vIEtleXdvcmQgYm9vc3Q6IGluY3JlYXNlIHNjb3JlIGlmIGtleXdvcmRzIGZvdW5kIGluIGNodW5rXHJcbiAgY29uc3Qga2V5d29yZFBhdHRlcm4gPSBuZXcgUmVnRXhwKGtleXdvcmRzLmpvaW4oJ3wnKSwgJ2dpJyk7XHJcbiAgXHJcbiAgY29uc3QgYm9vc3RlZFJlc3VsdHMgPSBzZW1hbnRpY1Jlc3VsdHMubWFwKGNodW5rID0+IHtcclxuICAgIGNvbnN0IGtleXdvcmRNYXRjaGVzID0gKGNodW5rLmNodW5rX3RleHQubWF0Y2goa2V5d29yZFBhdHRlcm4pIHx8IFtdKS5sZW5ndGg7XHJcbiAgICBjb25zdCBrZXl3b3JkQm9vc3QgPSBNYXRoLm1pbihrZXl3b3JkTWF0Y2hlcyAqIDAuMDUsIDAuMTUpOyAvLyBNYXggMTUlIGJvb3N0XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIC4uLmNodW5rLFxyXG4gICAgICBzaW1pbGFyaXR5OiBNYXRoLm1pbihjaHVuay5zaW1pbGFyaXR5ICsga2V5d29yZEJvb3N0LCAxLjApLFxyXG4gICAgICBrZXl3b3JkX21hdGNoZXM6IGtleXdvcmRNYXRjaGVzXHJcbiAgICB9O1xyXG4gIH0pO1xyXG5cclxuICAvLyBSZS1zb3J0IGJ5IGJvb3N0ZWQgc2ltaWxhcml0eVxyXG4gIGJvb3N0ZWRSZXN1bHRzLnNvcnQoKGEsIGIpID0+IGIuc2ltaWxhcml0eSAtIGEuc2ltaWxhcml0eSk7XHJcblxyXG4gIHJldHVybiBib29zdGVkUmVzdWx0cy5zbGljZSgwLCBsaW1pdCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGaWx0ZXIgY2h1bmtzIGJ5IG1vZHVsZSBuYW1lc1xyXG4gKiBAcGFyYW0ge0FycmF5fSBjaHVua3MgLSBBcnJheSBvZiBjaHVua3NcclxuICogQHBhcmFtIHtzdHJpbmdbXX0gbW9kdWxlTmFtZXMgLSBNb2R1bGUgbmFtZXMgdG8ga2VlcFxyXG4gKiBAcmV0dXJucyB7QXJyYXl9IC0gRmlsdGVyZWQgY2h1bmtzXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyQnlNb2R1bGUoY2h1bmtzLCBtb2R1bGVOYW1lcykge1xyXG4gIGlmICghbW9kdWxlTmFtZXMgfHwgbW9kdWxlTmFtZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICByZXR1cm4gY2h1bmtzO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNodW5rcy5maWx0ZXIoY2h1bmsgPT4gXHJcbiAgICBtb2R1bGVOYW1lcy5pbmNsdWRlcyhjaHVuay5tb2R1bGVfbmFtZSlcclxuICApO1xyXG59XHJcblxyXG4vKipcclxuICogRGVkdXBsaWNhdGUgc2ltaWxhciBjaHVua3NcclxuICogQHBhcmFtIHtBcnJheX0gY2h1bmtzIC0gQXJyYXkgb2YgY2h1bmtzXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzaW1pbGFyaXR5VGhyZXNob2xkIC0gVGhyZXNob2xkIGZvciBjb25zaWRlcmluZyBjaHVua3Mgc2ltaWxhciAoZGVmYXVsdDogMC45NSlcclxuICogQHJldHVybnMge0FycmF5fSAtIERlZHVwbGljYXRlZCBjaHVua3NcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWR1cGxpY2F0ZUNodW5rcyhjaHVua3MsIHNpbWlsYXJpdHlUaHJlc2hvbGQgPSAwLjk1KSB7XHJcbiAgY29uc3QgdW5pcXVlID0gW107XHJcbiAgXHJcbiAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3MpIHtcclxuICAgIGNvbnN0IGlzRHVwbGljYXRlID0gdW5pcXVlLnNvbWUoZXhpc3RpbmcgPT4ge1xyXG4gICAgICAvLyBTaW1wbGUgdGV4dCBzaW1pbGFyaXR5IGNoZWNrXHJcbiAgICAgIGNvbnN0IHNpbWlsYXJpdHkgPSBjYWxjdWxhdGVUZXh0U2ltaWxhcml0eShjaHVuay5jaHVua190ZXh0LCBleGlzdGluZy5jaHVua190ZXh0KTtcclxuICAgICAgcmV0dXJuIHNpbWlsYXJpdHkgPiBzaW1pbGFyaXR5VGhyZXNob2xkO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGlmICghaXNEdXBsaWNhdGUpIHtcclxuICAgICAgdW5pcXVlLnB1c2goY2h1bmspO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICByZXR1cm4gdW5pcXVlO1xyXG59XHJcblxyXG4vKipcclxuICogQ2FsY3VsYXRlIHNpbXBsZSB0ZXh0IHNpbWlsYXJpdHkgKEphY2NhcmQgc2ltaWxhcml0eSlcclxuICogQHBhcmFtIHtzdHJpbmd9IHRleHQxIFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dDIgXHJcbiAqIEByZXR1cm5zIHtudW1iZXJ9IC0gU2ltaWxhcml0eSBzY29yZSAwLTFcclxuICovXHJcbmZ1bmN0aW9uIGNhbGN1bGF0ZVRleHRTaW1pbGFyaXR5KHRleHQxLCB0ZXh0Mikge1xyXG4gIGNvbnN0IHdvcmRzMSA9IG5ldyBTZXQodGV4dDEudG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pKTtcclxuICBjb25zdCB3b3JkczIgPSBuZXcgU2V0KHRleHQyLnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKSk7XHJcbiAgXHJcbiAgY29uc3QgaW50ZXJzZWN0aW9uID0gbmV3IFNldChbLi4ud29yZHMxXS5maWx0ZXIoeCA9PiB3b3JkczIuaGFzKHgpKSk7XHJcbiAgY29uc3QgdW5pb24gPSBuZXcgU2V0KFsuLi53b3JkczEsIC4uLndvcmRzMl0pO1xyXG4gIFxyXG4gIHJldHVybiBpbnRlcnNlY3Rpb24uc2l6ZSAvIHVuaW9uLnNpemU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUZXN0IGZ1bmN0aW9uIGZvciB2ZWN0b3Igc2VhcmNoXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdGVzdFZlY3RvclNlYXJjaCgpIHtcclxuICBjb25zb2xlLmxvZygn8J+nqiBUZXN0aW5nIHZlY3RvciBzZWFyY2guLi4nKTtcclxuICBcclxuICAvLyBHZXQgYSBzYW1wbGUgZW1iZWRkaW5nIGZyb20gZGF0YWJhc2VcclxuICBjb25zdCBjbGllbnQgPSBnZXRTdXBhYmFzZUNsaWVudCgpO1xyXG4gIGNvbnN0IHsgZGF0YTogc2FtcGxlQ2h1bmssIGVycm9yIH0gPSBhd2FpdCBjbGllbnRcclxuICAgIC5mcm9tKCdrbm93bGVkZ2VfY2h1bmtzJylcclxuICAgIC5zZWxlY3QoJ2VtYmVkZGluZycpXHJcbiAgICAubGltaXQoMSlcclxuICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgaWYgKGVycm9yIHx8ICFzYW1wbGVDaHVuaykge1xyXG4gICAgY29uc29sZS5lcnJvcign4p2MIENvdWxkIG5vdCBnZXQgc2FtcGxlIGVtYmVkZGluZycpO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBQYXJzZSBlbWJlZGRpbmcgKGl0J3Mgc3RvcmVkIGFzIHN0cmluZylcclxuICAgIGNvbnN0IGVtYmVkZGluZyA9IEpTT04ucGFyc2Uoc2FtcGxlQ2h1bmsuZW1iZWRkaW5nKTtcclxuICAgIFxyXG4gICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpO1xyXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHNlbWFudGljU2VhcmNoKGVtYmVkZGluZywgeyBsaW1pdDogNSB9KTtcclxuICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0O1xyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZyhg4pyFIFZlY3RvciBzZWFyY2ggd29ya2luZ2ApO1xyXG4gICAgY29uc29sZS5sb2coYCAgIFJldHJpZXZlZDogJHtyZXN1bHRzLmxlbmd0aH0gY2h1bmtzYCk7XHJcbiAgICBjb25zb2xlLmxvZyhgICAgVGltZTogJHtkdXJhdGlvbn1tc2ApO1xyXG4gICAgY29uc29sZS5sb2coYCAgIFRvcCByZXN1bHQgc2ltaWxhcml0eTogJHtyZXN1bHRzWzBdPy5zaW1pbGFyaXR5Py50b0ZpeGVkKDMpIHx8ICdOL0EnfWApO1xyXG4gICAgXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByZXN1bHRzLCBkdXJhdGlvbiB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKGDinYwgVGVzdCBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50Iiwic3VwYWJhc2UiLCJnZXRTdXBhYmFzZUNsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwicmVSYW5rV2l0aENhcmVlckJvb3N0IiwiY2h1bmtzIiwib3B0aW9ucyIsInNjb3JlZENodW5rcyIsIm1hcCIsImNodW5rIiwicXVhbGl0eUJvb3N0IiwibWV0YWRhdGEiLCJjaHVua19tZXRhZGF0YSIsInRleHQiLCJjaHVua190ZXh0IiwidG9Mb3dlckNhc2UiLCJzb3VyY2VfZW50aXR5X3R5cGUiLCJ0eXBlIiwiY2FyZWVyIiwiY2F0ZWdvcnkiLCJtb2R1bGVfbmFtZSIsInRlc3QiLCJxdWVyeVRleHQiLCJvcmlnaW5hbF9zaW1pbGFyaXR5Iiwic2ltaWxhcml0eSIsImJvb3N0ZWRfc2ltaWxhcml0eSIsIk1hdGgiLCJtaW4iLCJxdWFsaXR5X2Jvb3N0Iiwic29ydCIsImEiLCJiIiwiZGVkdXBsaWNhdGVkIiwic2VlblRleHRzIiwiU2V0IiwiZmluZ2VycHJpbnQiLCJzdWJzdHJpbmciLCJ0cmltIiwiaGFzIiwiYWRkIiwicHVzaCIsInNlbWFudGljU2VhcmNoIiwicXVlcnlFbWJlZGRpbmciLCJsaW1pdCIsInRocmVzaG9sZCIsIm1vZHVsZU5hbWVzIiwicmV0cmlldmFsTGltaXQiLCJtYXgiLCJsZW5ndGgiLCJFcnJvciIsImNsaWVudCIsInF1ZXJ5IiwiZnJvbSIsInNlbGVjdCIsIm9yZGVyIiwiaW4iLCJkYXRhIiwiZXJyb3IiLCJmaWx0ZXJNb2R1bGVJZHMiLCJtb2R1bGVzIiwibW9kdWxlRXJyb3IiLCJtIiwiaWQiLCJlbWJlZGRpbmdTdHIiLCJqb2luIiwicmVzdWx0cyIsInNlYXJjaEVycm9yIiwicnBjIiwicXVlcnlfZW1iZWRkaW5nIiwibWF0Y2hfdGhyZXNob2xkIiwibWF0Y2hfY291bnQiLCJmaWx0ZXJfbW9kdWxlX2lkcyIsImNvbnNvbGUiLCJtZXNzYWdlIiwid2FybiIsImNodW5rSWRzIiwiciIsImNodW5rX2lkIiwiY2h1bmtzV2l0aE1vZHVsZXMiLCJlbnJpY2hFcnJvciIsIm1vZHVsZU1hcCIsIk1hcCIsImZvckVhY2giLCJtb2R1bGVOYW1lIiwia25vd2xlZGdlX21vZHVsZXMiLCJzZXQiLCJlbnJpY2hlZFJlc3VsdHMiLCJyZXN1bHQiLCJnZXQiLCJyZVJhbmtlZFJlc3VsdHMiLCJzbGljZSIsImh5YnJpZFNlYXJjaCIsImtleXdvcmRzIiwic2VtYW50aWNSZXN1bHRzIiwia2V5d29yZFBhdHRlcm4iLCJSZWdFeHAiLCJib29zdGVkUmVzdWx0cyIsImtleXdvcmRNYXRjaGVzIiwibWF0Y2giLCJrZXl3b3JkQm9vc3QiLCJrZXl3b3JkX21hdGNoZXMiLCJmaWx0ZXJCeU1vZHVsZSIsImZpbHRlciIsImluY2x1ZGVzIiwiZGVkdXBsaWNhdGVDaHVua3MiLCJzaW1pbGFyaXR5VGhyZXNob2xkIiwidW5pcXVlIiwiaXNEdXBsaWNhdGUiLCJzb21lIiwiZXhpc3RpbmciLCJjYWxjdWxhdGVUZXh0U2ltaWxhcml0eSIsInRleHQxIiwidGV4dDIiLCJ3b3JkczEiLCJzcGxpdCIsIndvcmRzMiIsImludGVyc2VjdGlvbiIsIngiLCJ1bmlvbiIsInNpemUiLCJ0ZXN0VmVjdG9yU2VhcmNoIiwibG9nIiwic2FtcGxlQ2h1bmsiLCJzaW5nbGUiLCJzdWNjZXNzIiwiZW1iZWRkaW5nIiwiSlNPTiIsInBhcnNlIiwic3RhcnQiLCJEYXRlIiwibm93IiwiZHVyYXRpb24iLCJ0b0ZpeGVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/rag/search.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/formdata-node","vendor-chunks/openai","vendor-chunks/@supabase","vendor-chunks/form-data-encoder","vendor-chunks/whatwg-url","vendor-chunks/agentkeepalive","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/tslib","vendor-chunks/node-fetch","vendor-chunks/webidl-conversions","vendor-chunks/ms","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frag%2Fquery%2Froute&page=%2Fapi%2Frag%2Fquery%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frag%2Fquery%2Froute.js&appDir=C%3A%5CUsers%5CSEELANGOV%5CDesktop%5CThandi.ai%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CSEELANGOV%5CDesktop%5CThandi.ai&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();