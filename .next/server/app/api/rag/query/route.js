"use strict";(()=>{var e={};e.id=899,e.ids=[899],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},78037:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>x,patchFetch:()=>T,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>q});var s={};r.r(s),r.d(s,{GET:()=>l,OPTIONS:()=>m,POST:()=>c});var a=r(95419),n=r(69108),o=r(99678);r(78070);var i=r(53731),u=r(3702),p=r(72786),d=r(18166);async function c(e){let t=Date.now();try{let{query:r,options:s={}}=await e.json();if(!r||"string"!=typeof r)return new Response(JSON.stringify({success:!1,error:"Invalid request: query is required and must be a string"}),{status:400,headers:{"Content-Type":"application/json"}});if(r.trim().length<10)return new Response(JSON.stringify({success:!1,error:"Query too short: please provide at least 10 characters"}),{status:400,headers:{"Content-Type":"application/json"}});if(r.length>1e3)return new Response(JSON.stringify({success:!1,error:"Query too long: maximum 1000 characters"}),{status:400,headers:{"Content-Type":"application/json"}});let a=Date.now(),n=(0,p.$q)(r),o=Date.now()-a,c=Date.now(),l=await (0,i.K)(r),m=Date.now()-c,g=Date.now(),y=await (0,u.iG)(r,l,{limit:10,debug:s.includeDebug||!1}),h=Date.now()-g;if(0===y.length)return new Response(JSON.stringify({success:!1,error:"No relevant information found. Please try rephrasing your question.",query:r,studentProfile:n}),{status:404,headers:{"Content-Type":"application/json"}});let f=(0,p.iJ)(y,n),w=(0,p.xF)(f,.9),q=Date.now(),x=(0,p.OD)(w,n,{maxTokens:3e3,format:"structured"}),T=Date.now()-q,O=Date.now(),S=await (0,d.o)(r,x.context,n,{maxRetries:s.maxRetries||2,timeout:s.timeout||1e4}),b=Date.now()-O;if(!S.success)return new Response(JSON.stringify({success:!1,error:S.error||"Failed to generate response",query:r,studentProfile:n,metadata:{processingTime:Date.now()-t,...S.metadata}}),{status:500,headers:{"Content-Type":"application/json"}});let v=Date.now()-t,C={success:!0,query:r,response:S.response,studentProfile:{academicStrengths:n.academicStrengths,academicWeaknesses:n.academicWeaknesses,interests:n.interests,financialConstraint:n.financialConstraint,priorityModules:n.priorityModules},metadata:{processingTime:v,breakdown:{profileExtraction:o,embedding:m,search:h,contextAssembly:T,generation:b},chunksRetrieved:y.length,chunksUsed:x.metadata.includedChunks,tokensUsed:x.metadata.tokensUsed,modelUsed:S.metadata.modelUsed,retries:S.metadata.retries,validationPassed:S.metadata.validationPassed}};return s.includeDebug&&(C.debug={searchResults:y.map(e=>({id:e.id,similarity:e.similarity,module:e.module_name,text:e.chunk_text.substring(0,100)+"..."})),validation:S.validation,sources:x.metadata.sources}),new Response(JSON.stringify(C),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("RAG query error:",e),new Response(JSON.stringify({success:!1,error:"Internal server error: "+e.message,metadata:{processingTime:Date.now()-t}}),{status:500,headers:{"Content-Type":"application/json"}})}}async function l(){return new Response(JSON.stringify({status:"ok",endpoint:"/api/rag/query",method:"POST",description:"RAG-based career guidance query endpoint",version:"1.0.0",usage:{method:"POST",body:{query:"string (required, 10-1000 chars)",options:{maxRetries:"number (optional, default: 2)",timeout:"number (optional, default: 10000ms)",includeDebug:"boolean (optional, default: false)"}}}}),{status:200,headers:{"Content-Type":"application/json"}})}async function m(){return new Response(JSON.stringify({}),{status:200,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let g=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/rag/query/route",pathname:"/api/rag/query",filename:"route",bundlePath:"app/api/rag/query/route"},resolvedPagePath:"C:\\Users\\SEELANGOV\\Desktop\\Thandi.ai\\app\\api\\rag\\query\\route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:h,serverHooks:f,headerHooks:w,staticGenerationBailout:q}=g,x="/api/rag/query/route";function T(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,206,200,631],()=>r(78037));module.exports=s})();